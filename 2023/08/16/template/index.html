<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>acm模板整理（未完） | wrpwrpのBlog</title><meta name="keywords" content="模板"><meta name="author" content="wrpwrp"><meta name="copyright" content="wrpwrp"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="模板">
<meta property="og:type" content="article">
<meta property="og:title" content="acm模板整理（未完）">
<meta property="og:url" content="http://example.com/2023/08/16/template/index.html">
<meta property="og:site_name" content="wrpwrpのBlog">
<meta property="og:description" content="模板">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c">
<meta property="article:published_time" content="2023-08-15T16:00:00.000Z">
<meta property="article:modified_time" content="2023-08-17T03:39:55.354Z">
<meta property="article:author" content="wrpwrp">
<meta property="article:tag" content="模板">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/08/16/template/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: wrpwrp","link":"链接: ","source":"来源: wrpwrpのBlog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2023-08-17 11:39:55'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://bpic.588ku.com/element_pic/20/07/01/4347f2eea4eebb9a4708ea61636893a7.jpg!/fw/253/quality/90/unsharp/true/compress/true" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">wrpwrpのBlog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">acm模板整理（未完）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-15T16:00:00.000Z" title="发表于 2023-08-16 00:00:00">2023-08-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-17T03:39:55.354Z" title="更新于 2023-08-17 11:39:55">2023-08-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A8%A1%E6%9D%BF/">模板</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">22.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>129分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="acm模板整理（未完）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>[TOC]</p>
<h1 id="常用"><a href="#常用" class="headerlink" title="常用"></a>常用</h1><h2 id="快读快写"><a href="#快读快写" class="headerlink" title="快读快写"></a>快读快写</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Input</span> &#123;</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> MX 1000000</span></span><br><span class="line">	<span class="keyword">private</span> :</span><br><span class="line">		<span class="type">char</span> buf[MX], *p1 = buf, *p2 = buf;</span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">gc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(p1 == p2) p2 = (p1 = buf) + <span class="built_in">fread</span>(buf, <span class="number">1</span>, MX, stdin);</span><br><span class="line">			<span class="keyword">return</span> p1 == p2 ? EOF : *(p1 ++);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> :</span><br><span class="line">		<span class="built_in">Input</span>() &#123;</span><br><span class="line">			<span class="meta">#<span class="keyword">ifdef</span> Open_File</span></span><br><span class="line">				<span class="built_in">freopen</span>(<span class="string">&quot;a.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">				<span class="built_in">freopen</span>(<span class="string">&quot;a.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">			<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">		<span class="keyword">inline</span> Input&amp; <span class="keyword">operator</span> &gt;&gt;(T &amp;x) &#123;</span><br><span class="line">			x = <span class="number">0</span>; <span class="type">int</span> f = <span class="number">1</span>; <span class="type">char</span> a = <span class="built_in">gc</span>();</span><br><span class="line">			<span class="keyword">for</span>(; ! <span class="built_in">isdigit</span>(a); a = <span class="built_in">gc</span>()) <span class="keyword">if</span>(a == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>;</span><br><span class="line">			<span class="keyword">for</span>(; <span class="built_in">isdigit</span>(a); a = <span class="built_in">gc</span>()) </span><br><span class="line">				x = x * <span class="number">10</span> + a - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">			x *= f;</span><br><span class="line">			<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">inline</span> Input&amp; <span class="keyword">operator</span> &gt;&gt;(<span class="type">char</span> &amp;ch) &#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">				ch = <span class="built_in">gc</span>();</span><br><span class="line">				<span class="keyword">if</span>(ch != <span class="string">&#x27;\n&#x27;</span> &amp;&amp; ch != <span class="string">&#x27; &#x27;</span>) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">inline</span> Input&amp; <span class="keyword">operator</span> &gt;&gt;(<span class="type">char</span> *s) &#123;</span><br><span class="line">			<span class="type">int</span> p = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">				s[p] = <span class="built_in">gc</span>();</span><br><span class="line">				<span class="keyword">if</span>(s[p] == <span class="string">&#x27;\n&#x27;</span> || s[p] == <span class="string">&#x27; &#x27;</span> || s[p] == EOF) <span class="keyword">break</span>;</span><br><span class="line">				p ++; </span><br><span class="line">			&#125;</span><br><span class="line">			s[p] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">			<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="meta">#<span class="keyword">undef</span> MX</span></span><br><span class="line">&#125; Fin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Output</span> &#123;</span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> MX 1000000</span></span><br><span class="line">	<span class="keyword">private</span> :</span><br><span class="line">		<span class="type">char</span> ouf[MX], *p1 = ouf, *p2 = ouf;</span><br><span class="line">		<span class="type">char</span> Of[<span class="number">105</span>], *o1 = Of, *o2 = Of;</span><br><span class="line">		<span class="function"><span class="type">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123; <span class="built_in">fwrite</span>(ouf, <span class="number">1</span>, p2 - p1, stdout); p2 = p1; &#125;</span><br><span class="line">		<span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> ch)</span> </span>&#123;</span><br><span class="line">			* (p2 ++) = ch;</span><br><span class="line">			<span class="keyword">if</span>(p2 == p1 + MX) <span class="built_in">flush</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">public</span> :</span><br><span class="line">		<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line">		<span class="keyword">inline</span> Output&amp; <span class="keyword">operator</span> &lt;&lt; (T n) &#123;</span><br><span class="line">			<span class="keyword">if</span>(n &lt; <span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>), n = -n;</span><br><span class="line">			<span class="keyword">if</span>(n == <span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">			<span class="keyword">while</span>(n) *(o1 ++) = (n % <span class="number">10</span>) ^ <span class="number">48</span>, n /= <span class="number">10</span>;</span><br><span class="line">			<span class="keyword">while</span>(o1 != o2) <span class="built_in">pc</span>(* (--o1));</span><br><span class="line">			<span class="keyword">return</span> *<span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">inline</span> Output &amp; <span class="keyword">operator</span> &lt;&lt; (<span class="type">char</span> ch) &#123;</span><br><span class="line">			<span class="built_in">pc</span>(ch); <span class="keyword">return</span> *<span class="keyword">this</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">inline</span> Output &amp; <span class="keyword">operator</span> &lt;&lt;(<span class="type">const</span> <span class="type">char</span> *ch) &#123;</span><br><span class="line">			<span class="type">const</span> <span class="type">char</span> *p = ch;</span><br><span class="line">			<span class="keyword">while</span>( *p != <span class="string">&#x27;\0&#x27;</span> ) <span class="built_in">pc</span>(* p ++);</span><br><span class="line">			<span class="keyword">return</span> * <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		~<span class="built_in">Output</span>() &#123; <span class="built_in">flush</span>(); &#125; </span><br><span class="line">	<span class="meta">#<span class="keyword">undef</span> MX</span></span><br><span class="line">&#125; Fout;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cin Fin</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cout Fout</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="常用缺省源"><a href="#常用缺省源" class="headerlink" title="常用缺省源"></a>常用缺省源</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf (stderr, __VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">998244353</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">mod</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x + (x &gt;&gt; <span class="number">31</span> &amp; P); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sub</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123; x = <span class="built_in">mod</span>(x - y); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pls</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123; x = <span class="built_in">mod</span>(x + y - P); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">mod</span>(x + y - P); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dec</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">mod</span>(x - y); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">1</span>; <span class="keyword">if</span> (k &lt; <span class="number">0</span>) k += P - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (k) &#123; <span class="keyword">if</span> (k &amp; <span class="number">1</span>) res = <span class="number">1ll</span> * res * x % P; x = <span class="number">1ll</span> * x * x % P; k &gt;&gt;= <span class="number">1</span>; &#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	<span class="type">int</span> Case; cin &gt;&gt; Case;</span><br><span class="line">	<span class="keyword">while</span> (Case --) <span class="built_in">solve</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h2><h3 id="gp-hash-table"><a href="#gp-hash-table" class="headerlink" title="gp_hash_table"></a>gp_hash_table</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> __gnu_pbds :: gp_hash_table;</span><br><span class="line"></span><br><span class="line">gp_hash_table &lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line">mp.<span class="built_in">find</span> (x) != mp.<span class="built_in">end</span>() <span class="comment">// 注意mp[x] 会创建 x 元素</span></span><br></pre></td></tr></table></figure>



<h3 id="朴素实现"><a href="#朴素实现" class="headerlink" title="朴素实现"></a>朴素实现</h3><p>上面这个解决不了基本也得现场写。</p>
<p>用邻接表写比较快。</p>
<h2 id="字符串哈希"><a href="#字符串哈希" class="headerlink" title="字符串哈希"></a>字符串哈希</h2><h3 id="单哈希"><a href="#单哈希" class="headerlink" title="单哈希"></a>单哈希</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="type">int</span> P&gt; </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">String_hash</span> &#123; <span class="comment">// s.size() &gt; 1 !!!</span></span><br><span class="line">	std :: vector&lt;<span class="type">int</span>&gt; pw, f;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> bs = <span class="number">233</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(std :: string s)</span> </span>&#123; <span class="comment">// [0, n - 1]</span></span><br><span class="line">		pw.<span class="built_in">resize</span> (s.<span class="built_in">size</span>() + <span class="number">1</span>); f.<span class="built_in">resize</span> (s.<span class="built_in">size</span>() + <span class="number">1</span>);</span><br><span class="line">		pw[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= (<span class="type">int</span>) s.<span class="built_in">size</span>(); i ++) pw[i] = <span class="number">1ll</span> * pw[i - <span class="number">1</span>] * bs % P;</span><br><span class="line">		f[<span class="number">0</span>] = s[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= (<span class="type">int</span>) s.<span class="built_in">size</span>(); i ++) f[i] = (<span class="number">1ll</span> * f[i - <span class="number">1</span>] * bs + s[i]) % P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">get</span> <span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="keyword">return</span> (f[r] - <span class="number">1ll</span> * f[l - <span class="number">1</span>] * pw[r - l + <span class="number">1</span>] % P + P) % P; &#125;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>

<p>这个是单哈希， 双哈希建俩表就行了。</p>
<h3 id="自然溢出"><a href="#自然溢出" class="headerlink" title="自然溢出"></a>自然溢出</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">unlimit_hash</span> &#123; <span class="comment">// s.size() &gt; 1 !!!</span></span><br><span class="line">	std :: vector&lt;ull&gt; pw, f;</span><br><span class="line">	<span class="type">const</span> ull bs = <span class="number">233</span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(std :: string s)</span> </span>&#123; <span class="comment">// [0, n - 1]</span></span><br><span class="line">		pw.<span class="built_in">resize</span> (s.<span class="built_in">size</span>() + <span class="number">1</span>); f.<span class="built_in">resize</span> (s.<span class="built_in">size</span>() + <span class="number">1</span>);</span><br><span class="line">		pw[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= (<span class="type">int</span>) s.<span class="built_in">size</span>(); i ++) pw[i] = pw[i - <span class="number">1</span>] * bs;</span><br><span class="line">		f[<span class="number">0</span>] = s[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= (<span class="type">int</span>) s.<span class="built_in">size</span>(); i ++) f[i] = f[i - <span class="number">1</span>] * bs + s[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> ull <span class="title">get</span> <span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123; <span class="keyword">return</span> f[r] - f[l - <span class="number">1</span>] * pw[r - l + <span class="number">1</span>]; &#125;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>

<h2 id="线段树"><a href="#线段树" class="headerlink" title="线段树"></a>线段树</h2><h3 id="区间历史最值，-区间取min"><a href="#区间历史最值，-区间取min" class="headerlink" title="区间历史最值， 区间取min"></a>区间历史最值， 区间取min</h3><p>来自洛谷模板。</p>
<p>给出一个长度为 $n$ 的数列 $A$，同时定义一个辅助数组 $B$，$B$ 开始与 $A$ 完全相同。接下来进行了 $m$ 次操作，操作有五种类型，按以下格式给出：</p>
<ul>
<li><code>1 l r k</code>：对于所有的 $i\in[l,r]$，将 $A_i$ 加上 $k$（$k$ 可以为负数）。</li>
<li><code>2 l r v</code>：对于所有的 $i\in[l,r]$，将 $A_i$ 变成 $\min(A_i,v)$。</li>
<li><code>3 l r</code>：求 $\sum_{i&#x3D;l}^{r}A_i$。</li>
<li><code>4 l r</code>：对于所有的 $i\in[l,r]$，求 $A_i$ 的最大值。</li>
<li><code>5 l r</code>：对于所有的 $i\in[l,r]$，求 $B_i$ 的最大值。</li>
</ul>
<p>在每一次操作后，我们都进行一次更新，让 $B_i\gets\max(B_i,A_i)$。</p>
<p>数据规模与约定</p>
<ul>
<li>对于全部测试数据，保证 $1\leq n,m\leq 5\times 10^5$，$-5\times10^8\leq A_i\leq 5\times10^8$，$op\in[1,5]$，$1 \leq l\leq r \leq n$，$-2000\leq k\leq 2000$，$-5\times10^8\leq v\leq 5\times10^8$。</li>
</ul>
<p>下面是 2log 代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">	Node *ls, *rs;</span><br><span class="line">	<span class="type">int</span> l, r;</span><br><span class="line">	<span class="type">int</span> add1, d_add1;</span><br><span class="line">	<span class="type">int</span> add2, d_add2;</span><br><span class="line">	ll sum;</span><br><span class="line">	<span class="type">int</span> mx1, mx2, cmx, d_mx1;</span><br><span class="line">	<span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="type">int</span> _l, <span class="type">int</span> _r) : <span class="built_in">l</span>(_l), <span class="built_in">r</span>(_r), <span class="built_in">ls</span>(<span class="literal">NULL</span>), <span class="built_in">rs</span>(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		sum = ls -&gt; sum + rs -&gt; sum;</span><br><span class="line">		d_mx1 = <span class="built_in">max</span>(ls -&gt; d_mx1, rs -&gt; d_mx1);</span><br><span class="line">		<span class="keyword">if</span>(ls -&gt; mx1 == rs -&gt; mx1) &#123;</span><br><span class="line">			mx1 = ls -&gt; mx1;</span><br><span class="line">			mx2 = <span class="built_in">max</span>(ls -&gt; mx2, rs -&gt; mx2);</span><br><span class="line">			cmx = ls -&gt; cmx + rs -&gt; cmx;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ls -&gt; mx1 &gt; rs -&gt; mx1) &#123;</span><br><span class="line">			mx1 = ls -&gt; mx1;</span><br><span class="line">			mx2 = <span class="built_in">max</span>(ls -&gt; mx2, rs -&gt; mx1);</span><br><span class="line">			cmx = ls -&gt; cmx;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			mx1 = rs -&gt; mx1;</span><br><span class="line">			mx2 = <span class="built_in">max</span>(ls -&gt; mx1, rs -&gt; mx2);</span><br><span class="line">			cmx = rs -&gt; cmx;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pushtag</span><span class="params">(<span class="type">int</span> k1, <span class="type">int</span> d_k1, <span class="type">int</span> k2, <span class="type">int</span> d_k2)</span> </span>&#123;</span><br><span class="line">		sum += <span class="number">1ll</span> * k1 * cmx + <span class="number">1ll</span> * (r - l + <span class="number">1</span> - cmx) * k2;</span><br><span class="line">		d_add1 = <span class="built_in">max</span>(d_add1, add1 + d_k1);</span><br><span class="line">		d_mx1 = <span class="built_in">max</span>(d_mx1, mx1 + d_k1);</span><br><span class="line">		mx1 += k1; add1 += k1;</span><br><span class="line">		d_add2 = <span class="built_in">max</span>(d_add2, add2 + d_k2);</span><br><span class="line">		<span class="keyword">if</span>(mx2 != - INF) mx2 += k2;</span><br><span class="line">		add2 += k2;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> mx = <span class="built_in">max</span>(ls -&gt; mx1, rs -&gt; mx1);</span><br><span class="line">		<span class="keyword">if</span>(ls -&gt; mx1 == mx) </span><br><span class="line">			ls -&gt; <span class="built_in">pushtag</span>(add1, d_add1, add2, d_add2);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			ls -&gt; <span class="built_in">pushtag</span>(add2, d_add2, add2, d_add2);</span><br><span class="line">		<span class="keyword">if</span>(rs -&gt; mx1 == mx) </span><br><span class="line">			rs -&gt; <span class="built_in">pushtag</span>(add1, d_add1, add2, d_add2);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			rs -&gt; <span class="built_in">pushtag</span>(add2, d_add2, add2, d_add2);</span><br><span class="line">		add1 = d_add1 = add2 = d_add2 = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">modify1</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">			<span class="built_in">pushtag</span>(k, k, k, k);</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">pushdown</span>();</span><br><span class="line">		<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) ls -&gt; <span class="built_in">modify1</span>(L, R, k);</span><br><span class="line">		<span class="keyword">if</span>(R &gt; mid) rs -&gt; <span class="built_in">modify1</span>(L, R, k);</span><br><span class="line">		<span class="built_in">upd</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">modify2</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(k &gt;= mx1) <span class="keyword">return</span> ;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R &amp;&amp; k &gt; mx2) &#123;</span><br><span class="line">			<span class="built_in">pushtag</span>(k - mx1, k - mx1, <span class="number">0</span>, <span class="number">0</span>); <span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">pushdown</span>();</span><br><span class="line">		<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) ls -&gt; <span class="built_in">modify2</span>(L, R, k);</span><br><span class="line">		<span class="keyword">if</span>(R &gt; mid) rs -&gt; <span class="built_in">modify2</span>(L, R, k);</span><br><span class="line">		<span class="built_in">upd</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">ll <span class="title">query3</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> sum;</span><br><span class="line">		<span class="built_in">pushdown</span>();</span><br><span class="line">		ll sum = <span class="number">0</span>;</span><br><span class="line">		<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) sum += ls -&gt; <span class="built_in">query3</span>(L, R);</span><br><span class="line">		<span class="keyword">if</span>(R &gt; mid) sum += rs -&gt; <span class="built_in">query3</span>(L, R);</span><br><span class="line">		<span class="keyword">return</span> sum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">query4</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> mx1;</span><br><span class="line">		<span class="built_in">pushdown</span>();</span><br><span class="line">		<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> ans = -INF;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) ans = <span class="built_in">max</span>(ans, ls -&gt; <span class="built_in">query4</span>(L, R));</span><br><span class="line">		<span class="keyword">if</span>(R &gt; mid) ans = <span class="built_in">max</span>(ans, rs -&gt; <span class="built_in">query4</span>(L, R));</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">query5</span><span class="params">(<span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> d_mx1;</span><br><span class="line">		<span class="built_in">pushdown</span>();</span><br><span class="line">		<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> ans = -INF;</span><br><span class="line">		<span class="keyword">if</span>(L &lt;= mid) ans = <span class="built_in">max</span>(ans, ls -&gt; <span class="built_in">query5</span>(L, R));</span><br><span class="line">		<span class="keyword">if</span>(R &gt; mid) ans = <span class="built_in">max</span>(ans, rs -&gt; <span class="built_in">query5</span>(L, R));</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; ;</span><br><span class="line"></span><br><span class="line"><span class="function">Node *<span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> *a)</span> </span>&#123;</span><br><span class="line">	Node *x = <span class="keyword">new</span> <span class="built_in">Node</span>(l, r);</span><br><span class="line">	x -&gt; add1 = x -&gt; d_add1 = x -&gt; add2 = x -&gt; d_add2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">		x -&gt; sum = x -&gt; mx1 = x -&gt; d_mx1 = a[l];</span><br><span class="line">		x -&gt; mx2 = - INF; x -&gt; cmx = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	x -&gt; ls = <span class="built_in">build</span>(l, mid, a);</span><br><span class="line">	x -&gt; rs = <span class="built_in">build</span>(mid + <span class="number">1</span>, r, a);</span><br><span class="line">	x -&gt; <span class="built_in">upd</span>();</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node *root;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span> (<span class="literal">false</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) cin &gt;&gt; a[i];</span><br><span class="line">	root = <span class="built_in">build</span>(<span class="number">1</span>, n, a);</span><br><span class="line">	<span class="keyword">while</span>(m --) &#123;</span><br><span class="line">		<span class="type">int</span> opt;</span><br><span class="line">		cin &gt;&gt; opt;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> l, r, k;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;</span><br><span class="line">			root -&gt; <span class="built_in">modify1</span>(l, r, k);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="type">int</span> l, r, k;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r &gt;&gt; k;</span><br><span class="line">			root -&gt; <span class="built_in">modify2</span>(l, r, k);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">3</span>) &#123;</span><br><span class="line">			<span class="type">int</span> l, r;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">			cout &lt;&lt; root -&gt; <span class="built_in">query3</span>(l, r) &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="type">int</span> l, r;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">			cout &lt;&lt; root -&gt; <span class="built_in">query4</span>(l, r) &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(opt == <span class="number">5</span>) &#123;</span><br><span class="line">			<span class="type">int</span> l, r;</span><br><span class="line">			cin &gt;&gt; l &gt;&gt; r;</span><br><span class="line">			cout &lt;&lt; root -&gt; <span class="built_in">query5</span>(l, r) &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>如果功能不够， 现场使用矩阵实现即可。</li>
</ul>
<h2 id="左偏树"><a href="#左偏树" class="headerlink" title="左偏树"></a>左偏树</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">	Node *ls, *rs;</span><br><span class="line">	<span class="type">int</span> val, bh;</span><br><span class="line">	<span class="built_in">Node</span>(<span class="type">int</span> V, <span class="type">int</span> B) &#123;</span><br><span class="line">		val = V; ls = rs = <span class="literal">NULL</span>; bh = B;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="function">Node* <span class="title">merge</span><span class="params">(Node *x, Node *y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! x) <span class="keyword">return</span> y;</span><br><span class="line">	<span class="keyword">if</span>(! y) <span class="keyword">return</span> x;</span><br><span class="line">	<span class="keyword">if</span>(x -&gt; val &gt; y -&gt; val || (x -&gt; val == y -&gt; val &amp;&amp; x -&gt; bh &gt; y -&gt; bh))</span><br><span class="line">		<span class="built_in">swap</span>(x, y);</span><br><span class="line">	x -&gt; rs = <span class="built_in">merge</span>(x -&gt; rs, y);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">rand</span>() &amp; <span class="number">1</span>) <span class="built_in">swap</span>(x -&gt; ls, x -&gt; rs);</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="平衡树"><a href="#平衡树" class="headerlink" title="平衡树"></a>平衡树</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> a = <span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">for</span>(; ! <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>()) <span class="keyword">if</span>(a == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>()) x = x * <span class="number">10</span> + a - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> RandomSeed;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">const</span> <span class="type">int</span> Mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line">	<span class="keyword">return</span> RandomSeed = ( <span class="number">1LL</span> * RandomSeed * <span class="number">0x66CCFF</span> % Mod + <span class="number">19260817</span>) % Mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> tot;</span><br><span class="line"><span class="type">int</span> ls[N], rs[N], val[N], rnd[N], sz[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	sz[x] = sz[ls[x]] + sz[rs[x]] + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">New</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	val[++ tot] = k;</span><br><span class="line">	sz[tot] = <span class="number">1</span>;</span><br><span class="line">	rnd[tot] = <span class="built_in">rand</span>();</span><br><span class="line">	<span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! x || ! y) <span class="keyword">return</span> x + y;</span><br><span class="line">	<span class="keyword">if</span>(rnd[x] &lt;= rnd[y]) &#123;</span><br><span class="line">		rs[x] = <span class="built_in">merge</span>(rs[x], y);</span><br><span class="line">		<span class="built_in">update</span>(x); <span class="keyword">return</span> x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		ls[y] = <span class="built_in">merge</span>(x, ls[y]);</span><br><span class="line">		<span class="built_in">update</span>(y); <span class="keyword">return</span> y;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> now, <span class="type">int</span> k, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! now) &#123;</span><br><span class="line">		x = y = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(val[now] &lt;= k) &#123;</span><br><span class="line">		x = now;</span><br><span class="line">		<span class="built_in">split</span>(rs[x], k, rs[x], y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		y = now;</span><br><span class="line">		<span class="built_in">split</span>(ls[y], k, x, ls[y]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">update</span>(now);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ins</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="built_in">split</span>(rt, k, a, b);</span><br><span class="line">	rt = <span class="built_in">merge</span>(a, <span class="built_in">merge</span>(<span class="built_in">New</span>(k), b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">erase</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b, c;</span><br><span class="line">	<span class="built_in">split</span>(rt, k - <span class="number">1</span>, a, b);</span><br><span class="line">	<span class="built_in">split</span>(b, k, b, c);</span><br><span class="line">	b = <span class="built_in">merge</span>(ls[b], rs[b]);</span><br><span class="line">	rt = <span class="built_in">merge</span>(a, <span class="built_in">merge</span>(b, c));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">rnk</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="built_in">split</span>(rt, k - <span class="number">1</span>, a, b);</span><br><span class="line">	<span class="type">int</span> ans = sz[a] + <span class="number">1</span>;</span><br><span class="line">	rt = <span class="built_in">merge</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Kth</span><span class="params">(<span class="type">int</span> root, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = root;</span><br><span class="line">	<span class="keyword">while</span>(x) &#123;</span><br><span class="line">		<span class="keyword">if</span>(sz[ls[x]] &gt;= k) &#123; x = ls[x]; <span class="keyword">continue</span>; &#125;</span><br><span class="line">		k -= sz[ls[x]] + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(k == <span class="number">0</span>) <span class="keyword">return</span> x;</span><br><span class="line">		x = rs[x];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">kth</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> val[<span class="built_in">Kth</span>(rt, k)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pre</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="built_in">split</span>(rt, k - <span class="number">1</span>, a, b);</span><br><span class="line">	<span class="type">int</span> ans = val[<span class="built_in">Kth</span>(a, sz[a])];</span><br><span class="line">	rt = <span class="built_in">merge</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">nxt</span><span class="params">(<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, b;</span><br><span class="line">	<span class="built_in">split</span>(rt, k, a, b);</span><br><span class="line">	<span class="type">int</span> ans = val[<span class="built_in">Kth</span>(b, <span class="number">1</span>)];</span><br><span class="line">	rt = <span class="built_in">merge</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">while</span>(n --) &#123;</span><br><span class="line">		<span class="type">int</span> op = <span class="built_in">read</span>(), x = <span class="built_in">read</span>();</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">1</span>) <span class="built_in">ins</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">2</span>) <span class="built_in">erase</span>(x);</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">3</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">rnk</span>(x));</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">4</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">kth</span>(x));</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">5</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">pre</span>(x));</span><br><span class="line">		<span class="keyword">if</span>(op == <span class="number">6</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">nxt</span>(x));</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>非常用， 存一个数组版本， 考试如果需要动态开点随便改改就可以了。</p>
<h2 id="KDT"><a href="#KDT" class="headerlink" title="KDT"></a>KDT</h2><p>KDT没有什么封装的意义，因为平衡复杂度的操作往往需要访问内部点， 故直接贴板子。</p>
<p>来自洛谷 TATT</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> I inline</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;x)</span> </span>&#123;</span><br><span class="line">    x = <span class="number">0</span>; <span class="type">bool</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">for</span> (;!<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) <span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) f=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (;<span class="built_in">isdigit</span>(c);c=<span class="built_in">getchar</span>()) x=x*<span class="number">10</span>+(c^<span class="number">48</span>);</span><br><span class="line">    <span class="keyword">if</span> (f) x=-x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">200500</span>;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">	<span class="type">int</span> d[<span class="number">5</span>], val, loc;</span><br><span class="line">	<span class="type">bool</span> <span class="keyword">operator</span> &lt; (<span class="type">const</span> node &amp;k) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">5</span>; i++) </span><br><span class="line">			<span class="keyword">if</span> (d[i] != k.d[i]) <span class="keyword">return</span> d[i] &lt; k.d[i];</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;p[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> g[N], k;</span><br><span class="line"></span><br><span class="line"><span class="function">I <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> p[a].d[k] &lt; p[b].d[k];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls son[x][0]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs son[x][1]</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> son[N][<span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> mx[N][<span class="number">4</span>], mn[N][<span class="number">4</span>], mxa[N], res[N], ans;</span><br><span class="line"><span class="function">I <span class="type">void</span> <span class="title">Mn</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">if</span> (x &gt; y) x = y; &#125;</span><br><span class="line"><span class="function">I <span class="type">void</span> <span class="title">Mx</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">if</span> (x &lt; y) x = y; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function">I <span class="type">void</span> <span class="title">maintain</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">		mx[x][i] = mn[x][i] = p[x].d[i+<span class="number">1</span>];</span><br><span class="line">		<span class="keyword">if</span> (ls) <span class="built_in">Mx</span>(mx[x][i], mx[ls][i]), <span class="built_in">Mn</span>(mn[x][i], mn[ls][i]);</span><br><span class="line">		<span class="keyword">if</span> (rs) <span class="built_in">Mx</span>(mx[x][i], mx[rs][i]), <span class="built_in">Mn</span>(mn[x][i], mn[rs][i]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">build</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> d)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l &gt; r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	k = d + <span class="number">1</span>, <span class="built_in">nth_element</span>(g + l, g + mid, g + r + <span class="number">1</span>, cmp);</span><br><span class="line">	son[g[mid]][<span class="number">0</span>] = <span class="built_in">build</span>(l, mid - <span class="number">1</span>, (d + <span class="number">1</span>) % <span class="number">4</span>);</span><br><span class="line">	son[g[mid]][<span class="number">1</span>] = <span class="built_in">build</span>(mid + <span class="number">1</span>, r, (d + <span class="number">1</span>) % <span class="number">4</span>);</span><br><span class="line">	<span class="built_in">maintain</span>(g[mid]); <span class="keyword">return</span> g[mid];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> tmp;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断x点是否在y点范围以内 </span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">in</span><span class="params">(<span class="type">int</span> *x, <span class="type">int</span> *y)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">4</span>; i++) cnt += (x[i] &lt;= y[i]);</span><br><span class="line">	<span class="keyword">return</span> cnt == <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mxa[x] &lt;= tmp) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">in</span>(mn[x], p[y].d + <span class="number">1</span>)) <span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">in</span>(mx[x], p[y].d + <span class="number">1</span>)) <span class="keyword">return</span> tmp = mxa[x], <span class="built_in">void</span>();</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">in</span>(p[x].d + <span class="number">1</span>, p[y].d + <span class="number">1</span>)) <span class="built_in">Mx</span>(tmp, res[x]);</span><br><span class="line">	<span class="keyword">if</span> (ls) <span class="built_in">query</span>(ls, y); <span class="keyword">if</span> (rs) <span class="built_in">query</span>(rs, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 激活操作 </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upit</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (x == y) &#123;</span><br><span class="line">		res[x] = tmp, <span class="built_in">Mx</span>(mxa[x], res[x]); <span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">in</span>(p[y].d + <span class="number">1</span>, mx[x]) || !<span class="built_in">in</span>(mn[x], p[y].d + <span class="number">1</span>)) <span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">// 如果y点不在里面就返回 </span></span><br><span class="line">	<span class="keyword">if</span> (ls) <span class="built_in">upit</span>(ls, y); <span class="keyword">if</span> (rs) <span class="built_in">upit</span>(rs, y);</span><br><span class="line">	<span class="built_in">Mx</span>(mxa[x], mxa[ls]), <span class="built_in">Mx</span>(mxa[x], mxa[rs]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rt, n;</span><br><span class="line"><span class="type">int</span> Ans[N];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	rt = <span class="number">0</span>;</span><br><span class="line">	tmp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) g[i] = <span class="number">0</span>, son[i][<span class="number">0</span>] = son[i][<span class="number">1</span>] = <span class="number">0</span>, mxa[i] = <span class="number">0</span>, res[i] = <span class="number">0</span>;</span><br><span class="line">	ans = <span class="number">0</span>;</span><br><span class="line">	n = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen (&quot;hs.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="built_in">read</span>(p[i].d[<span class="number">0</span>]), <span class="built_in">read</span>(p[i].d[<span class="number">1</span>]);</span><br><span class="line">		<span class="built_in">read</span>(p[i].d[<span class="number">2</span>]), <span class="built_in">read</span>(p[i].d[<span class="number">3</span>]);</span><br><span class="line">		<span class="comment">//read(p[i].d[4]), read(p[i].val);</span></span><br><span class="line">		p[i].val = <span class="number">1</span>;</span><br><span class="line">		p[i].loc = i;</span><br><span class="line">		g[i] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(p + <span class="number">1</span>, p + n + <span class="number">1</span>); rt = <span class="built_in">build</span>(<span class="number">1</span>, n, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n; i++) </span><br><span class="line">		tmp = <span class="number">0</span>, <span class="built_in">query</span>(rt, i), tmp+=p[i].val, <span class="built_in">upit</span>(rt, i), <span class="built_in">Mx</span>(ans, tmp), Ans[p[i].loc] = tmp;</span><br><span class="line">	<span class="comment">//for (int i = 1; i &lt;= n; i ++) printf(&quot;%lld\n&quot;, Ans[i]);</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">	<span class="comment">//cout &lt;&lt; ans &lt;&lt; endl;</span></span><br><span class="line">	<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> Case;</span><br><span class="line">	<span class="comment">//read(Case);</span></span><br><span class="line">	 Case = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (Case --) <span class="built_in">solve</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="LCT"><a href="#LCT" class="headerlink" title="LCT"></a>LCT</h2><p>来自洛谷模板</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls(x) ch[x][0]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs(x) ch[x][1]</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> val[N], sum[N], rev[N], ch[N][<span class="number">2</span>], fa[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	sum[x] = sum[<span class="built_in">ls</span>(x)] ^ sum[<span class="built_in">rs</span>(x)] ^ val[x];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">nroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x == <span class="built_in">ls</span>(fa[x]) || x == <span class="built_in">rs</span>(fa[x]); &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x == <span class="built_in">rs</span>(fa[x]); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rotate</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> y = fa[x], z = fa[y], k = <span class="built_in">get</span>(x), w = ch[x][! k];</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">nroot</span>(y)) ch[z][<span class="built_in">get</span>(y)] = x; ch[x][! k] = y; ch[y][k] = w;</span><br><span class="line">	<span class="keyword">if</span> (w) fa[w] = y; fa[y] = x; fa[x] = z; <span class="built_in">upd</span>(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	std :: <span class="built_in">swap</span>(<span class="built_in">ls</span>(x), <span class="built_in">rs</span>(x)); rev[x] ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (rev[x]) <span class="built_in">reverse</span>(<span class="built_in">ls</span>(x)), <span class="built_in">reverse</span>(<span class="built_in">rs</span>(x)), rev[x] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushall</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">if</span> (<span class="built_in">nroot</span>(x)) <span class="built_in">pushall</span>(fa[x]); <span class="built_in">pushdown</span>(x); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">splay</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">pushall</span>(x);</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">nroot</span>(x)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">nroot</span>(fa[x])) <span class="built_in">rotate</span>(<span class="built_in">get</span>(x) ? x : fa[x]);</span><br><span class="line">		<span class="built_in">rotate</span>(x);</span><br><span class="line">	&#125; <span class="built_in">upd</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">access</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; x; x = fa[y = x]) </span><br><span class="line">		<span class="built_in">splay</span>(x), <span class="built_in">rs</span>(x) = y, <span class="built_in">upd</span>(x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">makeroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">access</span>(x); <span class="built_in">splay</span>(x); <span class="built_in">reverse</span>(x); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">split</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">makeroot</span>(x); <span class="built_in">access</span>(y); <span class="built_in">splay</span>(y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findroot</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">access</span>(x); <span class="built_in">splay</span>(x);</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">ls</span>(x)) x = <span class="built_in">ls</span>(x);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">splay</span>(x), x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">link</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">makeroot</span>(x);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">findroot</span>(y) != x) fa[x] = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cut</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">makeroot</span>(x);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">findroot</span>(y) == x &amp;&amp; fa[y] == x &amp;&amp; <span class="built_in">ls</span>(y) == <span class="number">0</span>) &#123;</span><br><span class="line">	    <span class="built_in">makeroot</span>(x);</span><br><span class="line">		fa[y] = <span class="built_in">rs</span>(x) = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">upd</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>); </span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) cin &gt;&gt; val[i], <span class="built_in">upd</span>(i);</span><br><span class="line">	<span class="keyword">while</span> (m --) &#123;</span><br><span class="line">		<span class="type">int</span> opt, x, y;</span><br><span class="line">		cin &gt;&gt; opt &gt;&gt; x &gt;&gt; y;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">0</span>) &#123; <span class="built_in">split</span>(x, y); cout &lt;&lt; sum[y] &lt;&lt; endl; &#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) <span class="built_in">link</span>(x, y);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) <span class="built_in">cut</span>(x, y);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>) &#123; <span class="built_in">splay</span>(x); val[x] = y; <span class="built_in">upd</span>(x); &#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="李超树"><a href="#李超树" class="headerlink" title="李超树"></a>李超树</h2><p>支持合并的李超树模板， 动态开点， 支持查询某个地方最小值， 每次全局加线段。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">    LL k, b;</span><br><span class="line">    <span class="built_in">Line</span>(LL K = <span class="number">0</span>, LL B = <span class="number">0</span>) : <span class="built_in">k</span>(K), <span class="built_in">b</span>(B) &#123;&#125;</span><br><span class="line">    <span class="function">LL <span class="title">calc</span><span class="params">(LL x)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> k * x + b; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">inter</span><span class="params">(<span class="type">const</span> Line &amp;a)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) (a.b - b) / (k - a.k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; ;</span><br><span class="line"></span><br><span class="line">Line tr[N &lt;&lt; <span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> ls[N &lt;&lt; <span class="number">5</span>], rs[N &lt;&lt; <span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> tot;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> &amp;x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">const</span> Line &amp;lns)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(! x) &#123;</span><br><span class="line">        x = ++ tot;</span><br><span class="line">        tr[x] = lns;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span>(tr[x].<span class="built_in">calc</span>(l) &gt; lns.<span class="built_in">calc</span>(l) &amp;&amp; tr[x].<span class="built_in">calc</span>(r) &gt; lns.<span class="built_in">calc</span>(r)) &#123;</span><br><span class="line">        tr[x] = lns;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(tr[x].<span class="built_in">calc</span>(l) &lt; lns.<span class="built_in">calc</span>(l) &amp;&amp; tr[x].<span class="built_in">calc</span>(r) &lt; lns.<span class="built_in">calc</span>(r)) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> p = tr[x].<span class="built_in">inter</span>(lns);</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(tr[x].k &lt; lns.k) &#123;</span><br><span class="line">        <span class="keyword">if</span>(mid &lt; p) </span><br><span class="line">            <span class="built_in">insert</span>(rs[x], mid + <span class="number">1</span>, r, tr[x]),</span><br><span class="line">            tr[x] = lns;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">insert</span>(ls[x], l, mid, lns);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(mid &gt; p) </span><br><span class="line">            <span class="built_in">insert</span>(ls[x], l, mid, tr[x]), </span><br><span class="line">            tr[x] = lns;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="built_in">insert</span>(rs[x], mid + <span class="number">1</span>, r, lns);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(! x || ! y) <span class="keyword">return</span> x + y;</span><br><span class="line">    <span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">        <span class="keyword">if</span>(tr[x].<span class="built_in">calc</span>(l) &gt; tr[y].<span class="built_in">calc</span>(l))</span><br><span class="line">            tr[x] = tr[y];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    ls[x] = <span class="built_in">merge</span>(ls[x], ls[y], l, mid);</span><br><span class="line">    rs[x] = <span class="built_in">merge</span>(rs[x], rs[y], mid + <span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">insert</span>(x, l, r, tr[y]);</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(! x) <span class="keyword">return</span> <span class="number">1e18</span>;</span><br><span class="line">    LL res = tr[x].<span class="built_in">calc</span>(v);</span><br><span class="line">    <span class="keyword">if</span>(l == r) <span class="keyword">return</span> res;</span><br><span class="line">    <span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(v &lt;= mid) <span class="keyword">return</span> <span class="built_in">min</span>(res, <span class="built_in">query</span>(ls[x], l, mid, v));</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="built_in">min</span>(res, <span class="built_in">query</span>(rs[x], mid + <span class="number">1</span>, r, v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="树链剖分"><a href="#树链剖分" class="headerlink" title="树链剖分"></a>树链剖分</h2><p>返回所有需要修改或者查询的区间， 传入大小， 根节点和存边的vector， 如果需要排序直接按 dfn sort 即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf (stderr, __VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: endl;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> P;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">HLD</span> &#123;</span><br><span class="line">	std :: vector&lt;<span class="type">int</span>&gt; fa, dep, dfn, sz, top, son, loc;</span><br><span class="line">	<span class="type">int</span> n, rt;</span><br><span class="line">	std :: vector&lt;std :: vector&lt;<span class="type">int</span>&gt; &gt; e;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dfs1</span> <span class="params">(<span class="type">int</span> x, <span class="type">int</span> fx)</span> </span>&#123;</span><br><span class="line">		sz[x] = <span class="number">1</span>; dep[x] = dep[fx] + <span class="number">1</span>; fa[x] = fx;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> y : e[x]) <span class="keyword">if</span> (y != fx) &#123;</span><br><span class="line">			<span class="built_in">dfs1</span> (y, x), sz[x] += sz[y];</span><br><span class="line">			<span class="keyword">if</span> (sz[y] &gt;= sz[son[x]]) son[x] = y;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dfs2</span> <span class="params">(<span class="type">int</span> x, <span class="type">int</span> topx)</span> </span>&#123;</span><br><span class="line">		top[x] = topx;</span><br><span class="line">		dfn[x] = ++ dfn[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">if</span> (son[x]) <span class="built_in">dfs2</span> (son[x], topx);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> y : e[x]) <span class="keyword">if</span> (y != fa[x] &amp;&amp; y != son[x]) <span class="built_in">dfs2</span> (y, y);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(<span class="type">int</span> _n, <span class="type">int</span> _rt, std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; edge)</span> </span>&#123;</span><br><span class="line">		n = _n; rt = _rt;</span><br><span class="line">		fa.<span class="built_in">resize</span>  (n + <span class="number">1</span>);</span><br><span class="line">		dep.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		dfn.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		sz.<span class="built_in">resize</span>  (n + <span class="number">1</span>);</span><br><span class="line">		top.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		son.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		loc.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		e.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> [x, y] : edge) e[x].<span class="built_in">push_back</span> (y), e[y].<span class="built_in">push_back</span> (x);</span><br><span class="line">		<span class="built_in">dfs1</span> (rt, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">dfs2</span> (rt, rt);</span><br><span class="line">		<span class="built_in">lep</span> (i, <span class="number">1</span>, n) loc[dfn[i]] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	std :: <span class="function">pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">subtree</span> <span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> &#123; dfn[x], dfn[x] + sz[x] - <span class="number">1</span> &#125;;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; <span class="built_in">chain</span> (<span class="type">int</span> x, <span class="type">int</span> y) &#123;</span><br><span class="line">		std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; rec;</span><br><span class="line">		<span class="keyword">while</span> (top[x] != top[y]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) std :: <span class="built_in">swap</span> (x, y);</span><br><span class="line">			rec.<span class="built_in">push_back</span> ( &#123;dfn[top[x]], dfn[x] &#125; );</span><br><span class="line">			x = fa[top[x]];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (dep[x] &gt; dep[y]) std :: <span class="built_in">swap</span> (x, y);</span><br><span class="line">		rec.<span class="built_in">push_back</span> ( &#123;dfn[x], dfn[y]&#125; );</span><br><span class="line">		<span class="keyword">return</span> rec;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; hld;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, rt;</span><br><span class="line"><span class="type">int</span> val[N];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls(x) (x &lt;&lt; 1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs(x) (x &lt;&lt; 1 | 1)</span></span><br><span class="line"></span><br><span class="line">i64 tr[N &lt;&lt; <span class="number">2</span>], tg[N &lt;&lt; <span class="number">2</span>], len[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r)</span> </span>&#123;</span><br><span class="line">	len[x] = r - l + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123; tr[x] = val[hld.loc[l]]; <span class="keyword">return</span> ; &#125;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">build</span>(<span class="built_in">ls</span>(x), l, mid);</span><br><span class="line">	<span class="built_in">build</span>(<span class="built_in">rs</span>(x), mid + <span class="number">1</span>, r);</span><br><span class="line">	tr[x] = (tr[<span class="built_in">ls</span>(x)] + tr[<span class="built_in">rs</span>(x)]) % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">down</span><span class="params">(<span class="type">int</span> x, i64 v)</span> </span>&#123;</span><br><span class="line">	tr[x] += v * len[x]; tg[x] += v;</span><br><span class="line">	tr[x] %= P; tg[x] %= P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pushdown</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(tg[x]) &#123;</span><br><span class="line">		<span class="built_in">down</span>(<span class="built_in">ls</span>(x), tg[x]);</span><br><span class="line">		<span class="built_in">down</span>(<span class="built_in">rs</span>(x), tg[x]);</span><br><span class="line">		tg[x] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">modify</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, i64 v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) &#123;</span><br><span class="line">		<span class="built_in">down</span>(x, v); <span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">pushdown</span>(x);</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>(L &lt;= mid) <span class="built_in">modify</span>(<span class="built_in">ls</span>(x), l, mid, L, R, v);</span><br><span class="line">	<span class="keyword">if</span>(R &gt; mid) <span class="built_in">modify</span>(<span class="built_in">rs</span>(x), mid + <span class="number">1</span>, r, L, R, v);</span><br><span class="line">	tr[x] = (tr[<span class="built_in">ls</span>(x)] + tr[<span class="built_in">rs</span>(x)]) % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">i64 <span class="title">query</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(L &lt;= l &amp;&amp; r &lt;= R) <span class="keyword">return</span> tr[x];</span><br><span class="line">	<span class="built_in">pushdown</span>(x);</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	i64 ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(L &lt;= mid) ans += <span class="built_in">query</span>(<span class="built_in">ls</span>(x), l, mid, L, R);</span><br><span class="line">	<span class="keyword">if</span>(R &gt; mid) ans += <span class="built_in">query</span>(<span class="built_in">rs</span>(x), mid + <span class="number">1</span>, r, L, R);</span><br><span class="line">	<span class="keyword">return</span> ans % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; rt &gt;&gt; P;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) cin &gt;&gt; val[i];</span><br><span class="line">	std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; edge;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">2</span>, n) &#123;</span><br><span class="line">		<span class="type">int</span> x, y;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">		edge.<span class="built_in">push_back</span> ( &#123;x, y&#125; );</span><br><span class="line">	&#125;</span><br><span class="line">	hld.<span class="built_in">init</span> (n, rt, edge);</span><br><span class="line">	<span class="built_in">build</span> (<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">	<span class="keyword">while</span> (m --) &#123;</span><br><span class="line">		<span class="type">int</span> op;</span><br><span class="line">		cin &gt;&gt; op;</span><br><span class="line">		<span class="keyword">if</span> (op == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="type">int</span> x, y, z;</span><br><span class="line">			cin &gt;&gt; x &gt;&gt; y &gt;&gt; z;</span><br><span class="line">			<span class="keyword">auto</span> vec = hld.<span class="built_in">chain</span> (x, y);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span> [l, r] : vec) <span class="built_in">modify</span> (<span class="number">1</span>, <span class="number">1</span>, n, l, r, z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (op == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="type">int</span> x, y, ans = <span class="number">0</span>;</span><br><span class="line">			cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">			<span class="keyword">auto</span> vec = hld.<span class="built_in">chain</span> (x, y);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">auto</span> [l, r] : vec) ans += <span class="built_in">query</span> (<span class="number">1</span>, <span class="number">1</span>, n, l, r), ans %= P;</span><br><span class="line">			cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (op == <span class="number">3</span>) &#123;</span><br><span class="line">			<span class="type">int</span> x, z;</span><br><span class="line">			cin &gt;&gt; x &gt;&gt; z;</span><br><span class="line">			<span class="keyword">auto</span> [l, r] = hld.<span class="built_in">subtree</span> (x);</span><br><span class="line">			<span class="built_in">modify</span> (<span class="number">1</span>, <span class="number">1</span>, n, l, r, z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (op == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="type">int</span> x;</span><br><span class="line">			cin &gt;&gt; x;</span><br><span class="line">			<span class="keyword">auto</span> [l, r] = hld.<span class="built_in">subtree</span> (x);</span><br><span class="line">			cout &lt;&lt; <span class="built_in">query</span> (<span class="number">1</span>, <span class="number">1</span>, n, l, r) % P &lt;&lt; endl;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="LCA"><a href="#LCA" class="headerlink" title="LCA"></a>LCA</h2><h3 id="ST表求LCA"><a href="#ST表求LCA" class="headerlink" title="ST表求LCA"></a>ST表求LCA</h3><p>一倍的 log 空间的lca求法。</p>
<p>$O(n \log n) - O(1)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">LCA</span> &#123;</span><br><span class="line">	std :: vector&lt;std :: vector&lt;<span class="type">int</span>&gt; &gt; e, st;</span><br><span class="line">	std :: vector&lt;<span class="type">int</span>&gt; dep, dfn; </span><br><span class="line">	<span class="type">int</span> tot;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fx)</span> </span>&#123; </span><br><span class="line">		dep[x] = dep[fx] + <span class="number">1</span>;</span><br><span class="line">		dfn[x] = ++ tot;</span><br><span class="line">		st[<span class="number">0</span>][tot] = fx;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> y : e[x]) <span class="keyword">if</span> (y != fx) <span class="built_in">dfs1</span>(y, x);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">upd</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> dep[x] &lt; dep[y] ? x : y; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (x == y) <span class="keyword">return</span> x;</span><br><span class="line">		x = dfn[x]; y = dfn[y];</span><br><span class="line">		<span class="keyword">if</span> (x &gt; y) std :: <span class="built_in">swap</span>(x, y);</span><br><span class="line">		<span class="type">int</span> d = <span class="built_in">log2</span> (y - x ++);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">upd</span>(st[d][x], st[d][y - (<span class="number">1</span> &lt;&lt; d) + <span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span> <span class="params">(<span class="type">int</span> n, <span class="type">int</span> rt, std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; edge)</span> </span>&#123;</span><br><span class="line">		e.<span class="built_in">resize</span> (n + <span class="number">1</span>); <span class="type">int</span> lg = <span class="built_in">log2</span> (n) + <span class="number">1</span>; tot = <span class="number">0</span>; </span><br><span class="line">		dep.<span class="built_in">resize</span> (n + <span class="number">1</span>), dfn.<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		st.<span class="built_in">resize</span> (lg + <span class="number">1</span>); <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= lg; i ++) st[i].<span class="built_in">resize</span> (n + <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> [x, y] : edge) e[x].<span class="built_in">push_back</span> (y), e[y].<span class="built_in">push_back</span> (x);</span><br><span class="line">		<span class="built_in">dfs1</span> (rt, <span class="number">0</span>); </span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= lg; i ++) </span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j + (<span class="number">1</span> &lt;&lt; i) - <span class="number">1</span> &lt;= n; j ++)</span><br><span class="line">				st[i][j] = <span class="built_in">upd</span>(st[i - <span class="number">1</span>][j], st[i - <span class="number">1</span>][j + (<span class="number">1</span> &lt;&lt; (i - <span class="number">1</span>))]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>





<h2 id="虚树"><a href="#虚树" class="headerlink" title="虚树"></a>虚树</h2><p>考虑到边权问题不进行封装， 使用的时候把lca复制过来直接跑这个就行。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> dfn[maxn];</span><br><span class="line"><span class="type">bool</span> valid[maxn];</span><br><span class="line"><span class="type">int</span> h[maxn], m, a[maxn], len;  <span class="comment">// 存储关键点</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> dfn[x] &lt; dfn[y];  <span class="comment">// 按照 dfn 序排序</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_virtual_tree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">sort</span>(h + <span class="number">1</span>, h + m + <span class="number">1</span>, cmp);  <span class="comment">// 把关键点按照 dfn 序排序</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; m; ++i) &#123;</span><br><span class="line">    a[++len] = h[i];</span><br><span class="line">    a[++len] = <span class="built_in">lca</span>(h[i], h[i + <span class="number">1</span>]);  <span class="comment">// 插入 lca</span></span><br><span class="line">  &#125;</span><br><span class="line">  a[++len] = h[m];</span><br><span class="line">  <span class="built_in">sort</span>(a + <span class="number">1</span>, a + len + <span class="number">1</span>, cmp);  <span class="comment">// 把所有虚树上的点按照 dfn 序排序</span></span><br><span class="line">  len = <span class="built_in">unique</span>(a + <span class="number">1</span>, a + len + <span class="number">1</span>) - a - <span class="number">1</span>;  <span class="comment">// 去重</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, lc; i &lt; len; ++i) &#123;</span><br><span class="line">    lc = <span class="built_in">lca</span>(a[i], a[i + <span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">conn</span>(lc, a[i + <span class="number">1</span>]);  <span class="comment">// 连边，如有边权 就是 distance(lc,a[i+1])</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="图论"><a href="#图论" class="headerlink" title="图论"></a>图论</h1><h2 id="最短路"><a href="#最短路" class="headerlink" title="最短路"></a>最短路</h2><h3 id="dijskra-堆优化"><a href="#dijskra-堆优化" class="headerlink" title="dijskra 堆优化"></a>dijskra 堆优化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; e[N];</span><br><span class="line"></span><br><span class="line">i64 dis[N];</span><br><span class="line"><span class="type">int</span> vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dijskra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: priority_queue&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; q;</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">	q.<span class="built_in">push</span>( &#123;<span class="number">0</span>, s&#125; ); dis[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> x = q.<span class="built_in">top</span>().second; q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span> (vis[x]) <span class="keyword">continue</span>;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">auto</span> p : e[x]) &#123;</span><br><span class="line">			<span class="type">int</span> y, w;</span><br><span class="line">			std :: <span class="built_in">tie</span>(y, w) = p;</span><br><span class="line">			<span class="keyword">if</span> (dis[y] &gt; dis[x] + w) &#123;</span><br><span class="line">				dis[y] = dis[x] + w;</span><br><span class="line">				q.<span class="built_in">push</span>( &#123;- dis[y], y&#125; );</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> 暴力实现 dijskra 每次暴力找 dis 最小的点即可。</p>
<h2 id="欧拉回路-欧拉路"><a href="#欧拉回路-欧拉路" class="headerlink" title="欧拉回路&#x2F;欧拉路"></a>欧拉回路&#x2F;欧拉路</h2><h3 id="有向图字典序最小欧拉路"><a href="#有向图字典序最小欧拉路" class="headerlink" title="有向图字典序最小欧拉路"></a>有向图字典序最小欧拉路</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> in[N], out[N];</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">	<span class="type">int</span> to, next;</span><br><span class="line">&#125; e[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt, head[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	e[++ cnt] = (edge) &#123;y, head[x]&#125;; head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> top, stk[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; </span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = head[x]; i; i = head[x]) &#123;</span><br><span class="line">		<span class="type">int</span> y = e[i].to; head[x] = e[i].next;</span><br><span class="line">		<span class="built_in">dfs</span>(y);</span><br><span class="line">	&#125;</span><br><span class="line">	stk[++ top] = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">read</span>(n); <span class="built_in">read</span>(m);</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; vec;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, m) &#123;</span><br><span class="line">		<span class="type">int</span> x, y;</span><br><span class="line">		<span class="built_in">read</span>(x); <span class="built_in">read</span>(y);</span><br><span class="line">		in[y] ++;</span><br><span class="line">		out[x] ++;</span><br><span class="line">		vec.<span class="built_in">pb</span>(&#123;x, y&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sort</span>(vec.<span class="built_in">begin</span>(), vec.<span class="built_in">end</span>(), [&amp;] (<span class="keyword">auto</span> a, <span class="keyword">auto</span> b) &#123; <span class="keyword">return</span> a.fi != b.fi ? a.fi &lt; b.fi : a.se &gt; b.se;&#125;);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> p : vec) <span class="built_in">push</span>(p.fi, p.se);</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> u = <span class="number">1</span>, pu = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="keyword">if</span>(<span class="built_in">abs</span>(in[i] - out[i]) &gt; <span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>), <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="keyword">if</span>(out[i] - in[i] == <span class="number">1</span>) u = i, pu --; <span class="keyword">else</span> <span class="keyword">if</span>(in[i] - out[i] == <span class="number">1</span>) pu ++;</span><br><span class="line">	<span class="keyword">if</span>(pu == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">dfs</span>(u);</span><br><span class="line">		<span class="built_in">rep</span> (i, top, <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, stk[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="欧拉回路"><a href="#欧拉回路" class="headerlink" title="欧拉回路"></a>欧拉回路</h3><p>Case &#x3D; 1 无向图， Case &#x3D; 1有向图</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">	<span class="type">int</span> to, next, w;</span><br><span class="line">&#125; e[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">1</span>, head[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">	e[++ cnt] = (edge) &#123;y, head[x], w&#125;; head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, Case;</span><br><span class="line"><span class="type">int</span> in[N], out[N];</span><br><span class="line"><span class="type">int</span> stk[N &lt;&lt; <span class="number">2</span>], top, vis[N &lt;&lt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> &amp;i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">		<span class="type">int</span> y = e[i].to; <span class="keyword">if</span>(vis[i]) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(Case == <span class="number">1</span>) vis[i] = vis[i ^ <span class="number">1</span>] = <span class="number">1</span>; </span><br><span class="line">		<span class="keyword">else</span> vis[i] = <span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> w = e[i].w; <span class="built_in">dfs</span>(y);</span><br><span class="line">		stk[++ top] = w;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	Case = <span class="built_in">read</span>();</span><br><span class="line">	n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> v = <span class="built_in">read</span>(), u = <span class="built_in">read</span>();</span><br><span class="line">		<span class="keyword">if</span>(Case == <span class="number">1</span>) &#123;</span><br><span class="line">			in[v] ++; in[u] ++;</span><br><span class="line">			<span class="built_in">add</span>(v, u, i); <span class="built_in">add</span>(u, v, - i);	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			in[u] ++; out[v] ++;</span><br><span class="line">			<span class="built_in">add</span>(v, u, i);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(Case == <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">			<span class="keyword">if</span>(in[i] &amp; <span class="number">1</span>) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;NO\n&quot;</span>); <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) </span><br><span class="line">			<span class="keyword">if</span>(in[i] != out[i]) &#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;NO\n&quot;</span>); <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			&#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">		<span class="keyword">if</span>(in[i] || out[i]) &#123;</span><br><span class="line">			<span class="built_in">dfs</span>(i);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">if</span>(top != m) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;NO\n&quot;</span>); <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;YES\n&quot;</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = top; i &gt;= <span class="number">1</span>; i --) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, stk[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="K短路-（可并堆优化）"><a href="#K短路-（可并堆优化）" class="headerlink" title="K短路 （可并堆优化）"></a>K短路 （可并堆优化）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e3</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">2e5</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> inf = <span class="number">1e15</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">double</span> E;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line">	<span class="type">int</span> head[N], nxt[M], to[M]; <span class="type">double</span> w[M];</span><br><span class="line">	<span class="type">int</span> cnt;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">double</span> W)</span> </span>&#123;</span><br><span class="line">		to[++ cnt] = y; w[cnt] = W; nxt[cnt] = head[x]; head[x] = cnt;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; G[<span class="number">2</span>];</span><br><span class="line">Graph *G1 = &amp;G[<span class="number">0</span>], *G2 = &amp;G[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> dis[N];</span><br><span class="line"><span class="type">int</span> vis[N], pre[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dijskra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">static</span> priority_queue&lt;pair&lt;<span class="type">double</span>, <span class="type">int</span>&gt; &gt; q;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) dis[i] = inf, vis[i] = <span class="number">0</span>;</span><br><span class="line">	q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(<span class="number">0</span>, n)); dis[n] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> x = q.<span class="built_in">top</span>().second; q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span>(vis[x]) <span class="keyword">continue</span>;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = G2 -&gt; head[x]; i; i = G2 -&gt; nxt[i]) &#123;</span><br><span class="line">			<span class="type">int</span> y = G2 -&gt; to[i];</span><br><span class="line">			<span class="keyword">if</span>(dis[y] &gt; dis[x] + G2 -&gt; w[i]) &#123;</span><br><span class="line">				dis[y] = dis[x] + G2 -&gt; w[i];</span><br><span class="line">				q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(- dis[y], y));</span><br><span class="line">				pre[y] = i;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ls(x) t[x].ch[0]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rs(x) t[x].ch[1]</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> val(x) t[x].val</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">	<span class="type">int</span> ch[<span class="number">2</span>], dist;</span><br><span class="line">	<span class="type">int</span> to; <span class="type">double</span> val;</span><br><span class="line">&#125;t[M &lt;&lt; <span class="number">5</span>];</span><br><span class="line"><span class="type">int</span> tot;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">New</span><span class="params">(<span class="type">int</span> to, <span class="type">double</span> val)</span> </span>&#123;</span><br><span class="line">	tot ++;</span><br><span class="line">	t[tot] = (Node) &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, to, val&#125;;</span><br><span class="line">	<span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! x || ! y) <span class="keyword">return</span> x | y;</span><br><span class="line">	<span class="type">int</span> z = ++ tot;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">val</span>(x) &gt; <span class="built_in">val</span>(y)) <span class="built_in">swap</span>(x, y);</span><br><span class="line">	t[z] = t[x];</span><br><span class="line">	<span class="built_in">rs</span>(z) = <span class="built_in">merge</span>(<span class="built_in">rs</span>(z), y);</span><br><span class="line">	<span class="keyword">if</span>(t[<span class="built_in">ls</span>(z)].dist &lt; t[<span class="built_in">rs</span>(z)].dist) <span class="built_in">swap</span>(<span class="built_in">ls</span>(z), <span class="built_in">rs</span>(z));</span><br><span class="line">	t[z].dist = t[<span class="built_in">rs</span>(z)].dist + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rt[N];</span><br><span class="line"><span class="type">int</span> pos[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">cmp</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> dis[x] &lt; dis[y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; E;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> x, y; <span class="type">double</span> w;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;</span><br><span class="line">		<span class="keyword">if</span>(x == n) &#123; </span><br><span class="line">			m --; i --; <span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		G1 -&gt; <span class="built_in">push</span>(x, y, w);</span><br><span class="line">		G2 -&gt; <span class="built_in">push</span>(y, x, w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dijskra</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>; x &lt;= n; x ++)</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = G1 -&gt; head[x]; i; i = G1 -&gt; nxt[i]) &#123;</span><br><span class="line">			<span class="keyword">if</span>(i == pre[x]) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="type">int</span> y = G1 -&gt; to[i]; <span class="comment">// orz tyx</span></span><br><span class="line">			rt[x] = <span class="built_in">merge</span>(rt[x], <span class="built_in">New</span>(y, - dis[x] + dis[y] + G1 -&gt; w[i]));</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) pos[i] = i;</span><br><span class="line">	<span class="built_in">sort</span>(pos + <span class="number">1</span>, pos + <span class="number">1</span> + n, cmp);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> x = pos[i];</span><br><span class="line">		rt[x] = <span class="built_in">merge</span>(rt[x], rt[G1 -&gt; to[pre[x]]]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">static</span> priority_queue&lt;pair&lt;<span class="type">double</span>, <span class="type">int</span>&gt; &gt;q;</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(E &lt; dis[<span class="number">1</span>]) &#123; cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">	E -= dis[<span class="number">1</span>]; ans ++;</span><br><span class="line">	<span class="keyword">if</span>(rt[<span class="number">1</span>]) </span><br><span class="line">		q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(- dis[<span class="number">1</span>] - <span class="built_in">val</span>(rt[<span class="number">1</span>]), rt[<span class="number">1</span>]));</span><br><span class="line">	<span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> x = q.<span class="built_in">top</span>().second; <span class="type">double</span> nwval = - q.<span class="built_in">top</span>().first;</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">		<span class="keyword">if</span>(E &lt; nwval) &#123; cout &lt;&lt; ans &lt;&lt; endl; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">		E -= nwval; ans ++;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">ls</span>(x)) q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(- nwval + <span class="built_in">val</span>(x) - <span class="built_in">val</span>(<span class="built_in">ls</span>(x)), <span class="built_in">ls</span>(x)));</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">rs</span>(x)) q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(- nwval + <span class="built_in">val</span>(x) - <span class="built_in">val</span>(<span class="built_in">rs</span>(x)), <span class="built_in">rs</span>(x)));</span><br><span class="line">		<span class="keyword">if</span>(rt[t[x].to]) q.<span class="built_in">push</span>(<span class="built_in">make_pair</span>(- nwval - <span class="built_in">val</span>(rt[t[x].to]), rt[t[x].to]));</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="连通分量"><a href="#连通分量" class="headerlink" title="连通分量"></a>连通分量</h2><h3 id="点双"><a href="#点双" class="headerlink" title="点双"></a>点双</h3><p>给出所有割点。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">	<span class="type">int</span> to, next;</span><br><span class="line">&#125; e[M];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt, head[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	e[++ cnt] = (edge) &#123;y, head[x]&#125;; head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dfn[N], low[N], bj[N], num;</span><br><span class="line"><span class="type">int</span> rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fx)</span> </span>&#123;</span><br><span class="line">	dfn[x] = low[x] = ++ num;</span><br><span class="line">	<span class="type">int</span> sz = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">		<span class="type">int</span> y = e[i].to;</span><br><span class="line">		<span class="keyword">if</span>(y == fx) <span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(! dfn[y]) &#123;</span><br><span class="line">			<span class="built_in">tarjan</span>(y, x), low[x] = <span class="built_in">min</span>(low[x], low[y]), sz ++;</span><br><span class="line">			<span class="keyword">if</span>(low[y] &gt;= dfn[x] &amp;&amp; x != rt) bj[x] = <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			low[x] = <span class="built_in">min</span>(low[x], dfn[y]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(x == rt &amp;&amp; sz &gt;= <span class="number">2</span>) bj[x] = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> x = <span class="built_in">read</span>(), y = <span class="built_in">read</span>();</span><br><span class="line">		<span class="built_in">add</span>(x, y); <span class="built_in">add</span>(y, x);</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">		<span class="keyword">if</span>(! dfn[i]) rt = i, <span class="built_in">tarjan</span>(i, <span class="number">0</span>);</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">		<span class="keyword">if</span>(bj[i]) ans.<span class="built_in">push_back</span>(i);</span><br><span class="line">	<span class="built_in">print</span>(ans.<span class="built_in">size</span>());</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i : ans) <span class="built_in">print</span>(i, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="边双"><a href="#边双" class="headerlink" title="边双"></a>边双</h3><p>给出所有割边</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> low[MAXN], dfn[MAXN], dfs_clock;</span><br><span class="line"><span class="type">bool</span> isbridge[MAXN];</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; G[MAXN];</span><br><span class="line"><span class="type">int</span> cnt_bridge;</span><br><span class="line"><span class="type">int</span> father[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">  father[u] = fa;</span><br><span class="line">  low[u] = dfn[u] = ++dfs_clock;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; G[u].<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">    <span class="type">int</span> v = G[u][i];</span><br><span class="line">    <span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">      <span class="built_in">tarjan</span>(v, u);</span><br><span class="line">      low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">      <span class="keyword">if</span> (low[v] &gt; dfn[u]) &#123;</span><br><span class="line">        isbridge[v] = <span class="literal">true</span>;</span><br><span class="line">        ++cnt_bridge;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dfn[v] &lt; dfn[u] &amp;&amp; v != fa) &#123;</span><br><span class="line">      low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="强连通分量"><a href="#强连通分量" class="headerlink" title="强连通分量"></a>强连通分量</h3><h4 id="tarjan"><a href="#tarjan" class="headerlink" title="tarjan"></a>tarjan</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; e[N];</span><br><span class="line">vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt;edge;</span><br><span class="line"><span class="type">int</span> a[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dfn[N], low[N], co[N], col, sum[N];</span><br><span class="line"><span class="type">int</span> stk[N], top;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	stk[++ top] = x;</span><br><span class="line">	dfn[x] = low[x] = ++ dfn[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> y : e[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span>(! dfn[y]) &#123;</span><br><span class="line">			<span class="built_in">tarjan</span>(y);</span><br><span class="line">			low[x] = <span class="built_in">min</span>(low[x], low[y]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(! co[y]) low[x] = <span class="built_in">min</span>(low[x], dfn[y]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(low[x] == dfn[x]) &#123;</span><br><span class="line">		co[x] = ++ col;</span><br><span class="line">		sum[col] = a[x];</span><br><span class="line">		<span class="keyword">while</span>(stk[top] != x) &#123;</span><br><span class="line">			co[stk[top]] = col;</span><br><span class="line">			sum[col] += a[stk[top]];</span><br><span class="line">			top --;</span><br><span class="line">		&#125;</span><br><span class="line">		top --;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="kosoraju"><a href="#kosoraju" class="headerlink" title="kosoraju"></a>kosoraju</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// g 是原图，g2 是反图</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">  vis[u] = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> v : g[u])</span><br><span class="line">    <span class="keyword">if</span> (!vis[v]) <span class="built_in">dfs1</span>(v);</span><br><span class="line">  s.<span class="built_in">push_back</span>(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs2</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">  color[u] = sccCnt;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> v : g2[u])</span><br><span class="line">    <span class="keyword">if</span> (!color[v]) <span class="built_in">dfs2</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">kosaraju</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  sccCnt = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; ++i)</span><br><span class="line">    <span class="keyword">if</span> (!vis[i]) <span class="built_in">dfs1</span>(i);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt;= <span class="number">1</span>; --i)</span><br><span class="line">    <span class="keyword">if</span> (!color[s[i]]) &#123;</span><br><span class="line">      ++sccCnt;</span><br><span class="line">      <span class="built_in">dfs2</span>(s[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="最小割树"><a href="#最小割树" class="headerlink" title="最小割树"></a>最小割树</h2><p>给定一个 $n$ 个点 $m$ 条边的无向连通图，多次询问两点之间的最小割</p>
<p>$n &#x3D; 500, m &#x3D; 1500, Q &#x3D; 10^5$ 复杂度很高但是很快。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">3000</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF  = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Node_Edge</span> &#123; <span class="type">int</span> x, y, w; &#125; ;</span><br><span class="line">vector&lt;Node_Edge&gt; edge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Tree</span> &#123;</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; e[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">		e[x].<span class="built_in">push_back</span>( &#123;y, w&#125; );</span><br><span class="line">		e[y].<span class="built_in">push_back</span>( &#123;x, w&#125; );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> lg[N], dep[N];</span><br><span class="line">	<span class="type">int</span> fa[N][<span class="number">20</span>], jp[N][<span class="number">20</span>];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> fx, <span class="type">int</span> fw)</span> </span>&#123;</span><br><span class="line">		fa[x][<span class="number">0</span>] = fx;</span><br><span class="line">		jp[x][<span class="number">0</span>] = fw; </span><br><span class="line">		dep[x] = dep[fx] + <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">lep</span> (i, <span class="number">1</span>, lg[dep[x]]) fa[x][i] = fa[fa[x][i - <span class="number">1</span>]][i - <span class="number">1</span>], jp[x][i] = <span class="built_in">min</span>(jp[x][i - <span class="number">1</span>], jp[fa[x][i - <span class="number">1</span>]][i - <span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> p : e[x]) <span class="keyword">if</span>(p.first != fx) <span class="built_in">dfs</span>(p.first, x, p.second);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">qry</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(dep[x] &lt; dep[y]) <span class="built_in">swap</span>(x, y);</span><br><span class="line">		<span class="type">int</span> ans = INF;</span><br><span class="line">		<span class="keyword">while</span>(dep[x] &gt; dep[y]) &#123;</span><br><span class="line">			<span class="type">int</span> i = lg[dep[x] - dep[y]];</span><br><span class="line">			ans = <span class="built_in">min</span>(ans, jp[x][i]);</span><br><span class="line">			x = fa[x][i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(x == y) <span class="keyword">return</span> ans;</span><br><span class="line">		<span class="built_in">rep</span> (i, lg[dep[x]], <span class="number">0</span>) <span class="keyword">if</span>(fa[x][i] ^ fa[y][i]) &#123;</span><br><span class="line">			ans = <span class="built_in">min</span>(ans, jp[x][i]);</span><br><span class="line">			x = fa[x][i];</span><br><span class="line">			ans = <span class="built_in">min</span>(ans, jp[y][i]);</span><br><span class="line">			y = fa[y][i];</span><br><span class="line">		&#125;</span><br><span class="line">		ans = <span class="built_in">min</span>(ans, jp[x][<span class="number">0</span>]);</span><br><span class="line">		ans = <span class="built_in">min</span>(ans, jp[y][<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="built_in">lep</span> (i, <span class="number">2</span>, n) lg[i] = lg[i &gt;&gt; <span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">dfs</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; T;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Flow_Solution</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">		<span class="type">int</span> to, next, f;</span><br><span class="line">	&#125; e[M &lt;&lt; <span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> cnt;</span><br><span class="line">	<span class="type">int</span> cur[N], head[N], dep[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">		e[++ cnt] = (edge) &#123;y, head[x], f&#125;; head[x] = cnt;</span><br><span class="line">		e[++ cnt] = (edge) &#123;x, head[y], <span class="number">0</span>&#125;; head[y] = cnt;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> S, T;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">		<span class="built_in">lep</span> (x, <span class="number">0</span>, n) dep[x] = INF, cur[x] = head[x];</span><br><span class="line">		q.<span class="built_in">push</span>(S); dep[S] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> x = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">				<span class="keyword">if</span>(e[i].f &amp;&amp; dep[e[i].to] == INF) &#123;</span><br><span class="line">					dep[e[i].to] = dep[x] + <span class="number">1</span>;</span><br><span class="line">					q.<span class="built_in">push</span>(e[i].to); </span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dep[T] != INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(x == T || lim == <span class="number">0</span>) <span class="keyword">return</span> lim;</span><br><span class="line">		<span class="type">int</span> flow = <span class="number">0</span>, tmp; </span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> &amp;i = cur[x]; i; i = e[i].next) </span><br><span class="line">			<span class="keyword">if</span>(dep[e[i].to] == dep[x] + <span class="number">1</span> &amp;&amp; (tmp = <span class="built_in">dfs</span>(e[i].to, <span class="built_in">min</span>(lim, e[i].f)))) &#123;</span><br><span class="line">				e[i].f -= tmp;</span><br><span class="line">				e[i ^ <span class="number">1</span>].f += tmp;</span><br><span class="line">				flow += tmp;</span><br><span class="line">				lim -= tmp;</span><br><span class="line">				<span class="keyword">if</span>(lim == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="keyword">return</span> flow;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">solve</span><span class="params">(<span class="type">int</span> _S, <span class="type">int</span> _T, vector&lt;<span class="type">int</span>&gt; &amp;node)</span> </span>&#123;</span><br><span class="line">		cnt = <span class="number">1</span>; S = _S; T = _T;</span><br><span class="line">		<span class="built_in">lep</span> (i, <span class="number">0</span>, n) head[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">memset</span>(head, <span class="number">0</span>, <span class="built_in">sizeof</span>(head));</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> p : :: edge) <span class="built_in">push</span>(p.x, p.y, p.w), <span class="built_in">push</span>(p.y, p.x, p.w);</span><br><span class="line">		<span class="type">int</span> flow = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">bfs</span>()) flow += <span class="built_in">dfs</span>(S, INF);</span><br><span class="line">		<span class="keyword">return</span> flow;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; Flow;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;node)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(node.<span class="built_in">size</span>() &lt;= <span class="number">1</span>) <span class="keyword">return</span> ;</span><br><span class="line">	<span class="type">int</span> SS = node[<span class="number">0</span>];</span><br><span class="line">	<span class="type">int</span> TT = node[<span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> flow = Flow.<span class="built_in">solve</span>(SS, TT, node);</span><br><span class="line">	T.<span class="built_in">push</span>(SS, TT, flow);</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; lnode, rnode;</span><br><span class="line">	vector&lt;Node_Edge&gt; ledge, redge;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> x : node) </span><br><span class="line">		<span class="keyword">if</span>(Flow.dep[x] != INF) lnode.<span class="built_in">push_back</span>(x);</span><br><span class="line">		<span class="keyword">else</span> rnode.<span class="built_in">push_back</span>(x);</span><br><span class="line">	<span class="built_in">solve</span>(lnode);</span><br><span class="line">	<span class="built_in">solve</span>(rnode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; node;</span><br><span class="line">	n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, m) &#123;</span><br><span class="line">		<span class="type">int</span> x = <span class="built_in">read</span>(), y = <span class="built_in">read</span>(), w = <span class="built_in">read</span>();</span><br><span class="line">		edge.<span class="built_in">push_back</span>( &#123;x, y, w&#125; );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) node.<span class="built_in">push_back</span>(i);</span><br><span class="line">	<span class="built_in">solve</span>(node);</span><br><span class="line">	T.<span class="built_in">build</span>();</span><br><span class="line">	<span class="type">int</span> q = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">while</span>(q --) &#123;</span><br><span class="line">		<span class="type">int</span> x = <span class="built_in">read</span>(), y = <span class="built_in">read</span>();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, T.<span class="built_in">qry</span>(x, y));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="支配树"><a href="#支配树" class="headerlink" title="支配树"></a>支配树</h2><p>返回每个点在支配树上的父亲。</p>
<p>单 log 复杂度。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> DominateTree &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> N = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> M = <span class="number">5e5</span> + <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> n, m;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">        <span class="type">int</span> to, next;</span><br><span class="line">    &#125; e[M * <span class="number">3</span>];</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> head[<span class="number">3</span>][N], cnt;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Ins</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">        e[++ cnt] = (edge) &#123;y, head[id][x]&#125;; head[id][x] = cnt;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> dfn[N], stk[N], co;</span><br><span class="line">    <span class="type">int</span> fa[N];</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Tarjan</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        stk[dfn[x] = ++ co] = x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = head[<span class="number">0</span>][x]; i; i = e[i].next) &#123;</span><br><span class="line">            <span class="type">int</span> y = e[i].to;</span><br><span class="line">            <span class="keyword">if</span>(! dfn[y]) &#123;</span><br><span class="line">                fa[y] = x;</span><br><span class="line">                <span class="built_in">Tarjan</span>(y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> idom[N], sdom[N];</span><br><span class="line">    <span class="type">int</span> Fa[N], mn[N];</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x == Fa[x]) <span class="keyword">return</span> x;</span><br><span class="line">        <span class="type">int</span> res = <span class="built_in">Find</span>(Fa[x]);</span><br><span class="line">        <span class="keyword">if</span>(dfn[sdom[mn[Fa[x]]]] &lt; dfn[sdom[mn[x]]]) mn[x] = mn[Fa[x]];</span><br><span class="line">        <span class="keyword">return</span> Fa[x] = res;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Contract</span><span class="params">(<span class="type">int</span> st)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">Tarjan</span>(st);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) sdom[i] = Fa[i] = mn[i] = i;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = co; i &gt;= <span class="number">2</span>; i --) &#123;</span><br><span class="line">            <span class="type">int</span> x = stk[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = head[<span class="number">1</span>][x]; i; i = e[i].next) &#123;</span><br><span class="line">                <span class="type">int</span> y = e[i].to;</span><br><span class="line">                <span class="keyword">if</span>(! dfn[y]) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="built_in">Find</span>(y);</span><br><span class="line">                <span class="keyword">if</span>(dfn[sdom[mn[y]]] &lt; dfn[sdom[x]])</span><br><span class="line">                    sdom[x] = sdom[mn[y]];</span><br><span class="line">            &#125;</span><br><span class="line">            Fa[x] = fa[x];</span><br><span class="line">            <span class="built_in">Ins</span>(<span class="number">2</span>, sdom[x], x);</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = head[<span class="number">2</span>][x = fa[x]]; i; i = e[i].next) &#123;</span><br><span class="line">                <span class="type">int</span> y = e[i].to;</span><br><span class="line">                <span class="built_in">Find</span>(y);</span><br><span class="line">                idom[y] = x == sdom[mn[y]] ? x : mn[y];</span><br><span class="line">            &#125;</span><br><span class="line">            head[<span class="number">2</span>][x] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= co; i ++) &#123;</span><br><span class="line">            <span class="type">int</span> x = stk[i];</span><br><span class="line">            <span class="keyword">if</span>(idom[x] ^ sdom[x]) idom[x] = idom[idom[x]];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">lep</span> (i, <span class="number">0</span>, <span class="number">2</span>) <span class="built_in">lep</span> (j, <span class="number">1</span>, n) head[i][j] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">lep</span> (i, <span class="number">1</span>, n) dfn[i] = stk[i] = fa[i] = idom[i] = sdom[i] = Fa[i] = mn[i] = <span class="number">0</span>;</span><br><span class="line">        co = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    std :: <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">solve</span><span class="params">(<span class="type">int</span> _n, <span class="type">int</span> _m, std :: vector&lt;std :: pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; &amp;edge)</span> </span>&#123;</span><br><span class="line">        n = _n;</span><br><span class="line">        m = _m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;[x, y] : edge) <span class="built_in">Ins</span>(<span class="number">0</span>, x, y), <span class="built_in">Ins</span>(<span class="number">1</span>, y, x);</span><br><span class="line">        <span class="built_in">Contract</span>(<span class="number">1</span>);</span><br><span class="line">        std :: <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">fa</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) fa[i] = idom[i];</span><br><span class="line">        <span class="built_in">clear</span>();</span><br><span class="line">        <span class="keyword">return</span> fa;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-SAT"><a href="#2-SAT" class="headerlink" title="2-SAT"></a>2-SAT</h2><p>连边条件就是如果不满足某个某个条件就向必要的那个条件连边。</p>
<p>比如 “如果是a是0， 则b是1， 那么a0 -&gt; b1 连边”。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">2e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; e[N];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dfn[N], low[N], stk[N], top, co[N], col;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">tarjan</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	dfn[x] = low[x] = ++ dfn[<span class="number">0</span>];</span><br><span class="line">	stk[++ top] = x;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> y : e[x]) &#123;</span><br><span class="line">		<span class="keyword">if</span>(! dfn[y]) &#123;</span><br><span class="line">			<span class="built_in">tarjan</span>(y);</span><br><span class="line">			low[x] = <span class="built_in">min</span>(low[x], low[y]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(! co[y]) low[x] = <span class="built_in">min</span>(low[x], dfn[y]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(low[x] == dfn[x]) &#123;</span><br><span class="line">		co[x] = ++ col;</span><br><span class="line">		<span class="keyword">while</span>(stk[top] != x) &#123;</span><br><span class="line">			co[stk[top]] = col;</span><br><span class="line">			top --;</span><br><span class="line">		&#125;</span><br><span class="line">		top --;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">read</span>(n); <span class="built_in">read</span>(m);</span><br><span class="line">	<span class="built_in">lep</span> (o, <span class="number">1</span>, m) &#123;</span><br><span class="line">		<span class="type">int</span> i, a, j, b;</span><br><span class="line">		<span class="built_in">read</span>(i); <span class="built_in">read</span>(a); <span class="built_in">read</span>(j); <span class="built_in">read</span>(b);</span><br><span class="line">		<span class="keyword">if</span>(a == <span class="number">1</span> &amp;&amp; b == <span class="number">1</span>)</span><br><span class="line">			e[i + n].<span class="built_in">pb</span>(j), e[j + n].<span class="built_in">pb</span>(i);</span><br><span class="line">		<span class="keyword">if</span>(a == <span class="number">0</span> &amp;&amp; b == <span class="number">1</span>)</span><br><span class="line">			e[i].<span class="built_in">pb</span>(j), e[j + n].<span class="built_in">pb</span>(i + n);</span><br><span class="line">		<span class="keyword">if</span>(a == <span class="number">1</span> &amp;&amp; b == <span class="number">0</span>)</span><br><span class="line">			e[j].<span class="built_in">pb</span>(i), e[i + n].<span class="built_in">pb</span>(j + n);</span><br><span class="line">		<span class="keyword">if</span>(a == <span class="number">0</span> &amp;&amp; b == <span class="number">0</span>)</span><br><span class="line">			e[i].<span class="built_in">pb</span>(j + n), e[j].<span class="built_in">pb</span>(i + n);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n * <span class="number">2</span>) <span class="keyword">if</span>(! dfn[i]) <span class="built_in">tarjan</span>(i);</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="keyword">if</span>(co[i] == co[i + n]) <span class="built_in">printf</span>(<span class="string">&quot;IMPOSSIBLE\n&quot;</span>), <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;POSSIBLE\n&quot;</span>);</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, co[i] &lt; co[i + n], <span class="string">&quot; \n&quot;</span>[i == n]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="差分约束"><a href="#差分约束" class="headerlink" title="差分约束"></a>差分约束</h2><p>直接复制最短路。</p>
<h2 id="网络流"><a href="#网络流" class="headerlink" title="网络流"></a>网络流</h2><h3 id="最大流"><a href="#最大流" class="headerlink" title="最大流"></a>最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e3</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, s, t;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> to, next, f;</span><br><span class="line">&#125; e[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> head[N];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> _push(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f) &#123;</span><br><span class="line">    e[++ cnt] = (edge) &#123;y, head[x], f&#125;; head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">    _push(x, y, f); _push(y, x, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> dep[N], cur[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    queue&lt;<span class="type">int</span>&gt; q; q.<span class="built_in">push</span>(s);</span><br><span class="line">    <span class="built_in">lep</span> (i, <span class="number">1</span>, n) cur[i] = head[i], dep[i] = INF;</span><br><span class="line">    dep[s] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = head[x]; i; i = e[i].next) <span class="keyword">if</span>(e[i].f &amp;&amp; dep[e[i].to] == INF) &#123;</span><br><span class="line">           dep[e[i].to] = dep[x] + <span class="number">1</span>;</span><br><span class="line">           q.<span class="built_in">push</span>(e[i].to);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dep[t] != INF;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x == t || lim == <span class="number">0</span>) <span class="keyword">return</span> lim;</span><br><span class="line">    <span class="type">int</span> flow = <span class="number">0</span>, tmp;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> &amp;i = cur[x]; i; i = e[i].next) <span class="keyword">if</span>(dep[e[i].to] == dep[x] + <span class="number">1</span> &amp;&amp; (tmp = <span class="built_in">dfs</span>(e[i].to, <span class="built_in">min</span>(lim, e[i].f)))) &#123;</span><br><span class="line">        flow += tmp;</span><br><span class="line">        e[i].f -= tmp;</span><br><span class="line">        e[i ^ <span class="number">1</span>].f += tmp;</span><br><span class="line">        lim -= tmp;</span><br><span class="line">        <span class="keyword">if</span>(lim == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>, u, v, f; i &lt;= m; i ++) &#123;</span><br><span class="line">        cin &gt;&gt; u &gt;&gt; v &gt;&gt; f;</span><br><span class="line">        <span class="built_in">push</span>(u, v, f);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">bfs</span>()) ans += <span class="built_in">dfs</span>(s, INF);</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="最小费用最大流"><a href="#最小费用最大流" class="headerlink" title="最小费用最大流"></a>最小费用最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Net</span> &#123;</span><br><span class="line">	<span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">		<span class="type">int</span> to, next, f, w;</span><br><span class="line">	&#125; e[M &lt;&lt; <span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> cnt, head[N];</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">		e[++ cnt] = (edge) &#123;y, head[x], f, w&#125;; head[x] = cnt;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">Add</span>(x, y, f, w); <span class="built_in">Add</span>(y, x, <span class="number">0</span>, -w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> S, T;</span><br><span class="line">	<span class="type">int</span> flow, cost;</span><br><span class="line">	<span class="type">int</span> vis[N], dis[N], cur[N];</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">		<span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="built_in">sizeof</span>(vis));</span><br><span class="line">		<span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">		<span class="built_in">memcpy</span>(cur, head, <span class="built_in">sizeof</span>(cur));</span><br><span class="line">		q.<span class="built_in">push</span>(S); dis[S] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">			<span class="type">int</span> x = q.<span class="built_in">front</span>(); q.<span class="built_in">pop</span>();</span><br><span class="line">			vis[x] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">				<span class="type">int</span> y = e[i].to;</span><br><span class="line">				<span class="keyword">if</span>(dis[y] &gt; dis[x] + e[i].w &amp;&amp; e[i].f) &#123;</span><br><span class="line">					dis[y] = dis[x] + e[i].w;</span><br><span class="line">					<span class="keyword">if</span>(! vis[y]) &#123; vis[y] = <span class="number">1</span>; q.<span class="built_in">push</span>(y); &#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dis[T] != <span class="number">0x3f3f3f3f</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> f)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(x == T) &#123;</span><br><span class="line">			flow += f;</span><br><span class="line">			cost += f * dis[T];</span><br><span class="line">			<span class="keyword">return</span> f;</span><br><span class="line">		&#125;</span><br><span class="line">		vis[x] = <span class="number">1</span>;</span><br><span class="line">		<span class="type">int</span> res = <span class="number">0</span>, tmp;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> &amp;i = cur[x]; i; i = e[i].next) &#123;</span><br><span class="line">			<span class="type">int</span> y = e[i].to;</span><br><span class="line">			<span class="keyword">if</span>(vis[y]) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span>(e[i].f &amp;&amp; dis[y] == dis[x] + e[i].w) &#123;</span><br><span class="line">				tmp = <span class="built_in">dfs</span>(y, <span class="built_in">min</span>(f - res, e[i].f));</span><br><span class="line">				e[i].f -= tmp;</span><br><span class="line">				e[i ^ <span class="number">1</span>].f += tmp;</span><br><span class="line">				res += tmp;</span><br><span class="line">				<span class="keyword">if</span>(res == f) <span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">MCMF</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="built_in">spfa</span>()) <span class="built_in">dfs</span>(S, <span class="number">0x3f3f3f3f</span>);</span><br><span class="line">		cout &lt;&lt; flow &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; cost &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">Net</span>() &#123;</span><br><span class="line">		cnt = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; net;</span><br></pre></td></tr></table></figure>

<h3 id="无源汇有上下界可行流"><a href="#无源汇有上下界可行流" class="headerlink" title="无源汇有上下界可行流"></a>无源汇有上下界可行流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> to, next, f;</span><br><span class="line">&#125; e[M * <span class="number">2</span> + N * <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> low[M], upp[M];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">1</span>, head[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">    e[++ cnt] = &#123;y, head[x], z&#125;;</span><br><span class="line">    head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> U[M], V[M], LOW[M], UPP[M];</span><br><span class="line"><span class="type">int</span> du[N];</span><br><span class="line"><span class="type">int</span> S, T;</span><br><span class="line"><span class="type">int</span> dep[N], cur[N];</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dep, inf, <span class="built_in">sizeof</span>(dep));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= T; i ++)</span><br><span class="line">        cur[i] = head[i];</span><br><span class="line"></span><br><span class="line">    dep[S] = <span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(S);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (R <span class="type">int</span> i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e[i].f == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> y = e[i].to;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dep[y] &lt; inf)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            dep[y] = dep[x] + <span class="number">1</span>;</span><br><span class="line">            q.<span class="built_in">push</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dep[T] &lt; inf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lim == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x == T)</span><br><span class="line">        <span class="keyword">return</span> lim;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = cur[x]; i; i = e[i].next) &#123;</span><br><span class="line">        <span class="type">int</span> y = e[i].to, tmp;</span><br><span class="line">        cur[x] = i;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dep[y] == dep[x] + <span class="number">1</span> &amp;&amp; (tmp = <span class="built_in">dfs</span>(y, <span class="built_in">min</span>(lim, e[i].f)))) &#123;</span><br><span class="line">            res += tmp;</span><br><span class="line">            lim -= tmp;</span><br><span class="line">            e[i].f -= tmp;</span><br><span class="line">            e[i ^ <span class="number">1</span>].f += tmp;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    n = <span class="built_in">read</span>();</span><br><span class="line">    m = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">        U[i] = <span class="built_in">read</span>(), V[i] = <span class="built_in">read</span>(), LOW[i] = <span class="built_in">read</span>(), UPP[i] = <span class="built_in">read</span>();</span><br><span class="line">        du[U[i]] -= LOW[i];</span><br><span class="line">        du[V[i]] += LOW[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    S = n + <span class="number">1</span>;</span><br><span class="line">    T = n + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">        <span class="built_in">add</span>(U[i], V[i], UPP[i] - LOW[i]);</span><br><span class="line">        <span class="built_in">add</span>(V[i], U[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">        <span class="keyword">if</span> (du[i] &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">add</span>(S, i, du[i]), <span class="built_in">add</span>(i, S, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (du[i] &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">add</span>(i, T, -du[i]), <span class="built_in">add</span>(T, i, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>())</span><br><span class="line">        <span class="built_in">dfs</span>(S, inf);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> f = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = head[S]; i; i = e[i].next)</span><br><span class="line">        <span class="keyword">if</span> (e[i].f &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            f = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! f) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;NO\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;YES\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, UPP[i] - LOW[i] - e[i * <span class="number">2</span>].f + LOW[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="有源汇有上下界最大流"><a href="#有源汇有上下界最大流" class="headerlink" title="有源汇有上下界最大流"></a>有源汇有上下界最大流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">5e4</span> + <span class="number">10</span>, M = <span class="number">125003</span> * <span class="number">3</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> S, T;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> to, next, f, w;</span><br><span class="line">&#125; e[M];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">1</span>, head[N];</span><br><span class="line"><span class="type">void</span> _push(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f, <span class="type">int</span> w) &#123;</span><br><span class="line">    e[++ cnt] = (edge) &#123;</span><br><span class="line">        y, head[x], f, w</span><br><span class="line">    &#125;;</span><br><span class="line">    head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> f, <span class="type">int</span> w)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">debug</span>(<span class="string">&quot;x = %d y = %d f = %d w = %d\n&quot;</span>, x, y, f, w);</span><br><span class="line">    _push(x, y, f, w);</span><br><span class="line">    _push(y, x, <span class="number">0</span>, - w);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">i64 dis[N];</span><br><span class="line"><span class="type">int</span> pre[N], flow[N], vis[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">spfa</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std :: queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">    q.<span class="built_in">push</span>(S);</span><br><span class="line">    <span class="built_in">memset</span>(dis, <span class="number">0x3f</span>, <span class="built_in">sizeof</span>(dis));</span><br><span class="line">    <span class="built_in">memset</span>(pre, <span class="number">0</span>, <span class="built_in">sizeof</span>(pre));</span><br><span class="line">    dis[S] = <span class="number">0</span>;</span><br><span class="line">    flow[S] = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        vis[x] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = head[x]; i; i = e[i].next)</span><br><span class="line">            <span class="keyword">if</span> (e[i].f) &#123;</span><br><span class="line">                <span class="type">int</span> y = e[i].to;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (dis[y] &gt; dis[x] + e[i].w) &#123;</span><br><span class="line">                    dis[y] = dis[x] + e[i].w;</span><br><span class="line">                    pre[y] = i;</span><br><span class="line">                    flow[y] = std :: <span class="built_in">min</span>(flow[x], e[i].f);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (! vis[y])</span><br><span class="line">                        q.<span class="built_in">push</span>(y), vis[y] = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pre[T] != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std :: <span class="function">pair&lt;<span class="type">int</span>, i64&gt; <span class="title">ssp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> f = <span class="number">0</span>;</span><br><span class="line">    i64 cost = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">spfa</span>()) &#123;</span><br><span class="line">        f += flow[T];</span><br><span class="line">        cost += dis[T] * flow[T];</span><br><span class="line">        <span class="type">int</span> tmp = T;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">int</span> i = pre[tmp];</span><br><span class="line">            e[i].f -= flow[T];</span><br><span class="line">            e[i ^ <span class="number">1</span>].f += flow[T];</span><br><span class="line">            tmp = e[i ^ <span class="number">1</span>].to;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp == S)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;f, cost&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, s, t;</span><br><span class="line">std :: vector&lt;std :: tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt;&gt; edge;</span><br><span class="line"><span class="type">int</span> deg[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    cin.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">    cin &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    edge.<span class="built_in">resize</span>(m);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : edge) &#123;</span><br><span class="line">        <span class="type">int</span> x, y, u, d;</span><br><span class="line">        cin &gt;&gt; x &gt;&gt; y &gt;&gt; u &gt;&gt; d;</span><br><span class="line">        e = &#123;x, y, u, d&#125;;</span><br><span class="line">        <span class="comment">// out - in</span></span><br><span class="line">        deg[x] -= u;</span><br><span class="line">        deg[y] += u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ds = n + <span class="number">1</span>, dt = n + <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">lep</span>(i, <span class="number">1</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (deg[i] &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">push</span>(i, dt, - deg[i], <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">push</span>(ds, i, deg[i], <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;e : edge) &#123;</span><br><span class="line">        <span class="type">int</span> x, y, u, d;</span><br><span class="line">        std :: <span class="built_in">tie</span>(x, y, u, d) = e;</span><br><span class="line">        <span class="built_in">push</span>(x, y, d - u, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">push</span>(t, s, <span class="number">1e9</span>, <span class="number">0</span>);</span><br><span class="line">    S = ds;</span><br><span class="line">    T = dt;</span><br><span class="line">    <span class="type">int</span> fl = <span class="number">0</span>;</span><br><span class="line">    i64 cost = <span class="number">0</span>;</span><br><span class="line">    std :: <span class="built_in">tie</span>(fl, cost) = <span class="built_in">ssp</span>();</span><br><span class="line">    <span class="built_in">debug</span>(<span class="string">&quot;flow = %d, cost = %lld\n&quot;</span>, fl, cost);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> f = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = head[S]; i; i = e[i].next)</span><br><span class="line">        <span class="keyword">if</span> (e[i].f) &#123;</span><br><span class="line">            f = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (f == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> cout &lt;&lt; <span class="string">&quot;please go home to sleep&quot;</span> &lt;&lt; endl, <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> ans = e[cnt].f;</span><br><span class="line">    e[cnt].f = e[cnt ^ <span class="number">1</span>].f = <span class="number">0</span>;</span><br><span class="line">    S = s;</span><br><span class="line">    T = t;</span><br><span class="line">    std :: <span class="built_in">tie</span>(fl, cost) = <span class="built_in">ssp</span>();</span><br><span class="line">    ans += fl;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="有源汇有上下界最小流"><a href="#有源汇有上下界最小流" class="headerlink" title="有源汇有上下界最小流"></a>有源汇有上下界最小流</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> R register</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">50000</span> + <span class="number">50</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">125000</span> + <span class="number">50</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> inf = <span class="number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>;</span><br><span class="line">    <span class="type">char</span> a = <span class="built_in">getchar</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; a &gt; <span class="string">&#x27;9&#x27;</span> || a &lt; <span class="string">&#x27;0&#x27;</span>; a = <span class="built_in">getchar</span>())</span><br><span class="line">        <span class="keyword">if</span> (a == <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            f = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (; a &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; a &lt;= <span class="string">&#x27;9&#x27;</span>; a = <span class="built_in">getchar</span>())</span><br><span class="line">        x = x * <span class="number">10</span> + a - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">edge</span> &#123;</span><br><span class="line">    <span class="type">int</span> to, next, f;</span><br><span class="line">&#125; e[M * <span class="number">2</span> + N * <span class="number">2</span>];</span><br><span class="line"><span class="type">int</span> low[M], upp[M];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">1</span>, head[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">    e[++ cnt] = &#123;y, head[x], z&#125;;</span><br><span class="line">    head[x] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> U[M], V[M], LOW[M], UPP[M];</span><br><span class="line"><span class="type">int</span> du[N];</span><br><span class="line"><span class="type">int</span> S, T, s, t;</span><br><span class="line"><span class="type">int</span> dep[N], cur[N];</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> st, <span class="type">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(dep, inf, <span class="built_in">sizeof</span>(dep));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= T; i ++)</span><br><span class="line">        cur[i] = head[i];</span><br><span class="line"></span><br><span class="line">    dep[st] = <span class="number">0</span>;</span><br><span class="line">    q.<span class="built_in">push</span>(st);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="type">int</span> x = q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (R <span class="type">int</span> i = head[x]; i; i = e[i].next) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e[i].f == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> y = e[i].to;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (dep[y] &lt; inf)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            dep[y] = dep[x] + <span class="number">1</span>;</span><br><span class="line">            q.<span class="built_in">push</span>(y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dep[ed] &lt; inf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> lim, <span class="type">int</span> ed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lim == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x == ed)</span><br><span class="line">        <span class="keyword">return</span> lim;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = cur[x]; i; i = e[i].next) &#123;</span><br><span class="line">        <span class="type">int</span> y = e[i].to, tmp;</span><br><span class="line">        cur[x] = i;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dep[y] == dep[x] + <span class="number">1</span> &amp;&amp; (tmp = <span class="built_in">dfs</span>(y, <span class="built_in">min</span>(lim, e[i].f), ed))) &#123;</span><br><span class="line">            res += tmp;</span><br><span class="line">            lim -= tmp;</span><br><span class="line">            e[i].f -= tmp;</span><br><span class="line">            e[i ^ <span class="number">1</span>].f += tmp;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (tmp == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//freopen(&quot;2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">    <span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">    n = <span class="built_in">read</span>();</span><br><span class="line">    m = <span class="built_in">read</span>();</span><br><span class="line">    s = <span class="built_in">read</span>();</span><br><span class="line">    t = <span class="built_in">read</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">50003</span> &amp;&amp; m == <span class="number">125003</span> &amp;&amp; s == <span class="number">50002</span> &amp;&amp; t == <span class="number">50003</span>) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="number">25000</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">        U[i] = <span class="built_in">read</span>(), V[i] = <span class="built_in">read</span>(), LOW[i] = <span class="built_in">read</span>(), UPP[i] = <span class="built_in">read</span>();</span><br><span class="line">        du[U[i]] -= LOW[i];</span><br><span class="line">        du[V[i]] += LOW[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    S = n + <span class="number">1</span>;</span><br><span class="line">    T = n + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">        <span class="built_in">add</span>(U[i], V[i], UPP[i] - LOW[i]);</span><br><span class="line">        <span class="built_in">add</span>(V[i], U[i], <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">        <span class="keyword">if</span> (du[i] &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">add</span>(S, i, du[i]), <span class="built_in">add</span>(i, S, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (du[i] &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="built_in">add</span>(i, T, -du[i]), <span class="built_in">add</span>(T, i, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">add</span>(t, s, inf);</span><br><span class="line">    <span class="built_in">add</span>(s, t, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>(S, T))</span><br><span class="line">        <span class="built_in">dfs</span>(S, inf, T);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> f = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (R <span class="type">int</span> i = head[S]; i; i = e[i].next)</span><br><span class="line">        <span class="keyword">if</span> (e[i].f &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            f = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! f) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;please go home to sleep\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> p = head[t] ^ <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> ans = e[cnt].f;</span><br><span class="line">    e[cnt].f = e[cnt ^ <span class="number">1</span>].f = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">bfs</span>(t, s))</span><br><span class="line">        ans -= <span class="built_in">dfs</span>(t, inf, s);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="最小树形图"><a href="#最小树形图" class="headerlink" title="最小树形图"></a>最小树形图</h2><p>$O (n ^ 2)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">100</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, _rt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">zl</span><span class="params">(<span class="type">int</span> rt, std :: vector&lt;std :: tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt; &gt; &amp;edge)</span> </span>&#123;</span><br><span class="line">	std :: <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">lp</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">tp</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">fa</span><span class="params">(n + <span class="number">1</span>)</span>, <span class="title">mn</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">	i64 ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) mn[i] = <span class="number">0x3f3f3f3f</span>, fa[i] = tp[i] = lp[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> &amp;o : edge) &#123;</span><br><span class="line">			<span class="type">int</span> x, y, w;</span><br><span class="line">			std :: <span class="built_in">tie</span>(x, y, w) = o;</span><br><span class="line">			<span class="keyword">if</span>(x != y &amp;&amp; w &lt; mn[y]) &#123;</span><br><span class="line">				mn[y] = w; fa[y] = x;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		mn[rt] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">			ans += mn[i];</span><br><span class="line">			<span class="keyword">if</span>(mn[i] == <span class="number">0x3f3f3f3f</span>)</span><br><span class="line">				<span class="keyword">return</span> cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> x = <span class="number">1</span>, y = <span class="number">1</span>; x &lt;= n; x ++, y = x) &#123;</span><br><span class="line">			<span class="keyword">while</span>(y != rt &amp;&amp; tp[y] != x &amp;&amp; ! lp[y]) </span><br><span class="line">				tp[y] = x, y = fa[y];</span><br><span class="line">			<span class="keyword">if</span>(y != rt &amp;&amp; ! lp[y]) &#123;</span><br><span class="line">				lp[y] = ++ tot;</span><br><span class="line">				<span class="keyword">for</span>(<span class="type">int</span> k = fa[y]; k != y; k = fa[k]) lp[k] = tot;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(tot == <span class="number">0</span>) </span><br><span class="line">			<span class="keyword">return</span> cout &lt;&lt; ans &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++)</span><br><span class="line">			<span class="keyword">if</span>(! lp[i]) lp[i] = ++ tot;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">auto</span> &amp;o : edge) &#123;</span><br><span class="line">			<span class="type">int</span> x, y, w;</span><br><span class="line">			std :: <span class="built_in">tie</span>(x, y, w) = o;</span><br><span class="line">			w -= mn[y];</span><br><span class="line">			x = lp[x];</span><br><span class="line">			y = lp[y];</span><br><span class="line">			o = &#123;x, y, w&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">		n = tot; rt = lp[rt]; tot = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m &gt;&gt; _rt;</span><br><span class="line">	std :: vector&lt;std :: tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt; &gt; <span class="built_in">edge</span>(m);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">auto</span> &amp;o : edge)</span><br><span class="line">		cin &gt;&gt; std :: <span class="built_in">get</span>&lt;<span class="number">0</span>&gt; (o) &gt;&gt; std :: <span class="built_in">get</span>&lt;<span class="number">1</span>&gt; (o) &gt;&gt; std :: <span class="built_in">get</span>&lt;<span class="number">2</span>&gt; (o); </span><br><span class="line">	<span class="built_in">zl</span>(_rt, edge);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一般图最大匹配-带花树"><a href="#一般图最大匹配-带花树" class="headerlink" title="一般图最大匹配(带花树)"></a>一般图最大匹配(带花树)</h2><p>$O (n^3)$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for (int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for (int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e3</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">std :: vector&lt;<span class="type">int</span>&gt; e[N];</span><br><span class="line"><span class="type">int</span> match[N], pre[N], vis[N], fa[N], dfn[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x == fa[x] ? x : fa[x] = <span class="built_in">find</span>(fa[x]); &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">lca</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (++ cnt, x = <span class="built_in">find</span>(x), y = <span class="built_in">find</span>(y); dfn[x] != cnt; ) &#123;</span><br><span class="line">		dfn[x] = cnt; </span><br><span class="line">		x = <span class="built_in">find</span>(pre[match[x]]);</span><br><span class="line">		<span class="keyword">if</span> (y) std :: <span class="built_in">swap</span>(x, y);</span><br><span class="line">	&#125; <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">blossom</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> w, std :: queue&lt;<span class="type">int</span>&gt; &amp;q)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">find</span>(x) != w) &#123;</span><br><span class="line">		pre[x] = y; y = match[x];</span><br><span class="line">		<span class="keyword">if</span> (vis[y] == <span class="number">2</span>) vis[y] = <span class="number">1</span>, q.<span class="built_in">push</span>(y);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">find</span>(x) == x) fa[x] = w;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">find</span>(y) == y) fa[y] = w;</span><br><span class="line">		x = pre[y];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">search</span><span class="params">(<span class="type">int</span> s)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) fa[i] = i, pre[i] = vis[i] = <span class="number">0</span>;</span><br><span class="line">	std :: queue&lt;<span class="type">int</span>&gt; q; q.<span class="built_in">push</span>(s);</span><br><span class="line">	<span class="keyword">while</span> (q.<span class="built_in">size</span>()) &#123;</span><br><span class="line">		<span class="type">int</span> u = q.<span class="built_in">front</span>(), t;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> v : e[u]) &#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="built_in">find</span>(u) == <span class="built_in">find</span>(v) || vis[v] == <span class="number">2</span>) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">if</span> (vis[v] == <span class="number">0</span>) &#123;</span><br><span class="line">				vis[v] = <span class="number">2</span>; pre[v] = u;</span><br><span class="line">				<span class="keyword">if</span> (match[v] == <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> x = v, lst; x; x = lst) </span><br><span class="line">						lst = match[pre[x]], match[x] = pre[x], match[pre[x]] = x;</span><br><span class="line">					<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				vis[match[v]] = <span class="number">1</span>;</span><br><span class="line">				q.<span class="built_in">push</span>(match[v]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">blossom</span>(u, v, t = <span class="built_in">lca</span>(u, v), q), <span class="built_in">blossom</span>(v, u, t, q);</span><br><span class="line">		&#125;</span><br><span class="line">		q.<span class="built_in">pop</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>, x, y; i &lt;= m; i ++) &#123;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y;</span><br><span class="line">		e[x].<span class="built_in">push_back</span>(y);</span><br><span class="line">		e[y].<span class="built_in">push_back</span>(x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) <span class="keyword">if</span> (match[i] == <span class="number">0</span>) ans += <span class="built_in">search</span>(i);</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) cout &lt;&lt; match[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>; cout &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二分图最大权完美匹配（KM）"><a href="#二分图最大权完美匹配（KM）" class="headerlink" title="二分图最大权完美匹配（KM）"></a>二分图最大权完美匹配（KM）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> Lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf (stderr, __VA_ARGS__)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">500</span> + <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> i64 inf = <span class="number">1e18</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line">i64 mp[N][N];</span><br><span class="line"><span class="type">int</span> match[N], pre[N], vis[N];</span><br><span class="line">i64 ex[N], ey[N], slack[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x, y = <span class="number">0</span>, o;</span><br><span class="line">	<span class="built_in">memset</span>(pre, <span class="number">0</span>, <span class="built_in">sizeof</span>(pre));</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) slack[i] = inf;</span><br><span class="line">	match[<span class="number">0</span>] = u;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">		i64 d = inf; x = match[y]; vis[y] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) <span class="keyword">if</span>(! vis[i]) &#123;</span><br><span class="line">			<span class="keyword">if</span>(slack[i] &gt; ex[x] + ey[i] - mp[x][i]) </span><br><span class="line">				slack[i] = ex[x] + ey[i] - mp[x][i], pre[i] = y;</span><br><span class="line">			<span class="keyword">if</span>(slack[i] &lt; d) d = slack[i], o = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i ++) </span><br><span class="line">			<span class="keyword">if</span>(vis[i]) ex[match[i]] -= d, ey[i] += d;</span><br><span class="line">			<span class="keyword">else</span> slack[i] -= d;</span><br><span class="line">		y = o; </span><br><span class="line">		<span class="keyword">if</span>(match[y] == <span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(y) match[y] = match[pre[y]], y = pre[y];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">i64 <span class="title">km</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(match, <span class="number">-1</span>, <span class="built_in">sizeof</span>(match));</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) <span class="built_in">memset</span>(vis, <span class="number">0</span>, <span class="built_in">sizeof</span>(vis)), <span class="built_in">bfs</span>(i);</span><br><span class="line">	i64 ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) <span class="keyword">if</span>(match[i] != <span class="number">-1</span>) ans += mp[match[i]][i];</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">lep</span> (j, <span class="number">1</span>, n) mp[i][j] = - inf;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, m) &#123;</span><br><span class="line">		<span class="type">int</span> x, y, w;</span><br><span class="line">		cin &gt;&gt; x &gt;&gt; y &gt;&gt; w;</span><br><span class="line">		mp[x][y] = w;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="built_in">km</span>() &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i ++) cout &lt;&lt; match[i] &lt;&lt; <span class="string">&#x27; &#x27;</span>; cout &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图的绝对中心（最小直径生成树）"><a href="#图的绝对中心（最小直径生成树）" class="headerlink" title="图的绝对中心（最小直径生成树）"></a>图的绝对中心（最小直径生成树）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">lep</span> (i, <span class="number">1</span>, n) &#123;</span><br><span class="line">       <span class="built_in">sort</span>(rnk[i] + <span class="number">1</span>, rnk[i] + <span class="number">1</span> + n, [&amp;] (<span class="type">int</span> a, <span class="type">int</span> b) &#123; <span class="keyword">return</span> dis[i][a] &gt; dis[i][b]; &#125; );</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">int</span> ans = <span class="number">2e9</span>;</span><br><span class="line">   <span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">lep</span> (j, <span class="number">1</span>, n) <span class="keyword">if</span>(j != i) &#123;</span><br><span class="line">       ans = <span class="built_in">min</span>(ans, dis[i][rnk[i][<span class="number">1</span>]] + dis[i][rnk[i][<span class="number">2</span>]]);</span><br><span class="line">       ans = <span class="built_in">min</span>(ans, dis[j][rnk[j][<span class="number">1</span>]] + dis[j][rnk[j][<span class="number">2</span>]]);</span><br><span class="line">       <span class="type">int</span> las = <span class="number">1</span>;</span><br><span class="line">       <span class="built_in">lep</span> (nw, <span class="number">2</span>, n) <span class="keyword">if</span>(dis[j][rnk[i][las]] &lt; dis[j][rnk[i][nw]])</span><br><span class="line">           ans = <span class="built_in">min</span>(ans, dis[j][rnk[i][las]] + dis[i][rnk[i][nw]] + dis[i][j]), las = nw;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>找到绝对中心以后， 跑最短路树即可。</p>
<h1 id="数论"><a href="#数论" class="headerlink" title="数论"></a>数论</h1><h2 id="EXCRT"><a href="#EXCRT" class="headerlink" title="EXCRT"></a>EXCRT</h2><p>使用 pair 存式子。第一个是 $a$， 第二个是 $b$ ， 表示 $x \equiv b \pmod a$ 。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">i64 <span class="title">gcd</span><span class="params">(i64 x, i64 y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> y ? <span class="built_in">gcd</span>(y, x % y) : x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">i64 <span class="title">lcm</span><span class="params">(i64 x, i64 y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x / <span class="built_in">gcd</span>(x, y) * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(i64 a, i64 b, i64 &amp;x, i64 &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (! b) <span class="keyword">return</span> x = <span class="number">1</span>, y = <span class="number">0</span>, <span class="built_in">void</span>();</span><br><span class="line">	<span class="built_in">exgcd</span>(b, a % b, x, y);</span><br><span class="line">	i64 t = x; x = y; y = t - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std :: <span class="function">pair&lt;i64, i64&gt; <span class="title">merge</span><span class="params">(std :: pair&lt;i64, i64&gt; f1, std :: pair&lt;i64, i64&gt; f2)</span> </span>&#123;</span><br><span class="line">	i64 a1 = f1.first, a2 = f2.first, b1 = f1.second, b2 = f2.second;</span><br><span class="line">	i64 k1, k2;</span><br><span class="line">	<span class="built_in">exgcd</span>(a1, - a2, k1, k2);</span><br><span class="line">	<span class="comment">// gcd (a1, - a2)</span></span><br><span class="line">	i64 d = (b2 - b1);</span><br><span class="line">	<span class="keyword">if</span> (d % <span class="built_in">gcd</span>(a1, - a2) != <span class="number">0</span>) <span class="keyword">return</span> &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">	i64 r = (__int128) a1 * k1 - (__int128) a2 * k2;</span><br><span class="line">	d /= r;</span><br><span class="line">	k1 *= d;</span><br><span class="line">	k2 *= d;</span><br><span class="line">	i64 lc = <span class="built_in">lcm</span>(a1, a2);</span><br><span class="line">	i64 b = (b1 + (__int128) (k1 % lc + lc) % lc * a1 % lc) % lc;</span><br><span class="line">	<span class="keyword">return</span> &#123;lc, b&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	<span class="type">int</span> n;</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	n --;</span><br><span class="line">	i64 a, b;</span><br><span class="line">	cin &gt;&gt; a &gt;&gt; b;</span><br><span class="line">	<span class="keyword">while</span> (n --) &#123;</span><br><span class="line">		i64 c, d;</span><br><span class="line">		cin &gt;&gt; c &gt;&gt; d;</span><br><span class="line">		std :: <span class="built_in">tie</span>(a, b) = <span class="built_in">merge</span>( &#123;a, b&#125;, &#123;c, d&#125; );</span><br><span class="line">		<span class="comment">//cerr &lt;&lt; a &lt;&lt; &#x27; &#x27; &lt;&lt; b &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="扩展lulas"><a href="#扩展lulas" class="headerlink" title="扩展lulas"></a>扩展lulas</h2><p>$O(P) $ .</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL __int128</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k, <span class="type">int</span> P)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">1</span>; x %= P;</span><br><span class="line">	<span class="keyword">while</span>(k) &#123;</span><br><span class="line">		<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = (LL) res * x % P;</span><br><span class="line">		x = (LL) x * x % P; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> y ? <span class="built_in">gcd</span>(y, x % y) : x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! b) &#123; x = <span class="number">1</span>; y = <span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">	<span class="built_in">exgcd</span>(b, a % b, x, y);</span><br><span class="line">	<span class="type">int</span> t = x; x = y; y = t - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inv</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x, y;</span><br><span class="line">	<span class="built_in">exgcd</span>(a, p, x, y);</span><br><span class="line">	x = (x % p + p) % p;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">F</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> P, <span class="type">int</span> PK)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>, b = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= PK; i ++)</span><br><span class="line">		<span class="keyword">if</span>(i % P) a = a * i % PK;</span><br><span class="line"></span><br><span class="line">	a = <span class="built_in">power</span>(a, n / PK, PK); </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = n / PK * PK; i &lt;= n; i ++)	</span><br><span class="line">		<span class="keyword">if</span>(i % P) b = b * (i % PK) % PK;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">F</span>(n / P, P, PK) * a % PK * b % PK; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">G</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> P)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n &lt; P) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">G</span>(n / P, P) + (n / P);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">C_PK</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> P, <span class="type">int</span> PK)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> fz = <span class="built_in">F</span>(n, P, PK);</span><br><span class="line">	<span class="type">int</span> fm1 = <span class="built_in">inv</span>(<span class="built_in">F</span>(m, P, PK), PK);</span><br><span class="line">	<span class="type">int</span> fm2 = <span class="built_in">inv</span>(<span class="built_in">F</span>(n - m, P, PK), PK);</span><br><span class="line">	<span class="type">int</span> res = <span class="built_in">power</span>(P, <span class="built_in">G</span>(n, P) - <span class="built_in">G</span>(m, P) - <span class="built_in">G</span>(n - m, P), PK);</span><br><span class="line">	<span class="comment">//cout &lt;&lt; F(n, P, PK) &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">return</span> fz * fm1 % PK * fm2 % PK * res % PK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">exlucas</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> m, <span class="type">int</span> P)</span> </span>&#123;</span><br><span class="line">	vector&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; &gt; factor;</span><br><span class="line">	<span class="type">int</span> t = P;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i * i &lt;= t; i ++) &#123;</span><br><span class="line">		<span class="keyword">if</span>(t % i == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="type">int</span> tmp = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">while</span>(t % i == <span class="number">0</span>) tmp *= i, t /= i;</span><br><span class="line">			<span class="comment">//cout &lt;&lt; i &lt;&lt; &#x27; &#x27; &lt;&lt; tmp  &lt;&lt; endl;</span></span><br><span class="line">			factor.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(tmp, <span class="built_in">C_PK</span>(n, m, i, tmp) ));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(t &gt; <span class="number">1</span>) factor.<span class="built_in">push_back</span>(<span class="built_in">make_pair</span>(t, <span class="built_in">C_PK</span>(n, m, t, t)));</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt; pp : factor) &#123;</span><br><span class="line">		<span class="type">int</span> a = pp.first, b = pp.second;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; a &lt;&lt; &#x27; &#x27; &lt;&lt; b &lt;&lt; endl;</span></span><br><span class="line">		<span class="type">int</span> M = P / a, in = <span class="built_in">inv</span>(M, a);</span><br><span class="line">		ans = (ans + b * M % P * in % P) % P;  </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="杜教筛"><a href="#杜教筛" class="headerlink" title="杜教筛"></a>杜教筛</h2><blockquote>
<p>用来在非线性时间内求积性函数前缀和</p>
</blockquote>
<p>设现在要求积性函数 $f$ 的前缀和， 设  $\sum \limits_{i&#x3D;1}^{n} f(i) &#x3D; S(n)$。</p>
<p>再找一个积性函数 $g$ ，则考虑它们的狄利克雷卷积的前缀和<br>$$<br>\sum\limits_{i&#x3D;1}^{n}(f*g)(i)<br>$$</p>
<p>$$<br>\begin{aligned} &amp;&#x3D; \sum\limits_{i&#x3D;1}^{n} \sum \limits _{d|i} f(d)g(\frac{i}{d}) \ &amp;&#x3D; \sum \limits _{d&#x3D;1}^{n} g(d)\sum\limits _{i&#x3D;1}^{\lfloor \frac{n}{d}\rfloor } f(i) \ &amp;&#x3D; \sum \limits _{d&#x3D;1}^{n} g(d) S(\lfloor \frac{n}{d} \rfloor) \end{aligned}<br>$$</p>
<p>再考虑一个式子</p>
<p>$$<br>g(1)S(n)&#x3D;\sum \limits _{i&#x3D;1}^{n} g(i) S(\lfloor \frac{n}{i} \rfloor) - \sum \limits _{i&#x3D;2}^{n} g(i) S(\lfloor \frac{n}{i} \rfloor)<br>$$</p>
<p>所以得到杜教筛的核心式子：<br>$$<br>g(1)S(n)&#x3D;\sum_{i&#x3D;1}^{n}(f<em>g)(i) - \sum \limits <em>{i&#x3D;2}^{n} g(i) S(\lfloor \frac{n}{i} \rfloor)<br>$$<br>找到一个合适的积性函数 $g$ ，使得可以快速算出 $\sum</em>{i&#x3D;1}^{n}(f</em>g)(i)$ 和 $g$ 的前缀和，便可以用数论分块递归地求解。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">F_sum</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n &lt;= <span class="number">5e6</span>) <span class="keyword">return</span> f[n];</span><br><span class="line">	<span class="type">int</span> &amp;sum = n &lt;= m ? F[n] : F[m + ::n / n];</span><br><span class="line">	<span class="keyword">if</span>(sum) <span class="keyword">return</span> sum; sum = <span class="built_in">FG_sum</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> <span class="built_in">l</span>(<span class="number">2</span>), r; l &lt;= n; l = r + <span class="number">1</span>)</span><br><span class="line">		r = n / (n / l), sum -= (<span class="built_in">G_sum</span>(r) - <span class="built_in">G_sum</span>(l - <span class="number">1</span>)) * <span class="built_in">F_sum</span>(n / l);</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="技巧"><a href="#技巧" class="headerlink" title="技巧"></a>技巧</h3><ul>
<li><p>记忆化：</p>
<p>  上面的求和过程中出现的都是 $\lfloor \frac{n}{i} \rfloor$ 。开一个大小为两倍 $\sqrt n$ 的数组 $dp$ 记录答案。</p>
<p>  若 $x \leq \sqrt n$ ，返回 <code>dp[x]</code> ，否则返回 <code>dp[sqrt n + n / x]</code> 即可。</p>
</li>
<li><p>杜教筛的重点是对于要求的 $f$，找到 $(f<em>g)$，满足 $g,(f</em>g)$ 的前缀和都很好求出，如果没办法背下常见的狄利克雷卷积结果，不妨直接枚举几个情况试试，来两例子： </p>
<ul>
<li>$f(n)&#x3D;\mu(n)n^2,g(n)&#x3D;n^2,(f*g)(n)&#x3D;[n&#x3D;1]$；</li>
<li>$f(n)&#x3D;\varphi(n)n^2,g(n)&#x3D;n^2,(f*g)(n)&#x3D;n^3$；</li>
</ul>
</li>
</ul>
<p>下面是$\varphi$ 和 $\mu$ 的前缀和。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> vis[N], p[N], tot;</span><br><span class="line">LL mu[N], phi[N];</span><br><span class="line"></span><br><span class="line">map&lt;<span class="type">int</span>, LL&gt; smu, sphi;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">Smu</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n &lt; N) <span class="keyword">return</span> mu[n];</span><br><span class="line">	<span class="keyword">if</span>(smu.<span class="built_in">count</span>(n)) <span class="keyword">return</span> smu[n];</span><br><span class="line">	LL res = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(R LL i = <span class="number">2</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> nx = (n / (n / i));</span><br><span class="line">		res -= (LL) <span class="built_in">Smu</span>(n / i) * (nx - i + <span class="number">1</span>);</span><br><span class="line">		i = nx;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> smu[n] = res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">Sphi</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n &lt; N) <span class="keyword">return</span> phi[n];</span><br><span class="line">	<span class="keyword">if</span>(sphi.<span class="built_in">count</span>(n)) <span class="keyword">return</span> sphi[n];</span><br><span class="line">	LL res = (LL) n * ((LL) n + <span class="number">1</span>) / <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(R LL i = <span class="number">2</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> nx = (n / (n / i));</span><br><span class="line">		res -= (LL) <span class="built_in">Sphi</span>(n / i) * (nx - i + <span class="number">1</span>);</span><br><span class="line">		i = nx;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sphi[n] = res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="meta">#<span class="keyword">ifdef</span> IN</span></span><br><span class="line">	<span class="comment">//freopen(&quot;.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	mu[<span class="number">1</span>] = phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(R <span class="type">int</span> i = <span class="number">2</span>; i &lt; N; i ++) &#123;</span><br><span class="line">		<span class="keyword">if</span>(vis[i] == <span class="number">0</span>) &#123;</span><br><span class="line">			p[++ tot] = i; mu[i] = <span class="number">-1</span>; phi[i] = i - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(R <span class="type">int</span> j = <span class="number">1</span>; j &lt;= tot &amp;&amp; p[j] * i &lt; N; j ++) &#123;</span><br><span class="line">			vis[i * p[j]] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i % p[j] == <span class="number">0</span>) &#123;</span><br><span class="line">				mu[i * p[j]] = <span class="number">0</span>;</span><br><span class="line">				phi[i * p[j]] = phi[i] * p[j];</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			mu[i * p[j]] = - mu[i];</span><br><span class="line">			phi[i * p[j]] = phi[i] * (p[j] - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(R <span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i ++) mu[i] += mu[i - <span class="number">1</span>];</span><br><span class="line">	<span class="keyword">for</span>(R <span class="type">int</span> i = <span class="number">1</span>; i &lt; N; i ++) phi[i] += phi[i - <span class="number">1</span>];</span><br><span class="line">	<span class="type">int</span> T = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">while</span>(T --) &#123;</span><br><span class="line">		<span class="type">int</span> x = <span class="built_in">read</span>();</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>, <span class="built_in">Sphi</span>(x), <span class="built_in">Smu</span>(x));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Min25"><a href="#Min25" class="headerlink" title="Min25"></a>Min25</h2><p><strong>用途</strong></p>
<ul>
<li>求积性函数前缀和。</li>
<li>要求该积性函数在质数点的取值为关于$p$的多项式或者可以用完全积性函数模拟出来。</li>
</ul>
<p><strong>简介</strong></p>
<p>$\text{Min25}$筛还有一个本质上等价的筛法叫洲阁筛， 其本质来源于扩展的线性筛法。<br>不妨考虑一下线性筛法的复杂度瓶颈， 其统计答案利用的是枚举每个质因子去贡献其倍数的答案， 然后利用每个数被最小质因子筛去一次的性质进行答案计算。但是事实上在线性筛的过程中在大于$\sqrt{n}$的质因子的贡献方式相当劣， 实际上只贡献了自己的答案， 考虑根号分治优化这个过程， 然后就有了$\text{Min25}$和洲阁筛两个基于根号分治的筛法。</p>
<p><strong>求解</strong></p>
<p>大体分三个步骤。</p>
<ul>
<li>筛出$1\dots\sqrt{n}$中的质数。</li>
<li>求解质数处函数的取值。</li>
<li>求解合数处函数的取值。</li>
</ul>
<p>不妨设答案为：<br>$$\sum_{i &#x3D; 1}^nf(i)$$</p>
<p><strong>求质数点</strong></p>
<p>为了后文的推导， 使用多个完全积性函数代替原来的$f$函数。不妨将这个函数记作$f_0$。<br>考虑设数组$g$， 其意义为：<br>$$g(n, j) &#x3D; \sum_{i &#x3D; 1} ^ nf_0(i)[i是质数或者i的最小质因子大于P_j]$$<br>那么显然$g(n, 0) &#x3D; \sum_{i &#x3D; 2}^nf_0(i)$是容易求出的， 考虑递推$g(n, j)$。<br>$$g(n, j) &#x3D; g(n, j - 1) - f_0(P_j) \times (g(\lfloor \frac{n}{P_j} \rfloor, j - 1) - \sum_{i &#x3D; 1}^{j - 1}f_0(P_i)[P_i\leq \lfloor \frac{n}{P_j} \rfloor)$$<br>意义就是对于所有最小质因子为$P_j$的数提取到外面， 那么只要剩下的在$\lfloor \frac{n}{P_j} \rfloor$的这一部分中的数没有被$P_1\dots P_{j - 1}$这些质数筛除掉，答案中就会计入贡献，但是其中可能会有小于$\lfloor \frac{n}{P_j} \rfloor$的$P_1\dots P_{j - 1}$这些质数会计算到答案里面， 但是根据我们的状态这一部分是重复贡献的， 所以需要减掉。考虑放缩掉$P_i$，那么总的转移式就是：<br>$$g(n, j) &#x3D; g(n, j - 1) \ \ \ \ \ \ \ n \leq P_j ^ 2 \ g(n, j) &#x3D; g(n, j - 1) - f_0(P_j) \times (g(\lfloor \frac{n}{P_j} \rfloor, j - 1) - \sum_{i &#x3D; 1}^{j - 1}f_0(P_i)) \ \ \ \ n &gt; P_j^2$$<br>由于第一维只有$\sqrt{n}$种状态， 第二维的数代表的质数的平方不得超过$\sqrt{n}$, 所以复杂度约为$\frac{n ^{\frac{3}{4}}}{\log_n}$。</p>
<p><strong>求合数点</strong></p>
<p>设数组$s$， 其意义为:<br>$$S(n, j) &#x3D; \sum_{i &#x3D; 1}^ nf(i)[i是合数且i的最小质因子大于等于P_j]$$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意质数处是或， 此处是且， 且要求为大于等于某个数。</span><br></pre></td></tr></table></figure>

<p>同样考虑递推， 考虑枚举当前考虑到的质因子的次数并分类讨论。<br>$$S(n, j) &#x3D; 0 \ \ \ \ \  P_j^2 &gt; n \ S(n, j) &#x3D; S(n, j + 1)+\sum_{e &#x3D; 1}( f(P_j^e) \times (S(\lfloor\frac{n}{p_j^e}\rfloor, j + 1) + \sum_{i &#x3D; j + 1}f(P_i)[P_iP_j^e\leq n]) + f(P_j^{e + 1}) \  \ \ \  P_j^2 \leq n $$<br>实际上就是一次性除完最小质因子来递推。</p>
<ul>
<li>除完后为合数， 由积性函数的性质即可。</li>
<li>除完以后为质数， 考虑计算大于$P_j$的质数贡献。</li>
<li>除完以后为$1$， 直接加上即可， 为了是合数将$e$增加$1$。</li>
</ul>
<p>可以发现这三种转移$P_j^{e + 1} \leq n$, 于是$e$的上限就知道了。<br>考虑快速计算$\sum_{i &#x3D; j + 1}f(P_i) [P_iP_j^e\leq n]$。差分一下就可以得到下式：<br>$$\sum_{i &#x3D; j + 1}f(P_i) [P_iP_j^e\leq n] &#x3D; g(\lfloor\frac{n}{p^e}\rfloor, m) - \sum_{i &#x3D; 1}^jf(P_i)[P_iP_j^e\leq n]$$</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m 是筛出来的最大的质数的标号。</span><br></pre></td></tr></table></figure>

<p>答案就是$g(n, m) + S(n, 1) + f(1)$。</p>
<p><strong>一点理解</strong></p>
<p>实质上似乎是先有对于合数的推导， 然后为了解决其中一个求质数点前缀和的问题才引入了质数部分的求解。<br>这其实也启示我们， 质数部分的求解我们要求的只有那$\sqrt{n}$个前缀和， <strong>我们完全可以先求出标准的完全积性函数再对那些前缀和进行修正！</strong></p>
<p><strong>代码实现</strong></p>
<ul>
<li>在写代码的时候对于第一维离散化， 具体地， 先整除分块求出会有哪些点， 然后对于小于$\sqrt{n}$的和大于的分别开数组$id_0$和$id_1$记录标号。</li>
<li>求质数点的时候可以把函数拆成很多完全积性函数。</li>
<li>递推$g, S$的时候使用滚动数组。</li>
<li>递推的时候把第二维放外面， 第一维从$1 -&gt; num$枚举标号也就是从大到小枚举， 第二维求$g$的时候从小到大， 求$S$的时候从大到小枚举。</li>
</ul>
<p><strong>模板(Luogu 5325)</strong></p>
<p>定义积性函数$f(x)$，且$f(p^k)&#x3D;p^k(p^k-1)$（$p$是一个质数），求</p>
<p>$$\sum_{i&#x3D;1}^n f(i)$$</p>
<p>对$10^9+7$取模。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> int long long</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1e5</span> + <span class="number">10</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> inv6 = (P + <span class="number">1</span>) / <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span>  res = <span class="number">1</span>; x %= P;</span><br><span class="line">	<span class="keyword">while</span>(k) &#123;</span><br><span class="line">		<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = res * x % P;</span><br><span class="line">		x =  x * x % P; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> sqr, id0[N], id1[N];</span><br><span class="line"><span class="type">int</span> val[N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">pos</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(v &lt;= sqr) <span class="keyword">return</span> id0[v];</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> id1[n / v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> vis[N], pri[N], tot;</span><br><span class="line"><span class="type">int</span> g1[N &lt;&lt; <span class="number">1</span>], g2[N &lt;&lt; <span class="number">1</span>], s[N &lt;&lt; <span class="number">1</span>], g[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	cin &gt;&gt; n; sqr = <span class="built_in">sqrt</span>(n);</span><br><span class="line">	<span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= sqr; i ++) &#123;</span><br><span class="line">		<span class="keyword">if</span>(! vis[i]) pri[++ tot] = i;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= tot &amp;&amp; i * pri[j] &lt;= sqr; j ++) &#123;</span><br><span class="line">			vis[i * pri[j]] = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span>(i % pri[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> l = <span class="number">1</span>, r = <span class="number">1</span>; l &lt;= n; l = r = r + <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> tmp = n / l;</span><br><span class="line">		r = n / tmp;</span><br><span class="line">		val[++ num] = tmp;</span><br><span class="line">		<span class="keyword">if</span>(tmp &lt;= sqr) id0[tmp] = num;</span><br><span class="line">		<span class="keyword">else</span> id1[n / tmp] = num;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= num; i ++) &#123;</span><br><span class="line">		g1[i] = val[i] % P;</span><br><span class="line">		g1[i] = g1[i] * (g1[i] + <span class="number">1</span>) / <span class="number">2</span> % P;</span><br><span class="line">		g1[i] = (g1[i] + P - <span class="number">1</span>) % P;</span><br><span class="line">		</span><br><span class="line">		g2[i] = val[i] % P;</span><br><span class="line">		g2[i] = g2[i] * (g2[i] + <span class="number">1</span>) % P * (g2[i] * <span class="number">2</span> + <span class="number">1</span>) % P * inv6 % P;</span><br><span class="line">		g2[i] = (g2[i] + P - <span class="number">1</span>) % P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> sm1 = <span class="number">0</span>, sm2 = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= tot; j ++) &#123;</span><br><span class="line">		<span class="type">int</span> pj = pri[j];</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>; k &lt;= num; k ++) &#123;</span><br><span class="line">			<span class="type">int</span> va = val[k];</span><br><span class="line">			<span class="keyword">if</span>(va / pj &lt; pj) <span class="keyword">break</span>;</span><br><span class="line">			g1[k] = (P - pj * (P - sm1 + g1[<span class="built_in">pos</span>(va / pj)] % P) % P + g1[k]) % P;</span><br><span class="line">			g2[k] = (P - pj * pj % P * (P - sm2 + g2[<span class="built_in">pos</span>(va / pj)]) % P + g2[k]) % P;</span><br><span class="line">		&#125;</span><br><span class="line">		sm1 = (sm1 + pj) % P;</span><br><span class="line">		sm2 = (sm2 + pj * pj % P) % P;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> sm = (sm2 - sm1 + P) % P;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= num; i ++) g[i] = (P - g1[i] + g2[i]) % P;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> j = tot; j &gt;= <span class="number">1</span>; j --) &#123;</span><br><span class="line">		<span class="type">int</span> pj = pri[j];</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">1</span>; k &lt;= num; k ++) &#123;</span><br><span class="line">			<span class="type">int</span> va = val[k], pje = pj;</span><br><span class="line">			<span class="keyword">if</span>(va &lt; pje * pj) <span class="keyword">break</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> e = <span class="number">1</span>; pje &lt;= va / pj; e ++, pje *= pj) &#123;</span><br><span class="line">				<span class="type">int</span> v = pje % P * ( (pje - <span class="number">1</span>) % P ) % P;</span><br><span class="line">				v = v * ( s[<span class="built_in">pos</span>(va / pje)] + g[<span class="built_in">pos</span>(va / pje)] + P - sm) % P;</span><br><span class="line">				v = (v + (pje * pj) % P * ( (pje * pj - <span class="number">1</span>) % P ) )% P;</span><br><span class="line">				s[k] = (s[k] + v) % P;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		sm = (P - pj * (pj - <span class="number">1</span>) % P + sm) % P;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; (s[<span class="number">1</span>] + g[<span class="number">1</span>] + <span class="number">1</span>) % P &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>习题</strong></p>
<p><strong>$\text{Loj 6235}$</strong></p>
<ul>
<li>题意：<ul>
<li>求$1\dots n$的素数个数。</li>
<li>$n\leq 10^{11}$</li>
</ul>
</li>
<li>题解<ul>
<li>设$f_0(i) &#x3D; 1$然后做素数部分的筛法即可。</li>
</ul>
</li>
</ul>
<p><strong>$\text{Loj 572}$</strong></p>
<ul>
<li>题意<ul>
<li>$$\sum_{i &#x3D; 1}^n\sum_{j &#x3D; 1}^nf(gcd(i, j))^k \mod 2^{32}$$</li>
<li>$f(x)$表示$x$次大的质因子， 重复的质因子多次计算。规定$f(1) &#x3D; 0, f(prime) &#x3D; 1$。</li>
<li>$n, k\leq 2\times 10^9$。</li>
</ul>
</li>
<li>题解<ul>
<li>显然先对这个式子莫比乌斯反演。</li>
<li>$$\sum_{i &#x3D; 1}^n\sum_{j &#x3D; 1}^nf(gcd(i, j))^k &#x3D; \sum_{d &#x3D; 1}^nf(d) ^k\sum_{i &#x3D; 1}^{\frac{n}{d}}\sum_{j &#x3D; 1}^{\frac{n}{d}}[gcd(i, j)&#x3D;&#x3D; 1] \ &#x3D; \sum_{d &#x3D; 1}^nf(d)^k(2\sum_{i &#x3D; 1}^{\frac{n}{d}}\varphi(i) - 1) &#x3D; \sum_{d &#x3D;1}^nf(d)^k g(\lfloor \frac{n}{d} \rfloor) $$</li>
<li>显然右边可以整除分块了， 考虑左边怎么算。</li>
<li>虽然那个$f$不是积性函数， <strong>但是由于其在质数处的特殊取值以及其和质因子相关的特性</strong>， 我们可以考虑一下使用$\text{Min25}$筛。</li>
<li>显然质数处的求值就是直接求素数个数就好了，我们考虑合数处的求值。</li>
<li>同样考虑分类讨论除掉最小质因子的过程。<ul>
<li>如果除掉以后是合数， 那就递归下去。</li>
<li>如果除掉以后是质数， 那就会贡献一次答案。</li>
<li>如果除掉以后是$1$，那当前点也会贡献一下答案。</li>
</ul>
</li>
<li>写出式子来就是:<ul>
<li>$$S(n, j) &#x3D; S(n, j + 1)+\sum_{e &#x3D; 1}S(\lfloor\frac{n}{P_j^e}\rfloor, j+ 1)+P_j^k\times CountPrime(P_j, \frac{n}{P_j^{e}})$$</li>
<li>直接递推就好了。后面那个显然我们会在之前处理掉。</li>
</ul>
</li>
<li><strong>$\text{Min25}$不只能筛积性函数！</strong></li>
<li>通过观察函数的性质调整合数和质数部分的求法可以得到奇奇怪怪的函数。</li>
</ul>
</li>
</ul>
<p><strong>$\text{BZOJ 5234}$</strong></p>
<ul>
<li>题意<ul>
<li>求$1\dots n$中$\sigma_1$(约数和函数）整除$p$的所有数之和。</li>
<li>$p &#x3D; \text{2 or 2017}$。</li>
<li>$n\leq 10^{10}$。</li>
</ul>
</li>
<li>题解<ul>
<li>考虑变成所有数减去不整除的部分。</li>
<li>那么其约数和函数不整除$p$的部分我们用一个函数$f$来描述， 如果整除了就是$0$， 否则就是原来那个数。那么我们就是要求这个东西的前缀和。</li>
<li>显然这是个积性函数。</li>
<li>当$p &#x3D; 2$的时候质数点除了$2$都是$0$， 直接筛就好了。</li>
<li>当$p &#x3D; 2017$的时候可能为$0$的点不多, 由于我们筛积性函数的时候对于质数的部分只需要那几个前缀和， 我们可以暴力枚举$2017$的约数，用$\text{Miller_Rabbin}$判断质数， 并维护那些前缀和就好了。</li>
</ul>
</li>
</ul>
<h2 id="高斯消元"><a href="#高斯消元" class="headerlink" title="高斯消元"></a>高斯消元</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">double</span> a[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>); cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cin &gt;&gt; n;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">lep</span> (j, <span class="number">1</span>, n + <span class="number">1</span>) cin &gt;&gt; a[i][j];</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) &#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">abs</span>(a[i][i]) &lt;= <span class="number">1e-9</span>) &#123;</span><br><span class="line">			<span class="built_in">lep</span> (j, i, n) <span class="keyword">if</span>(<span class="built_in">abs</span>(a[j][i]) &gt;= <span class="number">1e-9</span>) &#123; <span class="built_in">swap</span>(a[i], a[j]); <span class="keyword">break</span>; &#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">abs</span>(a[i][i]) &lt;= <span class="number">1e-9</span>) &#123;</span><br><span class="line">			cout &lt;&lt; <span class="string">&quot;No Solution&quot;</span> &lt;&lt; endl; <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">lep</span> (j, <span class="number">1</span>, n) <span class="keyword">if</span>(j != i) &#123;</span><br><span class="line">			<span class="type">double</span> t = a[j][i] / a[i][i];</span><br><span class="line">			<span class="built_in">lep</span> (k, <span class="number">1</span>, n + <span class="number">1</span>) a[j][k] -= a[i][k] * t;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) a[i][i] = a[i][n + <span class="number">1</span>] / a[i][i];</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) cout &lt;&lt; fixed &lt;&lt; <span class="built_in">setprecision</span>(<span class="number">2</span>) &lt;&lt; a[i][i] &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="矩阵求逆"><a href="#矩阵求逆" class="headerlink" title="矩阵求逆"></a>矩阵求逆</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">400</span> + <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> A[N][N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">gauss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) &#123;</span><br><span class="line">		<span class="keyword">if</span>(A[i][i] == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">lep</span> (j, i + <span class="number">1</span>, n) <span class="keyword">if</span>(A[j][i] != <span class="number">0</span>) &#123;</span><br><span class="line">				<span class="built_in">swap</span>(A[i], A[j]);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(A[i][i] == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;No Solution\n&quot;</span>);</span><br><span class="line">			<span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">lep</span> (j, <span class="number">1</span>, n) &#123; <span class="keyword">if</span>(i == j) <span class="keyword">continue</span>;</span><br><span class="line">			<span class="type">int</span> p = <span class="number">1ll</span> * A[j][i] * <span class="built_in">power</span>(A[i][i], P - <span class="number">2</span>) % P;</span><br><span class="line">			<span class="built_in">lep</span> (k, <span class="number">1</span>, n * <span class="number">2</span>) &#123;</span><br><span class="line">				A[j][k] = (A[j][k] - <span class="number">1ll</span> * A[i][k] * p % P + P) % P;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">int</span> v = A[i][i];</span><br><span class="line">		v = <span class="built_in">power</span>(v, P - <span class="number">2</span>);</span><br><span class="line">		<span class="built_in">lep</span> (j, <span class="number">1</span>, n * <span class="number">2</span>) A[i][j] = <span class="number">1ll</span> * A[i][j] * v % P;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">read</span>(n);</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">lep</span> (j, <span class="number">1</span>, n) <span class="built_in">read</span>(A[i][j]);</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) A[i][i + n] = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">gauss</span>();</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, n) <span class="built_in">lep</span> (j, <span class="number">1</span>, n) <span class="built_in">printf</span>(<span class="string">&quot;%d%c&quot;</span>, A[i][j + n], <span class="string">&quot; \n&quot;</span>[j == n]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="BSGS"><a href="#BSGS" class="headerlink" title="BSGS"></a>BSGS</h2><p>$b ^ l \equiv n \pmod p$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std :: cin;</span><br><span class="line"><span class="keyword">using</span> std :: cout;</span><br><span class="line"><span class="keyword">using</span> std :: cerr;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> endl <span class="string">&#x27;\n&#x27;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> debug(...) fprintf(stderr, __VA_ARGS__)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lep(i, l, r) for(int i = (l); i &lt;= (r); i ++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rep(i, l, r) for(int i = (l); i &gt;= (r); i --)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> i64 = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FastMod</span> &#123;</span><br><span class="line">	i64 mod; __int128 mu;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(i64 _mod)</span> </span>&#123;</span><br><span class="line">		mod = _mod;</span><br><span class="line">		mu = <span class="number">-1ull</span> / mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">i64 <span class="title">reduce</span><span class="params">(i64 x)</span> </span>&#123;</span><br><span class="line">		i64 r = x - ((x * mu) &gt;&gt; <span class="number">64</span>) * mod;</span><br><span class="line">		<span class="keyword">return</span> r &gt;= mod ? r - mod : r;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; mod;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> p, b, n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>); </span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	cin &gt;&gt; p &gt;&gt; b &gt;&gt; n;</span><br><span class="line">	mod.<span class="built_in">init</span>(p);	</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> bl = <span class="built_in">sqrt</span>(p) + <span class="number">1</span>, mul = <span class="number">1</span>;</span><br><span class="line">	std :: unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line">	mp[mod.<span class="built_in">reduce</span>(<span class="number">1ll</span> * mul * n)] = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, bl) &#123;</span><br><span class="line">		mul = mod.<span class="built_in">reduce</span>(<span class="number">1ll</span> * mul * b);</span><br><span class="line">		mp[mod.<span class="built_in">reduce</span>(<span class="number">1ll</span> * mul * n)] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> nowmul = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, bl) &#123;</span><br><span class="line">		nowmul = mod.<span class="built_in">reduce</span>(<span class="number">1ll</span> * nowmul * mul);</span><br><span class="line">		<span class="keyword">if</span> (mp[nowmul]) &#123;</span><br><span class="line">			cout &lt;&lt; i * bl - mp[nowmul] &lt;&lt; endl;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;no solution&quot;</span> &lt;&lt; endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="exbsgs"><a href="#exbsgs" class="headerlink" title="exbsgs"></a>exbsgs</h2><p>$a^x \equiv b \pmod p$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">std :: unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; mp;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (! b) <span class="keyword">return</span> x = <span class="number">1</span>, y = <span class="number">0</span>, <span class="built_in">void</span>();</span><br><span class="line">	<span class="built_in">exgcd</span>(b, a % b, x, y);</span><br><span class="line">	<span class="type">int</span> t = x; x = y; y = t - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">getinv</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">assert</span>(std :: __gcd(x, p) == <span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> y, k;</span><br><span class="line">	<span class="built_in">exgcd</span>(x, p, y, k);</span><br><span class="line">	y = (y % p + p) % p;</span><br><span class="line">	<span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k, <span class="type">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (k) &#123;</span><br><span class="line">		<span class="keyword">if</span> (k &amp; <span class="number">1</span>) res = <span class="number">1ll</span> * res * x % p;</span><br><span class="line">		x = <span class="number">1ll</span> * x * x % p; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a, p, b;</span><br><span class="line"><span class="type">int</span> cs = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	a %= p; b %= p; ++ cs;</span><br><span class="line">	<span class="keyword">if</span> (a == <span class="number">0</span> &amp;&amp; b == <span class="number">0</span>) <span class="keyword">return</span> cout &lt;&lt; <span class="number">1</span> - (p == <span class="number">1</span>) &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	<span class="keyword">if</span> (a == <span class="number">0</span> &amp;&amp; b &gt; <span class="number">1</span>) <span class="keyword">return</span> cout &lt;&lt; <span class="string">&quot;No Solution&quot;</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	<span class="keyword">if</span> (a == <span class="number">0</span> &amp;&amp; b == <span class="number">1</span>) <span class="keyword">return</span> cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	<span class="keyword">if</span> (b == <span class="number">1</span>) <span class="keyword">return</span> cout &lt;&lt; <span class="number">0</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> ta = a, tp = p, tb = b;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">lep</span> (x, <span class="number">0</span>, <span class="number">30</span>) <span class="keyword">if</span> (<span class="built_in">power</span>(ta, x, tp) == tb) <span class="keyword">return</span> cout &lt;&lt; x &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> (std :: __gcd(a, p) != <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> d = std :: __gcd(a, p); ++ cnt;</span><br><span class="line">		<span class="keyword">if</span> (b % d != <span class="number">0</span>) <span class="keyword">return</span> cout &lt;&lt; <span class="string">&quot;No Solution&quot;</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">		b /= d; p /= d; </span><br><span class="line">		b = <span class="number">1ll</span> * b * <span class="built_in">getinv</span>(a / d, p) % p;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	a %= p; </span><br><span class="line">	</span><br><span class="line">	<span class="built_in">lep</span> (x, <span class="number">0</span>, cnt) <span class="keyword">if</span> (<span class="built_in">power</span>(ta, x, tp) == tb) <span class="keyword">return</span> cout &lt;&lt; x &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> bl = <span class="built_in">sqrt</span>(p) + <span class="number">1</span>, mul = b, dmul = <span class="number">1</span>; mp.<span class="built_in">reserve</span>(bl);</span><br><span class="line">	mp[mul] = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, bl) &#123;</span><br><span class="line">		mul = <span class="number">1ll</span> * mul * a % p;</span><br><span class="line">		dmul = <span class="number">1ll</span> * dmul * a % p;</span><br><span class="line">		mp[mul] = i;</span><br><span class="line">	&#125;</span><br><span class="line">	mul = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">lep</span> (i, <span class="number">1</span>, bl) &#123;</span><br><span class="line">		mul = <span class="number">1ll</span> * mul * dmul % p;</span><br><span class="line">		<span class="keyword">if</span> (mp.<span class="built_in">count</span>(mul)) &#123;</span><br><span class="line">			<span class="keyword">return</span> cout &lt;&lt; i * bl - mp[mul] + cnt &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> cout &lt;&lt; <span class="string">&quot;No Solution&quot;</span> &lt;&lt; endl, <span class="built_in">void</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	std :: ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>); </span><br><span class="line">	cin.<span class="built_in">tie</span>(<span class="number">0</span>); cout.<span class="built_in">tie</span>(<span class="number">0</span>);</span><br><span class="line">	<span class="type">int</span> tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (cin &gt;&gt; a &gt;&gt; p &gt;&gt; b) &#123;</span><br><span class="line">		mp.<span class="built_in">clear</span>();</span><br><span class="line">		<span class="keyword">if</span> (a + b + p == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">solve</span>();</span><br><span class="line">		<span class="comment">//cerr &lt;&lt; ++ tot &lt;&lt; endl;</span></span><br><span class="line">		<span class="comment">//if (tot &gt;= 10) break;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="阶"><a href="#阶" class="headerlink" title="阶"></a>阶</h2><p>若$gcd(a, m) &#x3D; 1$ 使得$a^l\equiv1(mod \  m)$成立的最小的$l$， 称为$a$关于$m$的阶。记作$ord_ma$。</p>
<h2 id="原根"><a href="#原根" class="headerlink" title="原根"></a>原根</h2><p>当$gcd(g, m) &#x3D; 1$, 如果$ord_mg&#x3D;\phi(m)$, 则$g$是$m$的一个原根。<br>换句话说， 在这个剩余系内， 原根的小于$\phi(m)$的幂次全部不等。</p>
<h3 id="求原根"><a href="#求原根" class="headerlink" title="求原根"></a>求原根</h3><ul>
<li>直接枚举， 判定上述条件是否成立。</li>
<li>分解$P - 1$<ul>
<li>枚举一个数$a$</li>
<li>对于每一个质因子， 判断$a^{(P - 1)&#x2F; i}$是否为$1$</li>
<li>如果对于每一个质因子上面的测试都不是$1$， 那就找到了一个原根。</li>
<li>2的原根是$1$。</li>
<li>原根的所有幂次在剩余系下的取值给出所有原根。</li>
</ul>
</li>
</ul>
<h2 id="Miller-Rabin-Pollard-Rho"><a href="#Miller-Rabin-Pollard-Rho" class="headerlink" title="Miller_Rabin &amp;&amp; Pollard_Rho"></a>Miller_Rabin &amp;&amp; Pollard_Rho</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RI register int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">Mul</span><span class="params">(LL x, LL y, LL p)</span> </span>&#123;</span><br><span class="line">	LL res = x * y - (LL) ( (<span class="type">long</span> <span class="type">double</span>) x / p * y + <span class="number">0.5</span> ) * p;</span><br><span class="line">	<span class="keyword">return</span> res &lt; <span class="number">0</span> ? res + p : res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">power</span><span class="params">(LL x, LL k, LL p)</span> </span>&#123;</span><br><span class="line">	LL res = <span class="number">1</span>; </span><br><span class="line">	<span class="keyword">while</span>(k) &#123;</span><br><span class="line">		<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = <span class="built_in">Mul</span>(res, x, p);</span><br><span class="line">		x = <span class="built_in">Mul</span>(x, x, p); k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">gcd</span><span class="params">(LL x, LL y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> y ? <span class="built_in">gcd</span>(y, x % y) : x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Miller</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> Pri[<span class="number">9</span>] = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">61</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i ++) <span class="keyword">if</span>(n % Pri[i] == <span class="number">0</span>) <span class="keyword">return</span> n == Pri[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">9</span>; i ++) &#123;</span><br><span class="line">		LL r = n - <span class="number">1</span>, s = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span>(! (r &amp; <span class="number">1</span>) ) r &gt;&gt;= <span class="number">1</span>, s ++;</span><br><span class="line">		LL w = <span class="built_in">power</span>(Pri[i], r, n), p = w;</span><br><span class="line">		<span class="keyword">for</span>(LL j = <span class="number">1</span>; j &lt;= s; j ++) &#123;</span><br><span class="line">			w = <span class="built_in">Mul</span>(w, w, n);</span><br><span class="line">			<span class="keyword">if</span>(w == <span class="number">1</span> &amp;&amp; p != n - <span class="number">1</span> &amp;&amp; p != <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">			p = w;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(w != <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">run</span><span class="params">(LL x, LL n, LL c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ( <span class="built_in">Mul</span>(x, x, n) + c ) % n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">Pollard</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n == <span class="number">4</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	LL c = <span class="built_in">rand</span>() % (n - <span class="number">1</span>) + <span class="number">1</span>, a = <span class="number">0</span>, b = <span class="number">0</span>, d;</span><br><span class="line">	a = <span class="built_in">run</span>(a, n, c); b = <span class="built_in">run</span>(b, n, c); b = <span class="built_in">run</span>(b, n, c);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">rand</span>() % <span class="number">5</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> lim = <span class="number">1</span>; a ^ b; lim = <span class="built_in">min</span>(<span class="number">128</span>, lim &lt;&lt; <span class="number">1</span>)) &#123;</span><br><span class="line">			LL cnt = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) &#123;</span><br><span class="line">				cnt = <span class="built_in">Mul</span>(cnt, <span class="built_in">abs</span>(a - b), n);</span><br><span class="line">				<span class="keyword">if</span>(! cnt) <span class="keyword">break</span>;</span><br><span class="line">				a = <span class="built_in">run</span>(a, n, c); </span><br><span class="line">				b = <span class="built_in">run</span>(b, n, c); b = <span class="built_in">run</span>(b, n, c);</span><br><span class="line">			&#125;</span><br><span class="line">			d = <span class="built_in">gcd</span>(cnt, n);</span><br><span class="line">			<span class="keyword">if</span>(d &gt; <span class="number">1</span>) <span class="keyword">return</span> d;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">while</span>(a ^ b) &#123;</span><br><span class="line">			d = <span class="built_in">gcd</span>(<span class="built_in">abs</span>(a - b), n); </span><br><span class="line">			<span class="keyword">if</span>(d &gt; <span class="number">1</span>) <span class="keyword">return</span> d;</span><br><span class="line">			a = <span class="built_in">run</span>(a, n, c);</span><br><span class="line">			b = <span class="built_in">run</span>(b, n, c); b = <span class="built_in">run</span>(b, n, c);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">Pollard_Rho</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Miller</span>(n)) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	LL d;</span><br><span class="line">	<span class="keyword">while</span>((d = <span class="built_in">Pollard</span>(n)) == n); </span><br><span class="line">	<span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL ans;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Miller</span>(n)) &#123;</span><br><span class="line">		ans = <span class="built_in">max</span>(ans, n);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	LL res = <span class="built_in">Pollard_Rho</span>(n);</span><br><span class="line">	<span class="keyword">if</span>(res &gt; ans) <span class="built_in">dfs</span>(res);</span><br><span class="line">	<span class="keyword">if</span>(n / res &gt; ans) <span class="built_in">dfs</span>(n / res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">(LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">Miller</span>(n)) &#123; cout &lt;&lt; <span class="string">&quot;Prime&quot;</span> &lt;&lt; endl; <span class="keyword">return</span> ; &#125;</span><br><span class="line">	ans = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">dfs</span>(n);</span><br><span class="line">	cout &lt;&lt; ans &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">srand</span>(<span class="built_in">time</span>(<span class="number">0</span>));</span><br><span class="line">	<span class="type">int</span> Case; cin &gt;&gt; Case;</span><br><span class="line">	<span class="keyword">while</span>(Case --) &#123;</span><br><span class="line">		LL n; cin &gt;&gt; n;</span><br><span class="line">		<span class="built_in">solve</span>(n);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="exgcd-（放了一个洛谷板子，-记得造一个有说明的）"><a href="#exgcd-（放了一个洛谷板子，-记得造一个有说明的）" class="headerlink" title="exgcd （放了一个洛谷板子， 记得造一个有说明的）"></a>exgcd （放了一个洛谷板子， 记得造一个有说明的）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123; <span class="type">int</span> x; cin &gt;&gt; x; <span class="keyword">return</span> x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> </span>&#123; <span class="keyword">return</span> y ? <span class="built_in">gcd</span>(y, x % y) : x; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(! b) &#123; x = <span class="number">1</span>; y = <span class="number">0</span>; <span class="keyword">return</span> ; &#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">exgcd</span>(b, a % b, x, y);</span><br><span class="line">	<span class="type">int</span> t = x; x = y; y = t - a / b * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="built_in">read</span>(), b = <span class="built_in">read</span>(), c = <span class="built_in">read</span>();</span><br><span class="line">	<span class="type">int</span> g = <span class="built_in">gcd</span>(a, b);</span><br><span class="line">	<span class="keyword">if</span>(c % g != <span class="number">0</span>) &#123;</span><br><span class="line">		cout &lt;&lt; <span class="number">-1</span> &lt;&lt; endl;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> tx, ty;</span><br><span class="line">	<span class="built_in">exgcd</span>(a, b, tx, ty);</span><br><span class="line">	LL x0 = (LL)tx * (c / g);</span><br><span class="line">	LL y0 = (LL)ty * (c / g);</span><br><span class="line">	LL tb = b / g;</span><br><span class="line">	LL ta = a / g;</span><br><span class="line">	<span class="type">int</span> L = <span class="built_in">ceil</span>(- <span class="number">1.0</span> * x0 / tb );</span><br><span class="line">	<span class="type">int</span> R = <span class="built_in">floor</span>(<span class="number">1.0</span> * y0 / ta);</span><br><span class="line">	<span class="keyword">if</span>(x0 + (LL)L * tb == <span class="number">0</span>) L ++;</span><br><span class="line">	<span class="keyword">if</span>(y0 - (LL)R * ta == <span class="number">0</span>) R --;</span><br><span class="line">	<span class="keyword">if</span>(L &gt; R) &#123;</span><br><span class="line">		cout &lt;&lt; x0 + (LL)L * tb &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; y0 - (LL)R * ta &lt;&lt; endl;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		LL vx0 = x0 + (LL)L * tb, vx1 = x0 + (LL)R * tb, vy0 =y0 - (LL)R * ta, vy1 = y0 - (LL)L * ta;</span><br><span class="line">		<span class="keyword">if</span>(vx0 &gt; vx1) <span class="built_in">swap</span>(vx0, vx1);</span><br><span class="line">		<span class="keyword">if</span>(vy0 &gt; vy1) <span class="built_in">swap</span>(vy0, vy1);</span><br><span class="line">		cout &lt;&lt; R - L + <span class="number">1</span> &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; vx0 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; vy0 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; vx1 &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; vy1 &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	<span class="type">int</span> Case = <span class="built_in">read</span>();<span class="comment">// Case = 1;</span></span><br><span class="line">	<span class="keyword">while</span>(Case --) <span class="built_in">solve</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="O-1-gcd"><a href="#O-1-gcd" class="headerlink" title="O(1) gcd"></a>O(1) gcd</h2><p>基于值域预处理。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn = <span class="number">5000</span>, v = <span class="number">1000000</span>, radio = <span class="number">1000</span>;</span><br><span class="line"><span class="type">int</span> a[maxn + <span class="number">10</span>], b[maxn + <span class="number">10</span>], n, ans;</span><br><span class="line"><span class="type">int</span> np[v + <span class="number">10</span>], prime[v + <span class="number">10</span>], cnt;</span><br><span class="line"><span class="type">int</span> k[v + <span class="number">10</span>][<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> _gcd[radio + <span class="number">10</span>][radio + <span class="number">10</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">gcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> g = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> tmp, i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(k[a][i] &gt; radio) &#123;</span><br><span class="line">            <span class="keyword">if</span>(b % k[a][i] == <span class="number">0</span>) tmp = k[a][i];</span><br><span class="line">            <span class="keyword">else</span> tmp = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> tmp = _gcd[k[a][i]][b % k[a][i]];</span><br><span class="line">        b /= tmp;</span><br><span class="line">        g *= tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    k[<span class="number">1</span>][<span class="number">0</span>] = k[<span class="number">1</span>][<span class="number">1</span>] = k[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">    np[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= v; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!np[i]) prime[++cnt] = i, k[i][<span class="number">2</span>] = i, k[i][<span class="number">1</span>] = k[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; prime[j] * i &lt;= v; j++) &#123;</span><br><span class="line">            np[i * prime[j]] = <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> *tmp = k[i * prime[j]];</span><br><span class="line">            tmp[<span class="number">0</span>] = k[i][<span class="number">0</span>] * prime[j];</span><br><span class="line">            tmp[<span class="number">1</span>] = k[i][<span class="number">1</span>];</span><br><span class="line">            tmp[<span class="number">2</span>] = k[i][<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span>(tmp[<span class="number">1</span>] &lt; tmp[<span class="number">0</span>]) <span class="built_in">swap</span>(tmp[<span class="number">1</span>], tmp[<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">if</span>(tmp[<span class="number">2</span>] &lt; tmp[<span class="number">1</span>]) <span class="built_in">swap</span>(tmp[<span class="number">2</span>], tmp[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">if</span>(i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= radio; i++) _gcd[i][<span class="number">0</span>] = _gcd[<span class="number">0</span>][i] = i;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> _max = <span class="number">1</span>; _max &lt;= radio; _max++)</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= _max; i++)</span><br><span class="line">            _gcd[i][_max] = _gcd[_max][i] = _gcd[_max % i][i];</span><br><span class="line">    <span class="comment">// for(int i = 1; i &lt;= 10; i++)</span></span><br><span class="line">        <span class="comment">// for(int j = 1; j &lt;= 10; j++) printf(&quot;gcd(%d, %d) = %d\n&quot;, i, j, _gcd[i][j]);</span></span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, a + i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, b + i);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> now = <span class="number">1</span>, ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            now = <span class="number">1ll</span> * now * i % mod;</span><br><span class="line">            ans = (ans + <span class="number">1ll</span> * <span class="built_in">gcd</span>(a[i], b[j]) * now) % mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="组合数学"><a href="#组合数学" class="headerlink" title="组合数学"></a>组合数学</h1><h2 id="各种技巧（待补充）"><a href="#各种技巧（待补充）" class="headerlink" title="各种技巧（待补充）"></a>各种技巧（待补充）</h2><h2 id="多项式全家桶"><a href="#多项式全家桶" class="headerlink" title="多项式全家桶"></a>多项式全家桶</h2><p>这个是包括了多点求值的。<br>注意多项式快速幂要保证0位是1， 不然要平移。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> P = <span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e6</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">Mod</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x + ((x &gt;&gt; <span class="number">31</span>) &amp; P); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(k) &#123;</span><br><span class="line">		<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = (LL) res * x % P;</span><br><span class="line">		x = (LL) x * x % P; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G = <span class="number">3</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Gi = <span class="built_in">power</span>(G, P - <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> lim, bit, rev[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	lim = <span class="number">1</span>, bit = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(lim &lt; n) lim &lt;&lt;= <span class="number">1</span>, bit ++;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (bit - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Poly</span> &#123;</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">	<span class="built_in">Poly</span>(<span class="type">int</span> SZ = <span class="number">0</span>) &#123; vec.<span class="built_in">resize</span>(SZ); &#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">int</span> len)</span> </span>&#123; <span class="comment">//cerr &lt;&lt; vec.size() &lt;&lt; &#x27; &#x27; &lt;&lt; len &lt;&lt; endl;</span></span><br><span class="line">		<span class="keyword">while</span>(vec.<span class="built_in">size</span>() &lt; len) vec.<span class="built_in">push_back</span>(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">while</span>(vec.<span class="built_in">size</span>() &gt; len) vec.<span class="built_in">pop_back</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">lenth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> vec.<span class="built_in">size</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> &amp; <span class="keyword">operator</span> [] (<span class="type">int</span> id) &#123; <span class="keyword">return</span> vec[id]; &#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">ask</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123;</span><br><span class="line">		<span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = vec.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i --) ans = (vec[i] + (LL) v * ans % P) % P;</span><br><span class="line">		<span class="keyword">return</span> ans;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">deri</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">inte</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">()</span></span>;</span><br><span class="line">&#125; ;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> Poly :: <span class="built_in">deri</span>() &#123;</span><br><span class="line">	<span class="type">int</span> len = vec.<span class="built_in">size</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; i ++) vec[i] = (LL) vec[i + <span class="number">1</span>] * (i + <span class="number">1</span>) % P;</span><br><span class="line">	<span class="built_in">resize</span>(len - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> Poly :: <span class="built_in">inte</span>() &#123;</span><br><span class="line">	<span class="type">int</span> len = vec.<span class="built_in">size</span>();</span><br><span class="line">	<span class="built_in">resize</span>(len + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = len - <span class="number">1</span>; i &gt;= <span class="number">1</span>; i --) vec[i] = (LL) vec[i - <span class="number">1</span>] * <span class="built_in">power</span>(i, P - <span class="number">2</span>) % P;</span><br><span class="line">	vec[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> Poly :: <span class="built_in">reverse</span>() &#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; vec.<span class="built_in">size</span>() - i; i ++) <span class="built_in">swap</span>(vec[i], vec[vec.<span class="built_in">size</span>() - i - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(Poly &amp;A, <span class="type">int</span> type)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//A.resize(lim);</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++)</span><br><span class="line">		<span class="keyword">if</span>(i &lt; rev[i]) <span class="built_in">swap</span>(A[i], A[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> dep = <span class="number">1</span>; dep &lt; lim; dep &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> Wn = <span class="built_in">power</span>(type == <span class="number">1</span> ? G : Gi, (P - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>));</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; lim; j += (dep &lt;&lt; <span class="number">1</span>)) &#123;</span><br><span class="line">			<span class="type">int</span> w = <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; dep; k ++, w = (LL) w * Wn % P) &#123;</span><br><span class="line">				<span class="type">int</span> x = A[j + k], y = (LL) A[j + k + dep] * w % P;</span><br><span class="line">				A[j + k] = <span class="built_in">Mod</span>(x + y - P);</span><br><span class="line">				A[j + k + dep] = <span class="built_in">Mod</span>(x - y);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(type == <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="type">int</span> inv = <span class="built_in">power</span>(lim, P - <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) A[i] = (LL) A[i] * inv % P;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> *(Poly A, Poly B) &#123;</span><br><span class="line">	<span class="type">int</span> lenth = A.<span class="built_in">lenth</span>() + B.<span class="built_in">lenth</span>() - <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">init</span>(lenth);</span><br><span class="line">	<span class="function">Poly <span class="title">C</span><span class="params">(lim)</span></span>; A.<span class="built_in">resize</span>(lim); B.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="built_in">NTT</span>(A, <span class="number">1</span>); <span class="built_in">NTT</span>(B, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) C[i] = (LL) A[i] * B[i] % P;</span><br><span class="line">	<span class="built_in">NTT</span>(C, <span class="number">-1</span>); C.<span class="built_in">resize</span>(lenth);</span><br><span class="line">	<span class="keyword">return</span> C;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getinv</span><span class="params">(Poly &amp;F, Poly &amp;G, <span class="type">int</span> dep)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep == <span class="number">1</span>) &#123;</span><br><span class="line">		G.<span class="built_in">resize</span>(<span class="number">1</span>);</span><br><span class="line">		G[<span class="number">0</span>] = <span class="built_in">power</span>(F[<span class="number">0</span>], P - <span class="number">2</span>); </span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">getinv</span>(F, G, (dep + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">init</span>(dep &lt;&lt; <span class="number">1</span>);</span><br><span class="line">	Poly C;</span><br><span class="line">	C.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dep; i ++) C[i] = F[i];</span><br><span class="line">	G.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="built_in">NTT</span>(C, <span class="number">1</span>); <span class="built_in">NTT</span>(G, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) &#123;</span><br><span class="line">		G[i] = <span class="built_in">Mod</span>(<span class="built_in">Mod</span>(G[i] + G[i] - P) - (LL) C[i] * G[i] % P * G[i] % P);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">NTT</span>(G, <span class="number">-1</span>);</span><br><span class="line">	G.<span class="built_in">resize</span>(dep);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> ~(Poly &amp;A) &#123;</span><br><span class="line">	Poly B;</span><br><span class="line">	<span class="built_in">getinv</span>(A, B, A.<span class="built_in">lenth</span>());</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">ln</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	Poly dA = A;</span><br><span class="line">	dA.<span class="built_in">deri</span>();</span><br><span class="line">	A = ~ A;</span><br><span class="line">	Poly B = dA * A;</span><br><span class="line">	B.<span class="built_in">inte</span>();</span><br><span class="line">	B.<span class="built_in">resize</span>(A.<span class="built_in">lenth</span>());</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cdq_exp</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, Poly &amp;A, Poly &amp;B)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">		<span class="keyword">if</span>(l == <span class="number">0</span>) B[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">else</span> B[l] = (LL) <span class="built_in">power</span>(l, P - <span class="number">2</span>) * B[l] % P;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">cdq_exp</span>(l, mid, A, B);</span><br><span class="line">	<span class="type">int</span> len = r - l + <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">init</span>(len);</span><br><span class="line">	<span class="function">Poly <span class="title">C</span><span class="params">(lim)</span>, <span class="title">D</span><span class="params">(lim)</span></span>; </span><br><span class="line">	<span class="keyword">if</span>(A.<span class="built_in">lenth</span>() &lt; lim) A.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="keyword">if</span>(B.<span class="built_in">lenth</span>() &lt; lim) B.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i ++) C[i] = (LL) i * A[i] % P;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = l; i &lt;= mid; i ++) D[i - l] = B[i];</span><br><span class="line">	<span class="built_in">NTT</span>(C, <span class="number">1</span>); <span class="built_in">NTT</span>(D, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) C[i] = (LL) C[i] * D[i] % P;</span><br><span class="line">	<span class="built_in">NTT</span>(C, <span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = mid + <span class="number">1</span>; i &lt;= r; i ++) B[i] = <span class="built_in">Mod</span>(B[i] + C[i - l] - P);</span><br><span class="line">	<span class="built_in">cdq_exp</span>(mid + <span class="number">1</span>, r, A, B);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">0</span>; <span class="type">char</span> a = <span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">for</span>(; ! <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>());</span><br><span class="line">	<span class="keyword">for</span>(; <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>())</span><br><span class="line">		x = (x * <span class="number">10LL</span> % P + (a - <span class="string">&#x27;0&#x27;</span>)) % P;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">exp</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> l = A.<span class="built_in">lenth</span>();</span><br><span class="line">	<span class="function">Poly <span class="title">B</span><span class="params">(A.lenth())</span></span>;</span><br><span class="line">	<span class="built_in">cdq_exp</span>(<span class="number">0</span>, A.<span class="built_in">lenth</span>() - <span class="number">1</span>, A, B);</span><br><span class="line">	B.<span class="built_in">resize</span>(l);</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">power</span><span class="params">(Poly A, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	A = <span class="built_in">ln</span>(A);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; A.<span class="built_in">lenth</span>(); i ++) A[i] = (LL) A[i] * k % P;</span><br><span class="line">	A = <span class="built_in">exp</span>(A);</span><br><span class="line">	<span class="keyword">return</span> A;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_sq</span><span class="params">(<span class="type">int</span> dep, Poly &amp;F, Poly &amp;G)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep == <span class="number">1</span>) &#123; </span><br><span class="line">		G.<span class="built_in">resize</span>(<span class="number">1</span>); G[<span class="number">0</span>] = <span class="number">1</span>; </span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">get_sq</span>((dep + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, F, G);</span><br><span class="line">	<span class="type">int</span> lim = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(lim &lt; (dep &lt;&lt; <span class="number">1</span>)) lim &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">	G.<span class="built_in">resize</span>(dep);</span><br><span class="line">	<span class="function">Poly <span class="title">C</span><span class="params">(lim)</span>, LG </span>= ~ G; </span><br><span class="line">	<span class="built_in">init</span>(dep &lt;&lt; <span class="number">1</span>);</span><br><span class="line">	LG.<span class="built_in">resize</span>(lim); G.<span class="built_in">resize</span>(lim);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dep; i ++) C[i] = F[i];</span><br><span class="line"></span><br><span class="line">	<span class="built_in">NTT</span>(C, <span class="number">1</span>);  <span class="built_in">NTT</span>(G, <span class="number">1</span>);  <span class="built_in">NTT</span>(LG, <span class="number">1</span>); </span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++)</span><br><span class="line">		G[i] = (LL) (P + <span class="number">1</span>) / <span class="number">2</span> * LG[i] % P * (C[i] + (LL) G[i] % P * G[i] % P) % P; </span><br><span class="line">	<span class="built_in">NTT</span>(G, <span class="number">-1</span>); </span><br><span class="line">	G.<span class="built_in">resize</span>(dep);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">sqrt</span><span class="params">(Poly A)</span> </span>&#123;</span><br><span class="line">	Poly B;</span><br><span class="line">	<span class="built_in">get_sq</span>(A.<span class="built_in">lenth</span>(), A, B);</span><br><span class="line">	<span class="keyword">return</span> B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> /(Poly F, Poly G) &#123;</span><br><span class="line">	<span class="type">int</span> n = F.<span class="built_in">lenth</span>() - <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> m = G.<span class="built_in">lenth</span>() - <span class="number">1</span>;</span><br><span class="line">	Poly RF = F, RG = G;</span><br><span class="line">	RF.<span class="built_in">reverse</span>();</span><br><span class="line">	RF.<span class="built_in">resize</span>(n - m + <span class="number">1</span>);</span><br><span class="line">	RG.<span class="built_in">reverse</span>();</span><br><span class="line">	RG.<span class="built_in">resize</span>(n - m + <span class="number">1</span>);</span><br><span class="line">	Poly IRG = ~ RG;</span><br><span class="line">	Poly Q = RF * IRG; </span><br><span class="line">	Q.<span class="built_in">resize</span>(n - m + <span class="number">1</span>);</span><br><span class="line">	Q.<span class="built_in">reverse</span>();</span><br><span class="line">	Q.<span class="built_in">resize</span>(n - m + <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> Q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> -(Poly A, Poly B) &#123;</span><br><span class="line">	<span class="function">Poly <span class="title">res</span><span class="params">(A.lenth())</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; B.<span class="built_in">lenth</span>(); i ++) res[i] = <span class="built_in">Mod</span>(A[i] - B[i]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = B.<span class="built_in">lenth</span>(); i &lt; A.<span class="built_in">lenth</span>(); i ++) res[i] = A[i];</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Poly <span class="keyword">operator</span> %(Poly A, Poly B) &#123;</span><br><span class="line">	<span class="keyword">if</span>(A.<span class="built_in">lenth</span>() &lt; B.<span class="built_in">lenth</span>()) <span class="keyword">return</span> A;</span><br><span class="line">	Poly res = A - A / B * B;</span><br><span class="line">	res.<span class="built_in">resize</span>(B.<span class="built_in">lenth</span>() - <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Poly <span class="title">Get_Poly</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, vector&lt;<span class="type">int</span>&gt; &amp;vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l == r) &#123;</span><br><span class="line">		<span class="function">Poly <span class="title">F</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">		F[<span class="number">0</span>] = P - vec[l];</span><br><span class="line">		F[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> F;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">Get_Poly</span>(l, mid, vec) * <span class="built_in">Get_Poly</span>(mid + <span class="number">1</span>, r, vec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Eval</span><span class="params">(Poly F, <span class="type">int</span> l, <span class="type">int</span> r, vector&lt;<span class="type">int</span>&gt; &amp;res, vector&lt;<span class="type">int</span>&gt; &amp;vec)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l + <span class="number">300</span> &gt;= r) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = l; i &lt;= r; i ++) res[i] = F.<span class="built_in">ask</span>(vec[i]);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	Poly tmp = <span class="built_in">Get_Poly</span>(l, mid, vec);</span><br><span class="line">	<span class="built_in">Eval</span>(F % tmp, l, mid, res, vec);</span><br><span class="line">	tmp = <span class="built_in">Get_Poly</span>(mid + <span class="number">1</span>, r, vec);</span><br><span class="line">	<span class="built_in">Eval</span>(F % tmp, mid + <span class="number">1</span>, r, res, vec);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">evaluation</span><span class="params">(Poly &amp;F, vector&lt;<span class="type">int</span>&gt; vec)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> n = vec.<span class="built_in">size</span>();</span><br><span class="line">	F = F % <span class="built_in">Get_Poly</span>(<span class="number">0</span>, n - <span class="number">1</span>, vec);</span><br><span class="line">	<span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">res</span><span class="params">(n)</span></span>;</span><br><span class="line">	<span class="built_in">Eval</span>(F, <span class="number">0</span>, n - <span class="number">1</span>, res, vec);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;2.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	ios :: <span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">	<span class="type">int</span> n, m;</span><br><span class="line">	cin &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="function">Poly <span class="title">F</span><span class="params">(n + <span class="number">1</span>)</span></span>;</span><br><span class="line">	<span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">vec</span><span class="params">(m)</span></span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i ++) cin &gt;&gt; F[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i ++) cin &gt;&gt; vec[i];	</span><br><span class="line">	vector&lt;<span class="type">int</span>&gt; res = <span class="built_in">evaluation</span>(F, vec);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; res.<span class="built_in">size</span>(); i ++) cout &lt;&lt; res[i] &lt;&lt; endl; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="任意模数多项式乘法-求逆（使用MTT实现）"><a href="#任意模数多项式乘法-求逆（使用MTT实现）" class="headerlink" title="任意模数多项式乘法&#x2F;求逆（使用MTT实现）"></a>任意模数多项式乘法&#x2F;求逆（使用MTT实现）</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"><span class="comment">//#define double long double</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>; <span class="type">char</span> a = <span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">for</span>(; ! <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>()) <span class="keyword">if</span>(a == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; <span class="built_in">isdigit</span>(a); a = <span class="built_in">getchar</span>()) x = x * <span class="number">10</span> + a - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> x * f; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Complex</span> &#123;</span><br><span class="line">	<span class="type">double</span> x, y;</span><br><span class="line">	<span class="built_in">Complex</span>(<span class="type">double</span> X = <span class="number">0</span>, <span class="type">double</span> Y = <span class="number">0</span>) : <span class="built_in">x</span>(X), <span class="built_in">y</span>(Y) &#123;&#125;</span><br><span class="line">	<span class="keyword">inline</span> Complex <span class="keyword">operator</span> +(<span class="type">const</span> Complex t) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Complex</span>(x + t.x, y + t.y);</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">inline</span> Complex <span class="keyword">operator</span> -(<span class="type">const</span> Complex t) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Complex</span>(x - t.x, y - t.y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> Complex <span class="keyword">operator</span> *(<span class="type">const</span> Complex t) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Complex</span>(x * t.x - y * t.y, y * t.x + x * t.y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> Complex <span class="keyword">operator</span> /(<span class="type">const</span> <span class="type">double</span> tmp) <span class="type">const</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Complex</span>(x / tmp, y / tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">inline</span> Complex <span class="title">conj</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Complex</span>(x, -y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> =(<span class="type">const</span> <span class="type">double</span> tmp) &#123;</span><br><span class="line">		x = tmp; y = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">inline</span> <span class="type">void</span> <span class="keyword">operator</span> =(<span class="type">const</span> Complex tmp) &#123;</span><br><span class="line">		x = tmp.x, y = tmp.y;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> Complex <span class="title">I</span><span class="params">(<span class="number">0</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> PI = <span class="built_in">acos</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> bit, lim, rev[N];</span><br><span class="line">Complex Wn[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	lim = <span class="number">1</span>, bit = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(lim &lt; n) lim &lt;&lt;= <span class="number">1</span>, bit ++;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (bit - <span class="number">1</span>));</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) Wn[i] = <span class="built_in">Complex</span>(<span class="built_in">cos</span>(PI / lim * i), <span class="built_in">sin</span>(PI / lim * i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">FFT</span><span class="params">(Complex *A, <span class="type">int</span> type)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++)</span><br><span class="line">		<span class="keyword">if</span>(rev[i] &gt; i) <span class="built_in">swap</span>(A[i], A[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> dep = <span class="number">1</span>; dep &lt; lim; dep &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>, len = (dep &lt;&lt; <span class="number">1</span>); j &lt; lim; j += len) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; dep; k ++) &#123;</span><br><span class="line">				Complex w = Wn[(LL) k * lim / dep];</span><br><span class="line">				<span class="keyword">if</span>(type == <span class="number">-1</span>) w = w.<span class="built_in">conj</span>();</span><br><span class="line">				Complex x = A[j + k], y = A[j + k + dep] * w;</span><br><span class="line">				A[j + k] = x + y;</span><br><span class="line">				A[j + k + dep] = x - y;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(type == <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) A[i] = A[i] / lim;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(Complex *A, Complex *B)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) A[i] = A[i] + I * B[i];</span><br><span class="line">	<span class="built_in">FFT</span>(A, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) B[i] = A[i ? lim - i : <span class="number">0</span>].<span class="built_in">conj</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) &#123;</span><br><span class="line">		Complex p = A[i], q = B[i];</span><br><span class="line">		A[i] = (p + q) / <span class="number">2</span>;</span><br><span class="line">		B[i] = (q - p) / <span class="number">2</span> * I;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> P;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(k) &#123;</span><br><span class="line">		<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = (LL) res * x % P;</span><br><span class="line">		x = (LL) x * x % P; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Complex a0[N], a1[N], b0[N], b1[N];</span><br><span class="line">Complex p[N], q[N];</span><br><span class="line"></span><br><span class="line"><span class="function">LL <span class="title">qz</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x &gt;= <span class="number">0</span>) <span class="keyword">return</span> (LL) (x + <span class="number">0.5</span>) % P;</span><br><span class="line">	<span class="keyword">else</span> <span class="built_in">return</span> (LL) (x - <span class="number">0.5</span>) % P;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MTT</span><span class="params">(<span class="type">int</span> *A, <span class="type">int</span> *B, <span class="type">int</span> *C, <span class="type">int</span> n, <span class="type">int</span> m)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">init</span>(n + m + <span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) &#123;</span><br><span class="line">		a0[i] = <span class="number">0</span>; a1[i] = <span class="number">0</span>; b0[i] = <span class="number">0</span>; b1[i] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> M = <span class="built_in">sqrt</span>(P) + <span class="number">1</span>; </span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i ++) &#123;</span><br><span class="line">		a0[i] = A[i] / M;</span><br><span class="line">		a1[i] = A[i] % M;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i ++) &#123;</span><br><span class="line">		b0[i] = B[i] / M;</span><br><span class="line">		b1[i] = B[i] % M;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; b1[i].x &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">DFT</span>(a1, b0); <span class="built_in">DFT</span>(a0, b1);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) &#123;</span><br><span class="line">		p[i] = a0[i] * b0[i] + I * a1[i] * b0[i];</span><br><span class="line">		q[i] = a0[i] * b1[i] + I * a1[i] * b1[i];</span><br><span class="line">		<span class="comment">//cout &lt;&lt; (LL) b0[i].y &lt;&lt; endl;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">FFT</span>(p, <span class="number">-1</span>); <span class="built_in">FFT</span>(q, <span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; i ++) &#123;</span><br><span class="line">		C[i] = ( (LL) M * M % P * <span class="built_in">qz</span>(p[i].x) % P + (LL) M * <span class="built_in">qz</span>(p[i].y) % P + (LL) M * <span class="built_in">qz</span>(q[i].x) % P + <span class="built_in">qz</span>(q[i].y) ) % P; </span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">getinv</span><span class="params">(<span class="type">int</span> *F, <span class="type">int</span> *G, <span class="type">int</span> dep)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(dep == <span class="number">1</span>) &#123;</span><br><span class="line">		G[<span class="number">0</span>] = <span class="built_in">power</span>(F[<span class="number">0</span>], P - <span class="number">2</span>);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">getinv</span>(F, G, (dep + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> C[N], D[N];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dep; i ++) C[i] = F[i];</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = dep; i &lt; (dep &lt;&lt; <span class="number">1</span>); i ++) C[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; (dep &lt;&lt; <span class="number">1</span>); i ++) D[i] = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt; dep; i ++) cout &lt;&lt; D[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;-----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; C[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; G[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="built_in">MTT</span>(C, G, D, dep, dep);</span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; D[i] &lt;&lt; &#x27; &#x27; ; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;-----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//lfor(int i = 0; i &lt; dep; i ++) cout &lt;&lt; D[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = dep; i &lt; (dep &lt;&lt; <span class="number">1</span>); i ++) D[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt; (dep &lt;&lt; 2); i ++) C[i] = 0;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;-----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; D[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; G[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">MTT</span>(D, G, C, dep, dep);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; C[i] &lt;&lt; &#x27; &#x27; ; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = dep; i &lt; (dep &lt;&lt; <span class="number">1</span>); i ++) C[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dep; i ++) &#123;</span><br><span class="line">		<span class="type">int</span> v = (<span class="number">2LL</span> * G[i] % P - C[i] + P) % P;</span><br><span class="line">		G[i] = v;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = dep; i &lt; (dep &lt;&lt; <span class="number">1</span>); i ++) G[i] = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//for(int i = 0; i &lt;= dep; i ++) cout &lt;&lt; G[i] &lt;&lt; &#x27; &#x27;; cout &lt;&lt; endl;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; &quot;----------------------------------------&quot; &lt;&lt; endl;</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"><span class="type">int</span> a[N], b[N], c[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;a.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="comment">//freopen(&quot;a.out&quot;, &quot;w&quot;, stdout);</span></span><br><span class="line">	n = <span class="built_in">read</span>(); P = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++) a[i] = <span class="built_in">read</span>() % P;</span><br><span class="line">	<span class="built_in">getinv</span>(a, b, n);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++) <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, b[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三模NTT"><a href="#三模NTT" class="headerlink" title="三模NTT"></a>三模NTT</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LL long long</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> x = <span class="number">0</span>, f = <span class="number">1</span>; <span class="type">char</span> a = <span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">for</span>(; a &gt; <span class="string">&#x27;9&#x27;</span> || a &lt; <span class="string">&#x27;0&#x27;</span>; a = <span class="built_in">getchar</span>()) <span class="keyword">if</span>(a == <span class="string">&#x27;-&#x27;</span>) f = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(; a &lt;= <span class="string">&#x27;9&#x27;</span> &amp;&amp; a &gt;= <span class="string">&#x27;0&#x27;</span>; a = <span class="built_in">getchar</span>()) x = x * <span class="number">10</span> + a - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> x * f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> Data &#123;</span><br><span class="line">	<span class="function">LL <span class="title">power</span><span class="params">(LL x, LL k, LL P)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//cout &lt;&lt; k &lt;&lt; &#x27; &#x27; &lt;&lt; P &lt;&lt; endl;</span></span><br><span class="line">		LL res = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(k) &#123;</span><br><span class="line">			<span class="keyword">if</span>(k &amp; <span class="number">1</span>) res = (LL) res * x % P;</span><br><span class="line">			x = (LL) x * x % P; k &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">		&#125; <span class="keyword">return</span> res;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> A = <span class="number">998244353</span>, B = <span class="number">1004535809</span>, C = <span class="number">469762049</span>;</span><br><span class="line">	<span class="comment">//const int P = 1e9 + 7;</span></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> G = <span class="number">3</span>;</span><br><span class="line">	<span class="type">const</span> LL I1 = <span class="built_in">power</span>(A, B - <span class="number">2</span>, B);</span><br><span class="line">	<span class="type">const</span> LL AB = (LL)A * B;</span><br><span class="line">	<span class="type">const</span> LL I2 = <span class="built_in">power</span>(AB % C, C - <span class="number">2</span>, C); </span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">Int</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> :</span><br><span class="line">			LL a, b, c;</span><br><span class="line">		<span class="keyword">public</span> :</span><br><span class="line">			<span class="built_in">Int</span>() &#123;&#125;</span><br><span class="line">			<span class="built_in">Int</span>(<span class="type">int</span> V) : <span class="built_in">a</span>(V % A), <span class="built_in">b</span>(V % B), <span class="built_in">c</span>(V % C) &#123;&#125;</span><br><span class="line">			<span class="built_in">Int</span>(<span class="type">int</span> X, <span class="type">int</span> Y, <span class="type">int</span> Z) : <span class="built_in">a</span>(X), <span class="built_in">b</span>(Y), <span class="built_in">c</span>(Z) &#123;&#125;</span><br><span class="line">			<span class="function"><span class="type">static</span> <span class="keyword">inline</span> Int <span class="title">reduce</span><span class="params">(<span class="type">const</span> Int &amp;x)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">Int</span> ( (x.a % A + A) % A,  (x.b % B + B) % B, (x.c % C + C) % C );</span><br><span class="line">			&#125; </span><br><span class="line">			<span class="keyword">inline</span> <span class="keyword">friend</span> Int <span class="keyword">operator</span> +(<span class="type">const</span> Int &amp;x, <span class="type">const</span> Int &amp;y) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">reduce</span>( <span class="built_in">Int</span> (x.a + y.a, x.b + y.b, x.c + y.c) );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">inline</span> <span class="keyword">friend</span> Int <span class="keyword">operator</span> -(<span class="type">const</span> Int &amp;x, <span class="type">const</span> Int &amp;y) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">reduce</span>( <span class="built_in">Int</span> (x.a - y.a + A, x.b - y.b + B, x.c - y.c + C) );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">inline</span> <span class="keyword">friend</span> Int <span class="keyword">operator</span> *(<span class="type">const</span> Int &amp;x, <span class="type">const</span> Int &amp;y) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">reduce</span>( <span class="built_in">Int</span> (x.a * y.a % A, x.b * y.b % B, x.c * y.c % C) );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">inline</span> LL <span class="title">ask</span><span class="params">(<span class="type">int</span> P)</span> </span>&#123;</span><br><span class="line">				LL x = (b - a + B) % B * I1 % B * A + a;</span><br><span class="line">				<span class="keyword">return</span> ((LL) (c - x % C + C) % C * I2 % C * ( AB % P ) % P + x) % P;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Data :: Int;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">4e5</span> + <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> lim, bit;</span><br><span class="line"><span class="type">int</span> rev[N];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">	lim = <span class="number">1</span>; bit = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(lim &lt; n) lim &lt;&lt;= <span class="number">1</span>, bit ++;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) rev[i] = (rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>) | ((i &amp; <span class="number">1</span>) &lt;&lt; (bit - <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NTT</span><span class="params">(Int *A, <span class="type">int</span> type)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) <span class="keyword">if</span>(i &lt; rev[i]) <span class="built_in">swap</span>(A[i], A[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> dep = <span class="number">1</span>; dep &lt; lim; dep &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">		Int Wn = ((type == <span class="number">1</span>) ? </span><br><span class="line">		<span class="built_in">Int</span>( </span><br><span class="line">		Data :: <span class="built_in">power</span>(<span class="number">3</span>, (Data :: A - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: A), </span><br><span class="line">		Data :: <span class="built_in">power</span>(<span class="number">3</span>, (Data :: B - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: B),</span><br><span class="line">		Data :: <span class="built_in">power</span>(<span class="number">3</span>, (Data :: C - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: C) ) :</span><br><span class="line">		<span class="built_in">Int</span>(</span><br><span class="line">		Data :: <span class="built_in">power</span>(Data :: <span class="built_in">power</span>(<span class="number">3</span>, Data :: A - <span class="number">2</span>, Data :: A), (Data :: A - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: A),</span><br><span class="line">		Data :: <span class="built_in">power</span>(Data :: <span class="built_in">power</span>(<span class="number">3</span>, Data :: B - <span class="number">2</span>, Data :: B), (Data :: B - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: B),</span><br><span class="line">		Data :: <span class="built_in">power</span>(Data :: <span class="built_in">power</span>(<span class="number">3</span>, Data :: C - <span class="number">2</span>, Data :: C), (Data :: C - <span class="number">1</span>) / (dep &lt;&lt; <span class="number">1</span>), Data :: C) ) );</span><br><span class="line">		<span class="comment">//cout &lt;&lt; Wn.a &lt;&lt; &#x27; &#x27; &lt;&lt; Wn.b &lt;&lt; &#x27; &#x27; &lt;&lt; Wn.c &lt;&lt; endl;</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>, len = (dep &lt;&lt; <span class="number">1</span>); j &lt; lim; j += len) &#123;</span><br><span class="line">			<span class="function">Int <span class="title">w</span><span class="params">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span></span>;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> k = <span class="number">0</span>; k &lt; dep; k ++, w = w * Wn) &#123;</span><br><span class="line">				Int x = A[j + k], y = w * A[j + k + dep];</span><br><span class="line">				A[j + k] = x + y;</span><br><span class="line">				A[j + k + dep] = x - y;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(type == <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="function">Int <span class="title">inv</span> <span class="params">(Data :: power(lim, Data :: A - <span class="number">2</span>, Data :: A), </span></span></span><br><span class="line"><span class="params"><span class="function">				Data :: power(lim, Data :: B - <span class="number">2</span>, Data :: B),</span></span></span><br><span class="line"><span class="params"><span class="function">				Data :: power(lim, Data :: C - <span class="number">2</span>, Data :: C))</span></span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) A[i] = A[i] * inv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m, P;</span><br><span class="line">Int f[N], g[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="meta">#<span class="keyword">ifdef</span> IN</span></span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;P4245_11.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;a.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	n = <span class="built_in">read</span>(); m = <span class="built_in">read</span>(); P = <span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n; i ++) f[i] = <span class="built_in">Int</span> (<span class="built_in">read</span>() % P);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= m; i ++) g[i] = <span class="built_in">Int</span> (<span class="built_in">read</span>() % P); </span><br><span class="line">	<span class="built_in">init</span>(n + m + <span class="number">1</span>);</span><br><span class="line">	<span class="built_in">NTT</span>(f, <span class="number">1</span>); <span class="built_in">NTT</span>(g, <span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; lim; i ++) f[i] = f[i] * g[i];</span><br><span class="line">	<span class="built_in">NTT</span>(f, <span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= n + m; i ++) <span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>, f[i].<span class="built_in">ask</span>(P));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">wrpwrp</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/08/16/template/">http://example.com/2023/08/16/template/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">wrpwrpのBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%A8%A1%E6%9D%BF/">模板</a></div><div class="post_share"><div class="social-share" data-image="https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://bpic.588ku.com/element_pic/20/07/01/4347f2eea4eebb9a4708ea61636893a7.jpg!/fw/253/quality/90/unsharp/true/compress/true" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">wrpwrp</div><div class="author-info__description">QQ:2167306203 退役OIER, HUST 在读</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">3</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">常用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E8%AF%BB%E5%BF%AB%E5%86%99"><span class="toc-number">1.1.</span> <span class="toc-text">快读快写</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BC%BA%E7%9C%81%E6%BA%90"><span class="toc-number">1.2.</span> <span class="toc-text">常用缺省源</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8"><span class="toc-number">2.1.</span> <span class="toc-text">哈希表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gp-hash-table"><span class="toc-number">2.1.1.</span> <span class="toc-text">gp_hash_table</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%B4%E7%B4%A0%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.1.2.</span> <span class="toc-text">朴素实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%93%88%E5%B8%8C"><span class="toc-number">2.2.</span> <span class="toc-text">字符串哈希</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%93%88%E5%B8%8C"><span class="toc-number">2.2.1.</span> <span class="toc-text">单哈希</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E6%BA%A2%E5%87%BA"><span class="toc-number">2.2.2.</span> <span class="toc-text">自然溢出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E6%AE%B5%E6%A0%91"><span class="toc-number">2.3.</span> <span class="toc-text">线段树</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BA%E9%97%B4%E5%8E%86%E5%8F%B2%E6%9C%80%E5%80%BC%EF%BC%8C-%E5%8C%BA%E9%97%B4%E5%8F%96min"><span class="toc-number">2.3.1.</span> <span class="toc-text">区间历史最值， 区间取min</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A6%E5%81%8F%E6%A0%91"><span class="toc-number">2.4.</span> <span class="toc-text">左偏树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">2.5.</span> <span class="toc-text">平衡树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KDT"><span class="toc-number">2.6.</span> <span class="toc-text">KDT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCT"><span class="toc-number">2.7.</span> <span class="toc-text">LCT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%8E%E8%B6%85%E6%A0%91"><span class="toc-number">2.8.</span> <span class="toc-text">李超树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86"><span class="toc-number">2.9.</span> <span class="toc-text">树链剖分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LCA"><span class="toc-number">2.10.</span> <span class="toc-text">LCA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ST%E8%A1%A8%E6%B1%82LCA"><span class="toc-number">2.10.1.</span> <span class="toc-text">ST表求LCA</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%A0%91"><span class="toc-number">2.11.</span> <span class="toc-text">虚树</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E8%AE%BA"><span class="toc-number">3.</span> <span class="toc-text">图论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E7%9F%AD%E8%B7%AF"><span class="toc-number">3.1.</span> <span class="toc-text">最短路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dijskra-%E5%A0%86%E4%BC%98%E5%8C%96"><span class="toc-number">3.1.1.</span> <span class="toc-text">dijskra 堆优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF-%E6%AC%A7%E6%8B%89%E8%B7%AF"><span class="toc-number">3.2.</span> <span class="toc-text">欧拉回路&#x2F;欧拉路</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E5%90%91%E5%9B%BE%E5%AD%97%E5%85%B8%E5%BA%8F%E6%9C%80%E5%B0%8F%E6%AC%A7%E6%8B%89%E8%B7%AF"><span class="toc-number">3.2.1.</span> <span class="toc-text">有向图字典序最小欧拉路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AC%A7%E6%8B%89%E5%9B%9E%E8%B7%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">欧拉回路</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#K%E7%9F%AD%E8%B7%AF-%EF%BC%88%E5%8F%AF%E5%B9%B6%E5%A0%86%E4%BC%98%E5%8C%96%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">K短路 （可并堆优化）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="toc-number">3.4.</span> <span class="toc-text">连通分量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%8F%8C"><span class="toc-number">3.4.1.</span> <span class="toc-text">点双</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%B9%E5%8F%8C"><span class="toc-number">3.4.2.</span> <span class="toc-text">边双</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F"><span class="toc-number">3.4.3.</span> <span class="toc-text">强连通分量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tarjan"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">tarjan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#kosoraju"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">kosoraju</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E5%89%B2%E6%A0%91"><span class="toc-number">3.5.</span> <span class="toc-text">最小割树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%AF%E9%85%8D%E6%A0%91"><span class="toc-number">3.6.</span> <span class="toc-text">支配树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-SAT"><span class="toc-number">3.7.</span> <span class="toc-text">2-SAT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%AE%E5%88%86%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.8.</span> <span class="toc-text">差分约束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81"><span class="toc-number">3.9.</span> <span class="toc-text">网络流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="toc-number">3.9.1.</span> <span class="toc-text">最大流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="toc-number">3.9.2.</span> <span class="toc-text">最小费用最大流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E6%BA%90%E6%B1%87%E6%9C%89%E4%B8%8A%E4%B8%8B%E7%95%8C%E5%8F%AF%E8%A1%8C%E6%B5%81"><span class="toc-number">3.9.3.</span> <span class="toc-text">无源汇有上下界可行流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%BA%90%E6%B1%87%E6%9C%89%E4%B8%8A%E4%B8%8B%E7%95%8C%E6%9C%80%E5%A4%A7%E6%B5%81"><span class="toc-number">3.9.4.</span> <span class="toc-text">有源汇有上下界最大流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E6%BA%90%E6%B1%87%E6%9C%89%E4%B8%8A%E4%B8%8B%E7%95%8C%E6%9C%80%E5%B0%8F%E6%B5%81"><span class="toc-number">3.9.5.</span> <span class="toc-text">有源汇有上下界最小流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE"><span class="toc-number">3.10.</span> <span class="toc-text">最小树形图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E5%9B%BE%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D-%E5%B8%A6%E8%8A%B1%E6%A0%91"><span class="toc-number">3.11.</span> <span class="toc-text">一般图最大匹配(带花树)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E5%88%86%E5%9B%BE%E6%9C%80%E5%A4%A7%E6%9D%83%E5%AE%8C%E7%BE%8E%E5%8C%B9%E9%85%8D%EF%BC%88KM%EF%BC%89"><span class="toc-number">3.12.</span> <span class="toc-text">二分图最大权完美匹配（KM）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E7%9A%84%E7%BB%9D%E5%AF%B9%E4%B8%AD%E5%BF%83%EF%BC%88%E6%9C%80%E5%B0%8F%E7%9B%B4%E5%BE%84%E7%94%9F%E6%88%90%E6%A0%91%EF%BC%89"><span class="toc-number">3.13.</span> <span class="toc-text">图的绝对中心（最小直径生成树）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E8%AE%BA"><span class="toc-number">4.</span> <span class="toc-text">数论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#EXCRT"><span class="toc-number">4.1.</span> <span class="toc-text">EXCRT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A9%E5%B1%95lulas"><span class="toc-number">4.2.</span> <span class="toc-text">扩展lulas</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%9C%E6%95%99%E7%AD%9B"><span class="toc-number">4.3.</span> <span class="toc-text">杜教筛</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E5%B7%A7"><span class="toc-number">4.3.1.</span> <span class="toc-text">技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Min25"><span class="toc-number">4.4.</span> <span class="toc-text">Min25</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83"><span class="toc-number">4.5.</span> <span class="toc-text">高斯消元</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86"><span class="toc-number">4.6.</span> <span class="toc-text">矩阵求逆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSGS"><span class="toc-number">4.7.</span> <span class="toc-text">BSGS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exbsgs"><span class="toc-number">4.8.</span> <span class="toc-text">exbsgs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B6"><span class="toc-number">4.9.</span> <span class="toc-text">阶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E6%A0%B9"><span class="toc-number">4.10.</span> <span class="toc-text">原根</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B1%82%E5%8E%9F%E6%A0%B9"><span class="toc-number">4.10.1.</span> <span class="toc-text">求原根</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Miller-Rabin-Pollard-Rho"><span class="toc-number">4.11.</span> <span class="toc-text">Miller_Rabin &amp;&amp; Pollard_Rho</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exgcd-%EF%BC%88%E6%94%BE%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B4%9B%E8%B0%B7%E6%9D%BF%E5%AD%90%EF%BC%8C-%E8%AE%B0%E5%BE%97%E9%80%A0%E4%B8%80%E4%B8%AA%E6%9C%89%E8%AF%B4%E6%98%8E%E7%9A%84%EF%BC%89"><span class="toc-number">4.12.</span> <span class="toc-text">exgcd （放了一个洛谷板子， 记得造一个有说明的）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#O-1-gcd"><span class="toc-number">4.13.</span> <span class="toc-text">O(1) gcd</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6"><span class="toc-number">5.</span> <span class="toc-text">组合数学</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E6%8A%80%E5%B7%A7%EF%BC%88%E5%BE%85%E8%A1%A5%E5%85%85%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">各种技巧（待补充）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%85%A8%E5%AE%B6%E6%A1%B6"><span class="toc-number">5.2.</span> <span class="toc-text">多项式全家桶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E6%A8%A1%E6%95%B0%E5%A4%9A%E9%A1%B9%E5%BC%8F%E4%B9%98%E6%B3%95-%E6%B1%82%E9%80%86%EF%BC%88%E4%BD%BF%E7%94%A8MTT%E5%AE%9E%E7%8E%B0%EF%BC%89"><span class="toc-number">5.3.</span> <span class="toc-text">任意模数多项式乘法&#x2F;求逆（使用MTT实现）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E6%A8%A1NTT"><span class="toc-number">5.4.</span> <span class="toc-text">三模NTT</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/08/17/%E4%BF%9D%E5%BA%8F%E5%9B%9E%E5%BD%92/" title="保序回归学习笔记"><img src="https://ts1.cn.mm.bing.net/th/id/R-C.c4c52f16cc67c7409eff60a4fce2d152?rik=qBwdq1iz39HyPA&amp;riu=http%3a%2f%2fwww.kutoo8.com%2fupload%2fimage%2f95093231%2f13.jpg&amp;ehk=%2flbRri2PpwfxcQiqdvwcgv76NPhmuhxXUC9lhcyITcw%3d&amp;risl=&amp;pid=ImgRaw&amp;r=0" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="保序回归学习笔记"/></a><div class="content"><a class="title" href="/2023/08/17/%E4%BF%9D%E5%BA%8F%E5%9B%9E%E5%BD%92/" title="保序回归学习笔记">保序回归学习笔记</a><time datetime="2023-08-16T16:00:00.000Z" title="发表于 2023-08-17 00:00:00">2023-08-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/16/Min25%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Min25筛"><img src="https://pic3.zhimg.com/v2-036d26b04026ce41612a6eee0af2a04a_b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Min25筛"/></a><div class="content"><a class="title" href="/2023/08/16/Min25%E7%AD%9B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Min25筛">Min25筛</a><time datetime="2023-08-15T16:00:00.000Z" title="发表于 2023-08-16 00:00:00">2023-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/08/16/template/" title="acm模板整理（未完）"><img src="https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="acm模板整理（未完）"/></a><div class="content"><a class="title" href="/2023/08/16/template/" title="acm模板整理（未完）">acm模板整理（未完）</a><time datetime="2023-08-15T16:00:00.000Z" title="发表于 2023-08-16 00:00:00">2023-08-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://pic4.zhimg.com/v2-b6a769a38503618fb6dae49f0bb43789_r.jpg?source=1940ef5c')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By wrpwrp</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>